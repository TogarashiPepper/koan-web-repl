var yr=(je,ve)=>()=>(ve||je((ve={exports:{}}).exports,ve),ve.exports);var Er=yr((Rr,yt)=>{(async()=>{(function(){const h=document.createElement("link").relList;if(h&&h.supports&&h.supports("modulepreload"))return;for(const k of document.querySelectorAll('link[rel="modulepreload"]'))w(k);new MutationObserver(k=>{for(const M of k)if(M.type==="childList")for(const P of M.addedNodes)P.tagName==="LINK"&&P.rel==="modulepreload"&&w(P)}).observe(document,{childList:!0,subtree:!0});function v(k){const M={};return k.integrity&&(M.integrity=k.integrity),k.referrerPolicy&&(M.referrerPolicy=k.referrerPolicy),k.crossOrigin==="use-credentials"?M.credentials="include":k.crossOrigin==="anonymous"?M.credentials="omit":M.credentials="same-origin",M}function w(k){if(k.ep)return;k.ep=!0;const M=v(k);fetch(k.href,M)}})();let je=kt;const ve=1,$e=2,Et={owned:null,cleanups:null,context:null,owner:null};var _e=null;let ot=null,xr=null,Se=null,ge=null,Ce=null,ze=0;function pi(h,v){const w=Se,k=_e,M=h.length===0,P=v===void 0?k:v,x=M?Et:{owned:null,cleanups:null,context:P?P.context:null,owner:P},t=M?h:()=>h(()=>Ie(()=>qe(x)));_e=x,Se=null;try{return Ve(t,!0)}finally{Se=w,_e=k}}function at(h,v,w){const k=xt(h,v,!1,ve);ht(k)}function vi(h,v,w){je=wi;const k=xt(h,v,!1,ve);k.user=!0,Ce?Ce.push(k):ht(k)}function Ie(h){if(Se===null)return h();const v=Se;Se=null;try{return h()}finally{Se=v}}function mi(h){vi(()=>Ie(h))}function Si(h,v,w){let k=h.value;return(!h.comparator||!h.comparator(k,v))&&(h.value=v,h.observers&&h.observers.length&&Ve(()=>{for(let M=0;M<h.observers.length;M+=1){const P=h.observers[M],x=ot&&ot.running;x&&ot.disposed.has(P),(x?!P.tState:!P.state)&&(P.pure?ge.push(P):Ce.push(P),P.observers&&Lt(P)),x||(P.state=ve)}if(ge.length>1e6)throw ge=[],new Error},!1)),v}function ht(h){if(!h.fn)return;qe(h);const v=ze;bi(h,h.value,v)}function bi(h,v,w){let k;const M=_e,P=Se;Se=_e=h;try{k=h.fn(v)}catch(x){return h.pure&&(h.state=ve,h.owned&&h.owned.forEach(qe),h.owned=null),h.updatedAt=w+1,Dt(x)}finally{Se=P,_e=M}(!h.updatedAt||h.updatedAt<=w)&&(h.updatedAt!=null&&"observers"in h?Si(h,k):h.value=k,h.updatedAt=w)}function xt(h,v,w,k=ve,M){const P={fn:h,state:k,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:v,owner:_e,context:_e?_e.context:null,pure:w};return _e===null||_e!==Et&&(_e.owned?_e.owned.push(P):_e.owned=[P]),P}function Ke(h){if(h.state===0)return;if(h.state===$e)return ct(h);if(h.suspense&&Ie(h.suspense.inFallback))return h.suspense.effects.push(h);const v=[h];for(;(h=h.owner)&&(!h.updatedAt||h.updatedAt<ze);)h.state&&v.push(h);for(let w=v.length-1;w>=0;w--)if(h=v[w],h.state===ve)ht(h);else if(h.state===$e){const k=ge;ge=null,Ve(()=>ct(h,v[0]),!1),ge=k}}function Ve(h,v){if(ge)return h();let w=!1;v||(ge=[]),Ce?w=!0:Ce=[],ze++;try{const k=h();return Ci(w),k}catch(k){w||(Ce=null),ge=null,Dt(k)}}function Ci(h){if(ge&&(kt(ge),ge=null),h)return;const v=Ce;Ce=null,v.length&&Ve(()=>je(v),!1)}function kt(h){for(let v=0;v<h.length;v++)Ke(h[v])}function wi(h){let v,w=0;for(v=0;v<h.length;v++){const k=h[v];k.user?h[w++]=k:Ke(k)}for(v=0;v<w;v++)Ke(h[v])}function ct(h,v){h.state=0;for(let w=0;w<h.sources.length;w+=1){const k=h.sources[w];if(k.sources){const M=k.state;M===ve?k!==v&&(!k.updatedAt||k.updatedAt<ze)&&Ke(k):M===$e&&ct(k,v)}}}function Lt(h){for(let v=0;v<h.observers.length;v+=1){const w=h.observers[v];w.state||(w.state=$e,w.pure?ge.push(w):Ce.push(w),w.observers&&Lt(w))}}function qe(h){let v;if(h.sources)for(;h.sources.length;){const w=h.sources.pop(),k=h.sourceSlots.pop(),M=w.observers;if(M&&M.length){const P=M.pop(),x=w.observerSlots.pop();k<M.length&&(P.sourceSlots[x]=k,M[k]=P,w.observerSlots[k]=x)}}if(h.owned){for(v=h.owned.length-1;v>=0;v--)qe(h.owned[v]);h.owned=null}if(h.cleanups){for(v=h.cleanups.length-1;v>=0;v--)h.cleanups[v]();h.cleanups=null}h.state=0}function yi(h){return h instanceof Error?h:new Error(typeof h=="string"?h:"Unknown error",{cause:h})}function Dt(h,v=_e){throw yi(h)}let kr=!1;function Rt(h,v){return Ie(()=>h(v||{}))}function Ei(h,v,w){let k=w.length,M=v.length,P=k,x=0,t=0,n=v[M-1].nextSibling,c=null;for(;x<M||t<P;){if(v[x]===w[t]){x++,t++;continue}for(;v[M-1]===w[P-1];)M--,P--;if(M===x){const u=P<k?t?w[t-1].nextSibling:w[P-t]:n;for(;t<P;)h.insertBefore(w[t++],u)}else if(P===t)for(;x<M;)(!c||!c.has(v[x]))&&v[x].remove(),x++;else if(v[x]===w[P-1]&&w[t]===v[M-1]){const u=v[--M].nextSibling;h.insertBefore(w[t++],v[x++].nextSibling),h.insertBefore(w[--P],u),v[M]=w[P]}else{if(!c){c=new Map;let o=t;for(;o<P;)c.set(w[o],o++)}const u=c.get(v[x]);if(u!=null)if(t<u&&u<P){let o=x,_=1,f;for(;++o<M&&o<P&&!((f=c.get(v[o]))==null||f!==u+_);)_++;if(_>u-t){const S=v[x];for(;t<u;)h.insertBefore(w[t++],S)}else h.replaceChild(w[t++],v[x++])}else x++;else v[x++].remove()}}}function xi(h,v,w,k={}){let M;return pi(P=>{M=P,v===document?h():Di(v,h(),v.firstChild?null:void 0,w)},k.owner),()=>{M(),v.textContent=""}}function ki(h,v,w){let k;const M=()=>{const x=document.createElement("template");return x.innerHTML=h,x.content.firstChild},P=()=>(k||(k=M())).cloneNode(!0);return P.cloneNode=P,P}function Li(h,v,w){return Ie(()=>h(v,w))}function Di(h,v,w,k){if(w!==void 0&&!k&&(k=[]),typeof v!="function")return Ge(h,v,k,w);at(M=>Ge(h,v(),M,w),k)}function Ge(h,v,w,k,M){for(;typeof w=="function";)w=w();if(v===w)return w;const P=typeof v,x=k!==void 0;if(h=x&&w[0]&&w[0].parentNode||h,P==="string"||P==="number"){if(P==="number"&&(v=v.toString(),v===w))return w;if(x){let t=w[0];t&&t.nodeType===3?t.data!==v&&(t.data=v):t=document.createTextNode(v),w=Re(h,w,k,t)}else w!==""&&typeof w=="string"?w=h.firstChild.data=v:w=h.textContent=v}else if(v==null||P==="boolean")w=Re(h,w,k);else{if(P==="function")return at(()=>{let t=v();for(;typeof t=="function";)t=t();w=Ge(h,t,w,k)}),()=>w;if(Array.isArray(v)){const t=[],n=w&&Array.isArray(w);if(lt(t,v,w,M))return at(()=>w=Ge(h,t,w,k,!0)),()=>w;if(t.length===0){if(w=Re(h,w,k),x)return w}else n?w.length===0?At(h,t,k):Ei(h,w,t):(w&&Re(h),At(h,t));w=t}else if(v.nodeType){if(Array.isArray(w)){if(x)return w=Re(h,w,k,v);Re(h,w,null,v)}else w==null||w===""||!h.firstChild?h.appendChild(v):h.replaceChild(v,h.firstChild);w=v}}return w}function lt(h,v,w,k){let M=!1;for(let P=0,x=v.length;P<x;P++){let t=v[P],n=w&&w[h.length],c;if(!(t==null||t===!0||t===!1))if((c=typeof t)=="object"&&t.nodeType)h.push(t);else if(Array.isArray(t))M=lt(h,t,n)||M;else if(c==="function")if(k){for(;typeof t=="function";)t=t();M=lt(h,Array.isArray(t)?t:[t],Array.isArray(n)?n:[n])||M}else h.push(t),M=!0;else{const u=String(t);n&&n.nodeType===3&&n.data===u?h.push(n):h.push(document.createTextNode(u))}}return M}function At(h,v,w=null){for(let k=0,M=v.length;k<M;k++)h.insertBefore(v[k],w)}function Re(h,v,w,k){if(w===void 0)return h.textContent="";const M=k||document.createTextNode("");if(v.length){let P=!1;for(let x=v.length-1;x>=0;x--){const t=v[x];if(M!==t){const n=t.parentNode===h;!P&&!x?n?h.replaceChild(M,t):h.insertBefore(M,w):n&&t.remove()}else P=!0}}else h.insertBefore(M,w);return[M]}function Ri(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var Bt={exports:{}};(function(h,v){(function(w,k){h.exports=k()})(globalThis,()=>(()=>{var w={4567:function(x,t,n){var c=this&&this.__decorate||function(e,i,a,p){var g,m=arguments.length,d=m<3?i:p===null?p=Object.getOwnPropertyDescriptor(i,a):p;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(e,i,a,p);else for(var C=e.length-1;C>=0;C--)(g=e[C])&&(d=(m<3?g(d):m>3?g(i,a,d):g(i,a))||d);return m>3&&d&&Object.defineProperty(i,a,d),d},u=this&&this.__param||function(e,i){return function(a,p){i(a,p,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.AccessibilityManager=void 0;const o=n(9042),_=n(9924),f=n(844),S=n(4725),l=n(2585),s=n(3656);let r=t.AccessibilityManager=class extends f.Disposable{constructor(e,i,a,p){super(),this._terminal=e,this._coreBrowserService=a,this._renderService=p,this._rowColumns=new WeakMap,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="",this._accessibilityContainer=this._coreBrowserService.mainDocument.createElement("div"),this._accessibilityContainer.classList.add("xterm-accessibility"),this._rowContainer=this._coreBrowserService.mainDocument.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let g=0;g<this._terminal.rows;g++)this._rowElements[g]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[g]);if(this._topBoundaryFocusListener=g=>this._handleBoundaryFocus(g,0),this._bottomBoundaryFocusListener=g=>this._handleBoundaryFocus(g,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions(),this._accessibilityContainer.appendChild(this._rowContainer),this._liveRegion=this._coreBrowserService.mainDocument.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityContainer.appendChild(this._liveRegion),this._liveRegionDebouncer=this.register(new _.TimeBasedDebouncer(this._renderRows.bind(this))),!this._terminal.element)throw new Error("Cannot enable accessibility before Terminal.open");this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityContainer),this.register(this._terminal.onResize(g=>this._handleResize(g.rows))),this.register(this._terminal.onRender(g=>this._refreshRows(g.start,g.end))),this.register(this._terminal.onScroll(()=>this._refreshRows())),this.register(this._terminal.onA11yChar(g=>this._handleChar(g))),this.register(this._terminal.onLineFeed(()=>this._handleChar(`
`))),this.register(this._terminal.onA11yTab(g=>this._handleTab(g))),this.register(this._terminal.onKey(g=>this._handleKey(g.key))),this.register(this._terminal.onBlur(()=>this._clearLiveRegion())),this.register(this._renderService.onDimensionsChange(()=>this._refreshRowsDimensions())),this.register((0,s.addDisposableDomListener)(document,"selectionchange",()=>this._handleSelectionChange())),this.register(this._coreBrowserService.onDprChange(()=>this._refreshRowsDimensions())),this._refreshRows(),this.register((0,f.toDisposable)(()=>{this._accessibilityContainer.remove(),this._rowElements.length=0}))}_handleTab(e){for(let i=0;i<e;i++)this._handleChar(" ")}_handleChar(e){this._liveRegionLineCount<21&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==e&&(this._charsToAnnounce+=e):this._charsToAnnounce+=e,e===`
`&&(this._liveRegionLineCount++,this._liveRegionLineCount===21&&(this._liveRegion.textContent+=o.tooMuchOutput)))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0}_handleKey(e){this._clearLiveRegion(),new RegExp("\\p{Control}","u").test(e)||this._charsToConsume.push(e)}_refreshRows(e,i){this._liveRegionDebouncer.refresh(e,i,this._terminal.rows)}_renderRows(e,i){const a=this._terminal.buffer,p=a.lines.length.toString();for(let g=e;g<=i;g++){const m=a.lines.get(a.ydisp+g),d=[],C=(m==null?void 0:m.translateToString(!0,void 0,void 0,d))||"",R=(a.ydisp+g+1).toString(),A=this._rowElements[g];A&&(C.length===0?(A.innerText="\xA0",this._rowColumns.set(A,[0,1])):(A.textContent=C,this._rowColumns.set(A,d)),A.setAttribute("aria-posinset",R),A.setAttribute("aria-setsize",p))}this._announceCharacters()}_announceCharacters(){this._charsToAnnounce.length!==0&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}_handleBoundaryFocus(e,i){const a=e.target,p=this._rowElements[i===0?1:this._rowElements.length-2];if(a.getAttribute("aria-posinset")===(i===0?"1":`${this._terminal.buffer.lines.length}`)||e.relatedTarget!==p)return;let g,m;if(i===0?(g=a,m=this._rowElements.pop(),this._rowContainer.removeChild(m)):(g=this._rowElements.shift(),m=a,this._rowContainer.removeChild(g)),g.removeEventListener("focus",this._topBoundaryFocusListener),m.removeEventListener("focus",this._bottomBoundaryFocusListener),i===0){const d=this._createAccessibilityTreeNode();this._rowElements.unshift(d),this._rowContainer.insertAdjacentElement("afterbegin",d)}else{const d=this._createAccessibilityTreeNode();this._rowElements.push(d),this._rowContainer.appendChild(d)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(i===0?-1:1),this._rowElements[i===0?1:this._rowElements.length-2].focus(),e.preventDefault(),e.stopImmediatePropagation()}_handleSelectionChange(){var C;if(this._rowElements.length===0)return;const e=document.getSelection();if(!e)return;if(e.isCollapsed)return void(this._rowContainer.contains(e.anchorNode)&&this._terminal.clearSelection());if(!e.anchorNode||!e.focusNode)return void console.error("anchorNode and/or focusNode are null");let i={node:e.anchorNode,offset:e.anchorOffset},a={node:e.focusNode,offset:e.focusOffset};if((i.node.compareDocumentPosition(a.node)&Node.DOCUMENT_POSITION_PRECEDING||i.node===a.node&&i.offset>a.offset)&&([i,a]=[a,i]),i.node.compareDocumentPosition(this._rowElements[0])&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_FOLLOWING)&&(i={node:this._rowElements[0].childNodes[0],offset:0}),!this._rowContainer.contains(i.node))return;const p=this._rowElements.slice(-1)[0];if(a.node.compareDocumentPosition(p)&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_PRECEDING)&&(a={node:p,offset:((C=p.textContent)==null?void 0:C.length)??0}),!this._rowContainer.contains(a.node))return;const g=({node:R,offset:A})=>{const T=R instanceof Text?R.parentNode:R;let L=parseInt(T==null?void 0:T.getAttribute("aria-posinset"),10)-1;if(isNaN(L))return console.warn("row is invalid. Race condition?"),null;const H=this._rowColumns.get(T);if(!H)return console.warn("columns is null. Race condition?"),null;let N=A<H.length?H[A]:H.slice(-1)[0]+1;return N>=this._terminal.cols&&(++L,N=0),{row:L,column:N}},m=g(i),d=g(a);if(m&&d){if(m.row>d.row||m.row===d.row&&m.column>=d.column)throw new Error("invalid range");this._terminal.select(m.column,m.row,(d.row-m.row)*this._terminal.cols-m.column+d.column)}}_handleResize(e){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let i=this._rowContainer.children.length;i<this._terminal.rows;i++)this._rowElements[i]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[i]);for(;this._rowElements.length>e;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){const e=this._coreBrowserService.mainDocument.createElement("div");return e.setAttribute("role","listitem"),e.tabIndex=-1,this._refreshRowDimensions(e),e}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){this._accessibilityContainer.style.width=`${this._renderService.dimensions.css.canvas.width}px`,this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let e=0;e<this._terminal.rows;e++)this._refreshRowDimensions(this._rowElements[e])}}_refreshRowDimensions(e){e.style.height=`${this._renderService.dimensions.css.cell.height}px`}};t.AccessibilityManager=r=c([u(1,l.IInstantiationService),u(2,S.ICoreBrowserService),u(3,S.IRenderService)],r)},3614:(x,t)=>{function n(_){return _.replace(/\r?\n/g,"\r")}function c(_,f){return f?"\x1B[200~"+_+"\x1B[201~":_}function u(_,f,S,l){_=c(_=n(_),S.decPrivateModes.bracketedPasteMode&&l.rawOptions.ignoreBracketedPasteMode!==!0),S.triggerDataEvent(_,!0),f.value=""}function o(_,f,S){const l=S.getBoundingClientRect(),s=_.clientX-l.left-10,r=_.clientY-l.top-10;f.style.width="20px",f.style.height="20px",f.style.left=`${s}px`,f.style.top=`${r}px`,f.style.zIndex="1000",f.focus()}Object.defineProperty(t,"__esModule",{value:!0}),t.rightClickHandler=t.moveTextAreaUnderMouseCursor=t.paste=t.handlePasteEvent=t.copyHandler=t.bracketTextForPaste=t.prepareTextForTerminal=void 0,t.prepareTextForTerminal=n,t.bracketTextForPaste=c,t.copyHandler=function(_,f){_.clipboardData&&_.clipboardData.setData("text/plain",f.selectionText),_.preventDefault()},t.handlePasteEvent=function(_,f,S,l){_.stopPropagation(),_.clipboardData&&u(_.clipboardData.getData("text/plain"),f,S,l)},t.paste=u,t.moveTextAreaUnderMouseCursor=o,t.rightClickHandler=function(_,f,S,l,s){o(_,f,S),s&&l.rightClickSelect(_),f.value=l.selectionText,f.select()}},7239:(x,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ColorContrastCache=void 0;const c=n(1505);t.ColorContrastCache=class{constructor(){this._color=new c.TwoKeyMap,this._css=new c.TwoKeyMap}setCss(u,o,_){this._css.set(u,o,_)}getCss(u,o){return this._css.get(u,o)}setColor(u,o,_){this._color.set(u,o,_)}getColor(u,o){return this._color.get(u,o)}clear(){this._color.clear(),this._css.clear()}}},3656:(x,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addDisposableDomListener=void 0,t.addDisposableDomListener=function(n,c,u,o){n.addEventListener(c,u,o);let _=!1;return{dispose:()=>{_||(_=!0,n.removeEventListener(c,u,o))}}}},3551:function(x,t,n){var c=this&&this.__decorate||function(r,e,i,a){var p,g=arguments.length,m=g<3?e:a===null?a=Object.getOwnPropertyDescriptor(e,i):a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")m=Reflect.decorate(r,e,i,a);else for(var d=r.length-1;d>=0;d--)(p=r[d])&&(m=(g<3?p(m):g>3?p(e,i,m):p(e,i))||m);return g>3&&m&&Object.defineProperty(e,i,m),m},u=this&&this.__param||function(r,e){return function(i,a){e(i,a,r)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Linkifier=void 0;const o=n(3656),_=n(8460),f=n(844),S=n(2585),l=n(4725);let s=t.Linkifier=class extends f.Disposable{get currentLink(){return this._currentLink}constructor(r,e,i,a,p){super(),this._element=r,this._mouseService=e,this._renderService=i,this._bufferService=a,this._linkProviderService=p,this._linkCacheDisposables=[],this._isMouseOut=!0,this._wasResized=!1,this._activeLine=-1,this._onShowLinkUnderline=this.register(new _.EventEmitter),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this.register(new _.EventEmitter),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this.register((0,f.getDisposeArrayDisposable)(this._linkCacheDisposables)),this.register((0,f.toDisposable)(()=>{var g;this._lastMouseEvent=void 0,(g=this._activeProviderReplies)==null||g.clear()})),this.register(this._bufferService.onResize(()=>{this._clearCurrentLink(),this._wasResized=!0})),this.register((0,o.addDisposableDomListener)(this._element,"mouseleave",()=>{this._isMouseOut=!0,this._clearCurrentLink()})),this.register((0,o.addDisposableDomListener)(this._element,"mousemove",this._handleMouseMove.bind(this))),this.register((0,o.addDisposableDomListener)(this._element,"mousedown",this._handleMouseDown.bind(this))),this.register((0,o.addDisposableDomListener)(this._element,"mouseup",this._handleMouseUp.bind(this)))}_handleMouseMove(r){this._lastMouseEvent=r;const e=this._positionFromMouseEvent(r,this._element,this._mouseService);if(!e)return;this._isMouseOut=!1;const i=r.composedPath();for(let a=0;a<i.length;a++){const p=i[a];if(p.classList.contains("xterm"))break;if(p.classList.contains("xterm-hover"))return}this._lastBufferCell&&e.x===this._lastBufferCell.x&&e.y===this._lastBufferCell.y||(this._handleHover(e),this._lastBufferCell=e)}_handleHover(r){if(this._activeLine!==r.y||this._wasResized)return this._clearCurrentLink(),this._askForLink(r,!1),void(this._wasResized=!1);this._currentLink&&this._linkAtPosition(this._currentLink.link,r)||(this._clearCurrentLink(),this._askForLink(r,!0))}_askForLink(r,e){var a,p;this._activeProviderReplies&&e||((a=this._activeProviderReplies)==null||a.forEach(g=>{g==null||g.forEach(m=>{m.link.dispose&&m.link.dispose()})}),this._activeProviderReplies=new Map,this._activeLine=r.y);let i=!1;for(const[g,m]of this._linkProviderService.linkProviders.entries())e?(p=this._activeProviderReplies)!=null&&p.get(g)&&(i=this._checkLinkProviderResult(g,r,i)):m.provideLinks(r.y,d=>{var R,A;if(this._isMouseOut)return;const C=d==null?void 0:d.map(T=>({link:T}));(R=this._activeProviderReplies)==null||R.set(g,C),i=this._checkLinkProviderResult(g,r,i),((A=this._activeProviderReplies)==null?void 0:A.size)===this._linkProviderService.linkProviders.length&&this._removeIntersectingLinks(r.y,this._activeProviderReplies)})}_removeIntersectingLinks(r,e){const i=new Set;for(let a=0;a<e.size;a++){const p=e.get(a);if(p)for(let g=0;g<p.length;g++){const m=p[g],d=m.link.range.start.y<r?0:m.link.range.start.x,C=m.link.range.end.y>r?this._bufferService.cols:m.link.range.end.x;for(let R=d;R<=C;R++){if(i.has(R)){p.splice(g--,1);break}i.add(R)}}}}_checkLinkProviderResult(r,e,i){var g;if(!this._activeProviderReplies)return i;const a=this._activeProviderReplies.get(r);let p=!1;for(let m=0;m<r;m++)this._activeProviderReplies.has(m)&&!this._activeProviderReplies.get(m)||(p=!0);if(!p&&a){const m=a.find(d=>this._linkAtPosition(d.link,e));m&&(i=!0,this._handleNewLink(m))}if(this._activeProviderReplies.size===this._linkProviderService.linkProviders.length&&!i)for(let m=0;m<this._activeProviderReplies.size;m++){const d=(g=this._activeProviderReplies.get(m))==null?void 0:g.find(C=>this._linkAtPosition(C.link,e));if(d){i=!0,this._handleNewLink(d);break}}return i}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp(r){if(!this._currentLink)return;const e=this._positionFromMouseEvent(r,this._element,this._mouseService);e&&this._mouseDownLink===this._currentLink&&this._linkAtPosition(this._currentLink.link,e)&&this._currentLink.link.activate(r,this._currentLink.link.text)}_clearCurrentLink(r,e){this._currentLink&&this._lastMouseEvent&&(!r||!e||this._currentLink.link.range.start.y>=r&&this._currentLink.link.range.end.y<=e)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,(0,f.disposeArray)(this._linkCacheDisposables))}_handleNewLink(r){if(!this._lastMouseEvent)return;const e=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);e&&this._linkAtPosition(r.link,e)&&(this._currentLink=r,this._currentLink.state={decorations:{underline:r.link.decorations===void 0||r.link.decorations.underline,pointerCursor:r.link.decorations===void 0||r.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,r.link,this._lastMouseEvent),r.link.decorations={},Object.defineProperties(r.link.decorations,{pointerCursor:{get:()=>{var i,a;return(a=(i=this._currentLink)==null?void 0:i.state)==null?void 0:a.decorations.pointerCursor},set:i=>{var a;(a=this._currentLink)!=null&&a.state&&this._currentLink.state.decorations.pointerCursor!==i&&(this._currentLink.state.decorations.pointerCursor=i,this._currentLink.state.isHovered&&this._element.classList.toggle("xterm-cursor-pointer",i))}},underline:{get:()=>{var i,a;return(a=(i=this._currentLink)==null?void 0:i.state)==null?void 0:a.decorations.underline},set:i=>{var a,p,g;(a=this._currentLink)!=null&&a.state&&((g=(p=this._currentLink)==null?void 0:p.state)==null?void 0:g.decorations.underline)!==i&&(this._currentLink.state.decorations.underline=i,this._currentLink.state.isHovered&&this._fireUnderlineEvent(r.link,i))}}}),this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange(i=>{if(!this._currentLink)return;const a=i.start===0?0:i.start+1+this._bufferService.buffer.ydisp,p=this._bufferService.buffer.ydisp+1+i.end;if(this._currentLink.link.range.start.y>=a&&this._currentLink.link.range.end.y<=p&&(this._clearCurrentLink(a,p),this._lastMouseEvent)){const g=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);g&&this._askForLink(g,!1)}})))}_linkHover(r,e,i){var a;(a=this._currentLink)!=null&&a.state&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(e,!0),this._currentLink.state.decorations.pointerCursor&&r.classList.add("xterm-cursor-pointer")),e.hover&&e.hover(i,e.text)}_fireUnderlineEvent(r,e){const i=r.range,a=this._bufferService.buffer.ydisp,p=this._createLinkUnderlineEvent(i.start.x-1,i.start.y-a-1,i.end.x,i.end.y-a-1,void 0);(e?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(p)}_linkLeave(r,e,i){var a;(a=this._currentLink)!=null&&a.state&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(e,!1),this._currentLink.state.decorations.pointerCursor&&r.classList.remove("xterm-cursor-pointer")),e.leave&&e.leave(i,e.text)}_linkAtPosition(r,e){const i=r.range.start.y*this._bufferService.cols+r.range.start.x,a=r.range.end.y*this._bufferService.cols+r.range.end.x,p=e.y*this._bufferService.cols+e.x;return i<=p&&p<=a}_positionFromMouseEvent(r,e,i){const a=i.getCoords(r,e,this._bufferService.cols,this._bufferService.rows);if(a)return{x:a[0],y:a[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent(r,e,i,a,p){return{x1:r,y1:e,x2:i,y2:a,cols:this._bufferService.cols,fg:p}}};t.Linkifier=s=c([u(1,l.IMouseService),u(2,l.IRenderService),u(3,S.IBufferService),u(4,l.ILinkProviderService)],s)},9042:(x,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.tooMuchOutput=t.promptLabel=void 0,t.promptLabel="Terminal input",t.tooMuchOutput="Too much output to announce, navigate to rows manually to read"},3730:function(x,t,n){var c=this&&this.__decorate||function(l,s,r,e){var i,a=arguments.length,p=a<3?s:e===null?e=Object.getOwnPropertyDescriptor(s,r):e;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")p=Reflect.decorate(l,s,r,e);else for(var g=l.length-1;g>=0;g--)(i=l[g])&&(p=(a<3?i(p):a>3?i(s,r,p):i(s,r))||p);return a>3&&p&&Object.defineProperty(s,r,p),p},u=this&&this.__param||function(l,s){return function(r,e){s(r,e,l)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OscLinkProvider=void 0;const o=n(511),_=n(2585);let f=t.OscLinkProvider=class{constructor(l,s,r){this._bufferService=l,this._optionsService=s,this._oscLinkService=r}provideLinks(l,s){var C;const r=this._bufferService.buffer.lines.get(l-1);if(!r)return void s(void 0);const e=[],i=this._optionsService.rawOptions.linkHandler,a=new o.CellData,p=r.getTrimmedLength();let g=-1,m=-1,d=!1;for(let R=0;R<p;R++)if(m!==-1||r.hasContent(R)){if(r.loadCell(R,a),a.hasExtendedAttrs()&&a.extended.urlId){if(m===-1){m=R,g=a.extended.urlId;continue}d=a.extended.urlId!==g}else m!==-1&&(d=!0);if(d||m!==-1&&R===p-1){const A=(C=this._oscLinkService.getLinkData(g))==null?void 0:C.uri;if(A){const T={start:{x:m+1,y:l},end:{x:R+(d||R!==p-1?0:1),y:l}};let L=!1;if(!(i!=null&&i.allowNonHttpProtocols))try{const H=new URL(A);["http:","https:"].includes(H.protocol)||(L=!0)}catch{L=!0}L||e.push({text:A,range:T,activate:(H,N)=>i?i.activate(H,N,T):S(0,N),hover:(H,N)=>{var $;return($=i==null?void 0:i.hover)==null?void 0:$.call(i,H,N,T)},leave:(H,N)=>{var $;return($=i==null?void 0:i.leave)==null?void 0:$.call(i,H,N,T)}})}d=!1,a.hasExtendedAttrs()&&a.extended.urlId?(m=R,g=a.extended.urlId):(m=-1,g=-1)}}s(e)}};function S(l,s){if(confirm(`Do you want to navigate to ${s}?

WARNING: This link could potentially be dangerous`)){const r=window.open();if(r){try{r.opener=null}catch{}r.location.href=s}else console.warn("Opening link blocked as opener could not be cleared")}}t.OscLinkProvider=f=c([u(0,_.IBufferService),u(1,_.IOptionsService),u(2,_.IOscLinkService)],f)},6193:(x,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RenderDebouncer=void 0,t.RenderDebouncer=class{constructor(n,c){this._renderCallback=n,this._coreBrowserService=c,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback(n){return this._refreshCallbacks.push(n),this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh())),this._animationFrame}refresh(n,c,u){this._rowCount=u,n=n!==void 0?n:0,c=c!==void 0?c:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,n):n,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,c):c,this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._animationFrame=void 0,this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return void this._runRefreshCallbacks();const n=Math.max(this._rowStart,0),c=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(n,c),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(const n of this._refreshCallbacks)n(0);this._refreshCallbacks=[]}}},3236:(x,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Terminal=void 0;const c=n(3614),u=n(3656),o=n(3551),_=n(9042),f=n(3730),S=n(1680),l=n(3107),s=n(5744),r=n(2950),e=n(1296),i=n(428),a=n(4269),p=n(5114),g=n(8934),m=n(3230),d=n(9312),C=n(4725),R=n(6731),A=n(8055),T=n(8969),L=n(8460),H=n(844),N=n(6114),$=n(8437),I=n(2584),F=n(7399),b=n(5941),E=n(9074),D=n(2585),B=n(5435),U=n(4567),z=n(779);class G extends T.CoreTerminal{get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}constructor(O={}){super(O),this.browser=N,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._accessibilityManager=this.register(new H.MutableDisposable),this._onCursorMove=this.register(new L.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onKey=this.register(new L.EventEmitter),this.onKey=this._onKey.event,this._onRender=this.register(new L.EventEmitter),this.onRender=this._onRender.event,this._onSelectionChange=this.register(new L.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this.register(new L.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onBell=this.register(new L.EventEmitter),this.onBell=this._onBell.event,this._onFocus=this.register(new L.EventEmitter),this._onBlur=this.register(new L.EventEmitter),this._onA11yCharEmitter=this.register(new L.EventEmitter),this._onA11yTabEmitter=this.register(new L.EventEmitter),this._onWillOpen=this.register(new L.EventEmitter),this._setup(),this._decorationService=this._instantiationService.createInstance(E.DecorationService),this._instantiationService.setService(D.IDecorationService,this._decorationService),this._linkProviderService=this._instantiationService.createInstance(z.LinkProviderService),this._instantiationService.setService(C.ILinkProviderService,this._linkProviderService),this._linkProviderService.registerLinkProvider(this._instantiationService.createInstance(f.OscLinkProvider)),this.register(this._inputHandler.onRequestBell(()=>this._onBell.fire())),this.register(this._inputHandler.onRequestRefreshRows((y,j)=>this.refresh(y,j))),this.register(this._inputHandler.onRequestSendFocus(()=>this._reportFocus())),this.register(this._inputHandler.onRequestReset(()=>this.reset())),this.register(this._inputHandler.onRequestWindowsOptionsReport(y=>this._reportWindowsOptions(y))),this.register(this._inputHandler.onColor(y=>this._handleColorEvent(y))),this.register((0,L.forwardEvent)(this._inputHandler.onCursorMove,this._onCursorMove)),this.register((0,L.forwardEvent)(this._inputHandler.onTitleChange,this._onTitleChange)),this.register((0,L.forwardEvent)(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this.register((0,L.forwardEvent)(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this.register(this._bufferService.onResize(y=>this._afterResize(y.cols,y.rows))),this.register((0,H.toDisposable)(()=>{var y,j;this._customKeyEventHandler=void 0,(j=(y=this.element)==null?void 0:y.parentNode)==null||j.removeChild(this.element)}))}_handleColorEvent(O){if(this._themeService)for(const y of O){let j,W="";switch(y.index){case 256:j="foreground",W="10";break;case 257:j="background",W="11";break;case 258:j="cursor",W="12";break;default:j="ansi",W="4;"+y.index}switch(y.type){case 0:const q=A.color.toColorRGB(j==="ansi"?this._themeService.colors.ansi[y.index]:this._themeService.colors[j]);this.coreService.triggerDataEvent(`${I.C0.ESC}]${W};${(0,b.toRgbString)(q)}${I.C1_ESCAPED.ST}`);break;case 1:if(j==="ansi")this._themeService.modifyColors(V=>V.ansi[y.index]=A.channels.toColor(...y.color));else{const V=j;this._themeService.modifyColors(te=>te[V]=A.channels.toColor(...y.color))}break;case 2:this._themeService.restoreColor(y.index)}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange(O){O?!this._accessibilityManager.value&&this._renderService&&(this._accessibilityManager.value=this._instantiationService.createInstance(U.AccessibilityManager,this)):this._accessibilityManager.clear()}_handleTextAreaFocus(O){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(I.C0.ESC+"[I"),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){var O;return(O=this.textarea)==null?void 0:O.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(I.C0.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;const O=this.buffer.ybase+this.buffer.y,y=this.buffer.lines.get(O);if(!y)return;const j=Math.min(this.buffer.x,this.cols-1),W=this._renderService.dimensions.css.cell.height,q=y.getWidth(j),V=this._renderService.dimensions.css.cell.width*q,te=this.buffer.y*this._renderService.dimensions.css.cell.height,ne=j*this._renderService.dimensions.css.cell.width;this.textarea.style.left=ne+"px",this.textarea.style.top=te+"px",this.textarea.style.width=V+"px",this.textarea.style.height=W+"px",this.textarea.style.lineHeight=W+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this.register((0,u.addDisposableDomListener)(this.element,"copy",y=>{this.hasSelection()&&(0,c.copyHandler)(y,this._selectionService)}));const O=y=>(0,c.handlePasteEvent)(y,this.textarea,this.coreService,this.optionsService);this.register((0,u.addDisposableDomListener)(this.textarea,"paste",O)),this.register((0,u.addDisposableDomListener)(this.element,"paste",O)),N.isFirefox?this.register((0,u.addDisposableDomListener)(this.element,"mousedown",y=>{y.button===2&&(0,c.rightClickHandler)(y,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})):this.register((0,u.addDisposableDomListener)(this.element,"contextmenu",y=>{(0,c.rightClickHandler)(y,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})),N.isLinux&&this.register((0,u.addDisposableDomListener)(this.element,"auxclick",y=>{y.button===1&&(0,c.moveTextAreaUnderMouseCursor)(y,this.textarea,this.screenElement)}))}_bindKeys(){this.register((0,u.addDisposableDomListener)(this.textarea,"keyup",O=>this._keyUp(O),!0)),this.register((0,u.addDisposableDomListener)(this.textarea,"keydown",O=>this._keyDown(O),!0)),this.register((0,u.addDisposableDomListener)(this.textarea,"keypress",O=>this._keyPress(O),!0)),this.register((0,u.addDisposableDomListener)(this.textarea,"compositionstart",()=>this._compositionHelper.compositionstart())),this.register((0,u.addDisposableDomListener)(this.textarea,"compositionupdate",O=>this._compositionHelper.compositionupdate(O))),this.register((0,u.addDisposableDomListener)(this.textarea,"compositionend",()=>this._compositionHelper.compositionend())),this.register((0,u.addDisposableDomListener)(this.textarea,"input",O=>this._inputEvent(O),!0)),this.register(this.onRender(()=>this._compositionHelper.updateCompositionElements()))}open(O){var j;if(!O)throw new Error("Terminal requires a parent element.");if(O.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),((j=this.element)==null?void 0:j.ownerDocument.defaultView)&&this._coreBrowserService)return void(this.element.ownerDocument.defaultView!==this._coreBrowserService.window&&(this._coreBrowserService.window=this.element.ownerDocument.defaultView));this._document=O.ownerDocument,this.options.documentOverride&&this.options.documentOverride instanceof Document&&(this._document=this.optionsService.rawOptions.documentOverride),this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),O.appendChild(this.element);const y=this._document.createDocumentFragment();this._viewportElement=this._document.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),y.appendChild(this._viewportElement),this._viewportScrollArea=this._document.createElement("div"),this._viewportScrollArea.classList.add("xterm-scroll-area"),this._viewportElement.appendChild(this._viewportScrollArea),this.screenElement=this._document.createElement("div"),this.screenElement.classList.add("xterm-screen"),this.register((0,u.addDisposableDomListener)(this.screenElement,"mousemove",W=>this.updateCursorStyle(W))),this._helperContainer=this._document.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),y.appendChild(this.screenElement),this.textarea=this._document.createElement("textarea"),this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",_.promptLabel),N.isChromeOS||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._coreBrowserService=this.register(this._instantiationService.createInstance(p.CoreBrowserService,this.textarea,O.ownerDocument.defaultView??window,this._document??typeof window<"u"?window.document:null)),this._instantiationService.setService(C.ICoreBrowserService,this._coreBrowserService),this.register((0,u.addDisposableDomListener)(this.textarea,"focus",W=>this._handleTextAreaFocus(W))),this.register((0,u.addDisposableDomListener)(this.textarea,"blur",()=>this._handleTextAreaBlur())),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(i.CharSizeService,this._document,this._helperContainer),this._instantiationService.setService(C.ICharSizeService,this._charSizeService),this._themeService=this._instantiationService.createInstance(R.ThemeService),this._instantiationService.setService(C.IThemeService,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(a.CharacterJoinerService),this._instantiationService.setService(C.ICharacterJoinerService,this._characterJoinerService),this._renderService=this.register(this._instantiationService.createInstance(m.RenderService,this.rows,this.screenElement)),this._instantiationService.setService(C.IRenderService,this._renderService),this.register(this._renderService.onRenderedViewportChange(W=>this._onRender.fire(W))),this.onResize(W=>this._renderService.resize(W.cols,W.rows)),this._compositionView=this._document.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(r.CompositionHelper,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this._mouseService=this._instantiationService.createInstance(g.MouseService),this._instantiationService.setService(C.IMouseService,this._mouseService),this.linkifier=this.register(this._instantiationService.createInstance(o.Linkifier,this.screenElement)),this.element.appendChild(y);try{this._onWillOpen.fire(this.element)}catch{}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this.viewport=this._instantiationService.createInstance(S.Viewport,this._viewportElement,this._viewportScrollArea),this.viewport.onRequestScrollLines(W=>this.scrollLines(W.amount,W.suppressScrollEvent,1)),this.register(this._inputHandler.onRequestSyncScrollBar(()=>this.viewport.syncScrollArea())),this.register(this.viewport),this.register(this.onCursorMove(()=>{this._renderService.handleCursorMove(),this._syncTextArea()})),this.register(this.onResize(()=>this._renderService.handleResize(this.cols,this.rows))),this.register(this.onBlur(()=>this._renderService.handleBlur())),this.register(this.onFocus(()=>this._renderService.handleFocus())),this.register(this._renderService.onDimensionsChange(()=>this.viewport.syncScrollArea())),this._selectionService=this.register(this._instantiationService.createInstance(d.SelectionService,this.element,this.screenElement,this.linkifier)),this._instantiationService.setService(C.ISelectionService,this._selectionService),this.register(this._selectionService.onRequestScrollLines(W=>this.scrollLines(W.amount,W.suppressScrollEvent))),this.register(this._selectionService.onSelectionChange(()=>this._onSelectionChange.fire())),this.register(this._selectionService.onRequestRedraw(W=>this._renderService.handleSelectionChanged(W.start,W.end,W.columnSelectMode))),this.register(this._selectionService.onLinuxMouseSelection(W=>{this.textarea.value=W,this.textarea.focus(),this.textarea.select()})),this.register(this._onScroll.event(W=>{this.viewport.syncScrollArea(),this._selectionService.refresh()})),this.register((0,u.addDisposableDomListener)(this._viewportElement,"scroll",()=>this._selectionService.refresh())),this.register(this._instantiationService.createInstance(l.BufferDecorationRenderer,this.screenElement)),this.register((0,u.addDisposableDomListener)(this.element,"mousedown",W=>this._selectionService.handleMouseDown(W))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager.value=this._instantiationService.createInstance(U.AccessibilityManager,this)),this.register(this.optionsService.onSpecificOptionChange("screenReaderMode",W=>this._handleScreenReaderModeOptionChange(W))),this.options.overviewRulerWidth&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(s.OverviewRulerRenderer,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRulerWidth",W=>{!this._overviewRulerRenderer&&W&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(s.OverviewRulerRenderer,this._viewportElement,this.screenElement)))}),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(e.DomRenderer,this,this._document,this.element,this.screenElement,this._viewportElement,this._helperContainer,this.linkifier)}bindMouse(){const O=this,y=this.element;function j(V){const te=O._mouseService.getMouseReportCoords(V,O.screenElement);if(!te)return!1;let ne,oe;switch(V.overrideType||V.type){case"mousemove":oe=32,V.buttons===void 0?(ne=3,V.button!==void 0&&(ne=V.button<3?V.button:3)):ne=1&V.buttons?0:4&V.buttons?1:2&V.buttons?2:3;break;case"mouseup":oe=0,ne=V.button<3?V.button:3;break;case"mousedown":oe=1,ne=V.button<3?V.button:3;break;case"wheel":if(O._customWheelEventHandler&&O._customWheelEventHandler(V)===!1||O.viewport.getLinesScrolled(V)===0)return!1;oe=V.deltaY<0?0:1,ne=4;break;default:return!1}return!(oe===void 0||ne===void 0||ne>4)&&O.coreMouseService.triggerMouseEvent({col:te.col,row:te.row,x:te.x,y:te.y,button:ne,action:oe,ctrl:V.ctrlKey,alt:V.altKey,shift:V.shiftKey})}const W={mouseup:null,wheel:null,mousedrag:null,mousemove:null},q={mouseup:V=>(j(V),V.buttons||(this._document.removeEventListener("mouseup",W.mouseup),W.mousedrag&&this._document.removeEventListener("mousemove",W.mousedrag)),this.cancel(V)),wheel:V=>(j(V),this.cancel(V,!0)),mousedrag:V=>{V.buttons&&j(V)},mousemove:V=>{V.buttons||j(V)}};this.register(this.coreMouseService.onProtocolChange(V=>{V?(this.optionsService.rawOptions.logLevel==="debug"&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(V)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),8&V?W.mousemove||(y.addEventListener("mousemove",q.mousemove),W.mousemove=q.mousemove):(y.removeEventListener("mousemove",W.mousemove),W.mousemove=null),16&V?W.wheel||(y.addEventListener("wheel",q.wheel,{passive:!1}),W.wheel=q.wheel):(y.removeEventListener("wheel",W.wheel),W.wheel=null),2&V?W.mouseup||(W.mouseup=q.mouseup):(this._document.removeEventListener("mouseup",W.mouseup),W.mouseup=null),4&V?W.mousedrag||(W.mousedrag=q.mousedrag):(this._document.removeEventListener("mousemove",W.mousedrag),W.mousedrag=null)})),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this.register((0,u.addDisposableDomListener)(y,"mousedown",V=>{if(V.preventDefault(),this.focus(),this.coreMouseService.areMouseEventsActive&&!this._selectionService.shouldForceSelection(V))return j(V),W.mouseup&&this._document.addEventListener("mouseup",W.mouseup),W.mousedrag&&this._document.addEventListener("mousemove",W.mousedrag),this.cancel(V)})),this.register((0,u.addDisposableDomListener)(y,"wheel",V=>{if(!W.wheel){if(this._customWheelEventHandler&&this._customWheelEventHandler(V)===!1)return!1;if(!this.buffer.hasScrollback){const te=this.viewport.getLinesScrolled(V);if(te===0)return;const ne=I.C0.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(V.deltaY<0?"A":"B");let oe="";for(let ae=0;ae<Math.abs(te);ae++)oe+=ne;return this.coreService.triggerDataEvent(oe,!0),this.cancel(V,!0)}return this.viewport.handleWheel(V)?this.cancel(V):void 0}},{passive:!1})),this.register((0,u.addDisposableDomListener)(y,"touchstart",V=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchStart(V),this.cancel(V)},{passive:!0})),this.register((0,u.addDisposableDomListener)(y,"touchmove",V=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchMove(V)?void 0:this.cancel(V)},{passive:!1}))}refresh(O,y){var j;(j=this._renderService)==null||j.refreshRows(O,y)}updateCursorStyle(O){var y;(y=this._selectionService)!=null&&y.shouldColumnSelect(O)?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines(O,y,j=0){var W;j===1?(super.scrollLines(O,y,j),this.refresh(0,this.rows-1)):(W=this.viewport)==null||W.scrollLines(O)}paste(O){(0,c.paste)(O,this.textarea,this.coreService,this.optionsService)}attachCustomKeyEventHandler(O){this._customKeyEventHandler=O}attachCustomWheelEventHandler(O){this._customWheelEventHandler=O}registerLinkProvider(O){return this._linkProviderService.registerLinkProvider(O)}registerCharacterJoiner(O){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");const y=this._characterJoinerService.register(O);return this.refresh(0,this.rows-1),y}deregisterCharacterJoiner(O){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");this._characterJoinerService.deregister(O)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}registerMarker(O){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+O)}registerDecoration(O){return this._decorationService.registerDecoration(O)}hasSelection(){return!!this._selectionService&&this._selectionService.hasSelection}select(O,y,j){this._selectionService.setSelection(O,y,j)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(this._selectionService&&this._selectionService.hasSelection)return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){var O;(O=this._selectionService)==null||O.clearSelection()}selectAll(){var O;(O=this._selectionService)==null||O.selectAll()}selectLines(O,y){var j;(j=this._selectionService)==null||j.selectLines(O,y)}_keyDown(O){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&this._customKeyEventHandler(O)===!1)return!1;const y=this.browser.isMac&&this.options.macOptionIsMeta&&O.altKey;if(!y&&!this._compositionHelper.keydown(O))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this.scrollToBottom(),!1;y||O.key!=="Dead"&&O.key!=="AltGraph"||(this._unprocessedDeadKey=!0);const j=(0,F.evaluateKeyboardEvent)(O,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(O),j.type===3||j.type===2){const W=this.rows-1;return this.scrollLines(j.type===2?-W:W),this.cancel(O,!0)}return j.type===1&&this.selectAll(),!!this._isThirdLevelShift(this.browser,O)||(j.cancel&&this.cancel(O,!0),!j.key||!!(O.key&&!O.ctrlKey&&!O.altKey&&!O.metaKey&&O.key.length===1&&O.key.charCodeAt(0)>=65&&O.key.charCodeAt(0)<=90)||(this._unprocessedDeadKey?(this._unprocessedDeadKey=!1,!0):(j.key!==I.C0.ETX&&j.key!==I.C0.CR||(this.textarea.value=""),this._onKey.fire({key:j.key,domEvent:O}),this._showCursor(),this.coreService.triggerDataEvent(j.key,!0),!this.optionsService.rawOptions.screenReaderMode||O.altKey||O.ctrlKey?this.cancel(O,!0):void(this._keyDownHandled=!0))))}_isThirdLevelShift(O,y){const j=O.isMac&&!this.options.macOptionIsMeta&&y.altKey&&!y.ctrlKey&&!y.metaKey||O.isWindows&&y.altKey&&y.ctrlKey&&!y.metaKey||O.isWindows&&y.getModifierState("AltGraph");return y.type==="keypress"?j:j&&(!y.keyCode||y.keyCode>47)}_keyUp(O){this._keyDownSeen=!1,this._customKeyEventHandler&&this._customKeyEventHandler(O)===!1||(function(y){return y.keyCode===16||y.keyCode===17||y.keyCode===18}(O)||this.focus(),this.updateCursorStyle(O),this._keyPressHandled=!1)}_keyPress(O){let y;if(this._keyPressHandled=!1,this._keyDownHandled||this._customKeyEventHandler&&this._customKeyEventHandler(O)===!1)return!1;if(this.cancel(O),O.charCode)y=O.charCode;else if(O.which===null||O.which===void 0)y=O.keyCode;else{if(O.which===0||O.charCode===0)return!1;y=O.which}return!(!y||(O.altKey||O.ctrlKey||O.metaKey)&&!this._isThirdLevelShift(this.browser,O)||(y=String.fromCharCode(y),this._onKey.fire({key:y,domEvent:O}),this._showCursor(),this.coreService.triggerDataEvent(y,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,0))}_inputEvent(O){if(O.data&&O.inputType==="insertText"&&(!O.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;const y=O.data;return this.coreService.triggerDataEvent(y,!0),this.cancel(O),!0}return!1}resize(O,y){O!==this.cols||y!==this.rows?super.resize(O,y):this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure()}_afterResize(O,y){var j,W;(j=this._charSizeService)==null||j.measure(),(W=this.viewport)==null||W.syncScrollArea(!0)}clear(){var O;if(this.buffer.ybase!==0||this.buffer.y!==0){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let y=1;y<this.rows;y++)this.buffer.lines.push(this.buffer.getBlankLine($.DEFAULT_ATTR_DATA));this._onScroll.fire({position:this.buffer.ydisp,source:0}),(O=this.viewport)==null||O.reset(),this.refresh(0,this.rows-1)}}reset(){var y,j;this.options.rows=this.rows,this.options.cols=this.cols;const O=this._customKeyEventHandler;this._setup(),super.reset(),(y=this._selectionService)==null||y.reset(),this._decorationService.reset(),(j=this.viewport)==null||j.reset(),this._customKeyEventHandler=O,this.refresh(0,this.rows-1)}clearTextureAtlas(){var O;(O=this._renderService)==null||O.clearTextureAtlas()}_reportFocus(){var O;(O=this.element)!=null&&O.classList.contains("focus")?this.coreService.triggerDataEvent(I.C0.ESC+"[I"):this.coreService.triggerDataEvent(I.C0.ESC+"[O")}_reportWindowsOptions(O){if(this._renderService)switch(O){case B.WindowsOptionsReportType.GET_WIN_SIZE_PIXELS:const y=this._renderService.dimensions.css.canvas.width.toFixed(0),j=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${I.C0.ESC}[4;${j};${y}t`);break;case B.WindowsOptionsReportType.GET_CELL_SIZE_PIXELS:const W=this._renderService.dimensions.css.cell.width.toFixed(0),q=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${I.C0.ESC}[6;${q};${W}t`)}}cancel(O,y){if(this.options.cancelEvents||y)return O.preventDefault(),O.stopPropagation(),!1}}t.Terminal=G},9924:(x,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TimeBasedDebouncer=void 0,t.TimeBasedDebouncer=class{constructor(n,c=1e3){this._renderCallback=n,this._debounceThresholdMS=c,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh(n,c,u){this._rowCount=u,n=n!==void 0?n:0,c=c!==void 0?c:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,n):n,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,c):c;const o=Date.now();if(o-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=o,this._innerRefresh();else if(!this._additionalRefreshRequested){const _=o-this._lastRefreshMs,f=this._debounceThresholdMS-_;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout(()=>{this._lastRefreshMs=Date.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0},f)}}_innerRefresh(){if(this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return;const n=Math.max(this._rowStart,0),c=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(n,c)}}},1680:function(x,t,n){var c=this&&this.__decorate||function(r,e,i,a){var p,g=arguments.length,m=g<3?e:a===null?a=Object.getOwnPropertyDescriptor(e,i):a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")m=Reflect.decorate(r,e,i,a);else for(var d=r.length-1;d>=0;d--)(p=r[d])&&(m=(g<3?p(m):g>3?p(e,i,m):p(e,i))||m);return g>3&&m&&Object.defineProperty(e,i,m),m},u=this&&this.__param||function(r,e){return function(i,a){e(i,a,r)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Viewport=void 0;const o=n(3656),_=n(4725),f=n(8460),S=n(844),l=n(2585);let s=t.Viewport=class extends S.Disposable{constructor(r,e,i,a,p,g,m,d){super(),this._viewportElement=r,this._scrollArea=e,this._bufferService=i,this._optionsService=a,this._charSizeService=p,this._renderService=g,this._coreBrowserService=m,this.scrollBarWidth=0,this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._wheelPartialScroll=0,this._refreshAnimationFrame=null,this._ignoreNextScrollEvent=!1,this._smoothScrollState={startTime:0,origin:-1,target:-1},this._onRequestScrollLines=this.register(new f.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this.scrollBarWidth=this._viewportElement.offsetWidth-this._scrollArea.offsetWidth||15,this.register((0,o.addDisposableDomListener)(this._viewportElement,"scroll",this._handleScroll.bind(this))),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate(C=>this._activeBuffer=C.activeBuffer)),this._renderDimensions=this._renderService.dimensions,this.register(this._renderService.onDimensionsChange(C=>this._renderDimensions=C)),this._handleThemeChange(d.colors),this.register(d.onChangeColors(C=>this._handleThemeChange(C))),this.register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.syncScrollArea())),setTimeout(()=>this.syncScrollArea())}_handleThemeChange(r){this._viewportElement.style.backgroundColor=r.background.css}reset(){this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._coreBrowserService.window.requestAnimationFrame(()=>this.syncScrollArea())}_refresh(r){if(r)return this._innerRefresh(),void(this._refreshAnimationFrame!==null&&this._coreBrowserService.window.cancelAnimationFrame(this._refreshAnimationFrame));this._refreshAnimationFrame===null&&(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._charSizeService.height>0){this._currentRowHeight=this._renderDimensions.device.cell.height/this._coreBrowserService.dpr,this._currentDeviceCellHeight=this._renderDimensions.device.cell.height,this._lastRecordedViewportHeight=this._viewportElement.offsetHeight;const e=Math.round(this._currentRowHeight*this._lastRecordedBufferLength)+(this._lastRecordedViewportHeight-this._renderDimensions.css.canvas.height);this._lastRecordedBufferHeight!==e&&(this._lastRecordedBufferHeight=e,this._scrollArea.style.height=this._lastRecordedBufferHeight+"px")}const r=this._bufferService.buffer.ydisp*this._currentRowHeight;this._viewportElement.scrollTop!==r&&(this._ignoreNextScrollEvent=!0,this._viewportElement.scrollTop=r),this._refreshAnimationFrame=null}syncScrollArea(r=!1){if(this._lastRecordedBufferLength!==this._bufferService.buffer.lines.length)return this._lastRecordedBufferLength=this._bufferService.buffer.lines.length,void this._refresh(r);this._lastRecordedViewportHeight===this._renderService.dimensions.css.canvas.height&&this._lastScrollTop===this._activeBuffer.ydisp*this._currentRowHeight&&this._renderDimensions.device.cell.height===this._currentDeviceCellHeight||this._refresh(r)}_handleScroll(r){if(this._lastScrollTop=this._viewportElement.scrollTop,!this._viewportElement.offsetParent)return;if(this._ignoreNextScrollEvent)return this._ignoreNextScrollEvent=!1,void this._onRequestScrollLines.fire({amount:0,suppressScrollEvent:!0});const e=Math.round(this._lastScrollTop/this._currentRowHeight)-this._bufferService.buffer.ydisp;this._onRequestScrollLines.fire({amount:e,suppressScrollEvent:!0})}_smoothScroll(){if(this._isDisposed||this._smoothScrollState.origin===-1||this._smoothScrollState.target===-1)return;const r=this._smoothScrollPercent();this._viewportElement.scrollTop=this._smoothScrollState.origin+Math.round(r*(this._smoothScrollState.target-this._smoothScrollState.origin)),r<1?this._coreBrowserService.window.requestAnimationFrame(()=>this._smoothScroll()):this._clearSmoothScrollState()}_smoothScrollPercent(){return this._optionsService.rawOptions.smoothScrollDuration&&this._smoothScrollState.startTime?Math.max(Math.min((Date.now()-this._smoothScrollState.startTime)/this._optionsService.rawOptions.smoothScrollDuration,1),0):1}_clearSmoothScrollState(){this._smoothScrollState.startTime=0,this._smoothScrollState.origin=-1,this._smoothScrollState.target=-1}_bubbleScroll(r,e){const i=this._viewportElement.scrollTop+this._lastRecordedViewportHeight;return!(e<0&&this._viewportElement.scrollTop!==0||e>0&&i<this._lastRecordedBufferHeight)||(r.cancelable&&r.preventDefault(),!1)}handleWheel(r){const e=this._getPixelsScrolled(r);return e!==0&&(this._optionsService.rawOptions.smoothScrollDuration?(this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target===-1?this._smoothScrollState.target=this._viewportElement.scrollTop+e:this._smoothScrollState.target+=e,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()):this._viewportElement.scrollTop+=e,this._bubbleScroll(r,e))}scrollLines(r){if(r!==0)if(this._optionsService.rawOptions.smoothScrollDuration){const e=r*this._currentRowHeight;this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target=this._smoothScrollState.origin+e,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()}else this._onRequestScrollLines.fire({amount:r,suppressScrollEvent:!1})}_getPixelsScrolled(r){if(r.deltaY===0||r.shiftKey)return 0;let e=this._applyScrollModifier(r.deltaY,r);return r.deltaMode===WheelEvent.DOM_DELTA_LINE?e*=this._currentRowHeight:r.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(e*=this._currentRowHeight*this._bufferService.rows),e}getBufferElements(r,e){var d;let i,a="";const p=[],g=e??this._bufferService.buffer.lines.length,m=this._bufferService.buffer.lines;for(let C=r;C<g;C++){const R=m.get(C);if(!R)continue;const A=(d=m.get(C+1))==null?void 0:d.isWrapped;if(a+=R.translateToString(!A),!A||C===m.length-1){const T=document.createElement("div");T.textContent=a,p.push(T),a.length>0&&(i=T),a=""}}return{bufferElements:p,cursorElement:i}}getLinesScrolled(r){if(r.deltaY===0||r.shiftKey)return 0;let e=this._applyScrollModifier(r.deltaY,r);return r.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(e/=this._currentRowHeight+0,this._wheelPartialScroll+=e,e=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):r.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(e*=this._bufferService.rows),e}_applyScrollModifier(r,e){const i=this._optionsService.rawOptions.fastScrollModifier;return i==="alt"&&e.altKey||i==="ctrl"&&e.ctrlKey||i==="shift"&&e.shiftKey?r*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:r*this._optionsService.rawOptions.scrollSensitivity}handleTouchStart(r){this._lastTouchY=r.touches[0].pageY}handleTouchMove(r){const e=this._lastTouchY-r.touches[0].pageY;return this._lastTouchY=r.touches[0].pageY,e!==0&&(this._viewportElement.scrollTop+=e,this._bubbleScroll(r,e))}};t.Viewport=s=c([u(2,l.IBufferService),u(3,l.IOptionsService),u(4,_.ICharSizeService),u(5,_.IRenderService),u(6,_.ICoreBrowserService),u(7,_.IThemeService)],s)},3107:function(x,t,n){var c=this&&this.__decorate||function(l,s,r,e){var i,a=arguments.length,p=a<3?s:e===null?e=Object.getOwnPropertyDescriptor(s,r):e;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")p=Reflect.decorate(l,s,r,e);else for(var g=l.length-1;g>=0;g--)(i=l[g])&&(p=(a<3?i(p):a>3?i(s,r,p):i(s,r))||p);return a>3&&p&&Object.defineProperty(s,r,p),p},u=this&&this.__param||function(l,s){return function(r,e){s(r,e,l)}};Object.defineProperty(t,"__esModule",{value:!0}),t.BufferDecorationRenderer=void 0;const o=n(4725),_=n(844),f=n(2585);let S=t.BufferDecorationRenderer=class extends _.Disposable{constructor(l,s,r,e,i){super(),this._screenElement=l,this._bufferService=s,this._coreBrowserService=r,this._decorationService=e,this._renderService=i,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this.register(this._renderService.onRenderedViewportChange(()=>this._doRefreshDecorations())),this.register(this._renderService.onDimensionsChange(()=>{this._dimensionsChanged=!0,this._queueRefresh()})),this.register(this._coreBrowserService.onDprChange(()=>this._queueRefresh())),this.register(this._bufferService.buffers.onBufferActivate(()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt})),this.register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh())),this.register(this._decorationService.onDecorationRemoved(a=>this._removeDecoration(a))),this.register((0,_.toDisposable)(()=>{this._container.remove(),this._decorationElements.clear()}))}_queueRefresh(){this._animationFrame===void 0&&(this._animationFrame=this._renderService.addRefreshCallback(()=>{this._doRefreshDecorations(),this._animationFrame=void 0}))}_doRefreshDecorations(){for(const l of this._decorationService.decorations)this._renderDecoration(l);this._dimensionsChanged=!1}_renderDecoration(l){this._refreshStyle(l),this._dimensionsChanged&&this._refreshXPosition(l)}_createElement(l){var e;const s=this._coreBrowserService.mainDocument.createElement("div");s.classList.add("xterm-decoration"),s.classList.toggle("xterm-decoration-top-layer",((e=l==null?void 0:l.options)==null?void 0:e.layer)==="top"),s.style.width=`${Math.round((l.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,s.style.height=(l.options.height||1)*this._renderService.dimensions.css.cell.height+"px",s.style.top=(l.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height+"px",s.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;const r=l.options.x??0;return r&&r>this._bufferService.cols&&(s.style.display="none"),this._refreshXPosition(l,s),s}_refreshStyle(l){const s=l.marker.line-this._bufferService.buffers.active.ydisp;if(s<0||s>=this._bufferService.rows)l.element&&(l.element.style.display="none",l.onRenderEmitter.fire(l.element));else{let r=this._decorationElements.get(l);r||(r=this._createElement(l),l.element=r,this._decorationElements.set(l,r),this._container.appendChild(r),l.onDispose(()=>{this._decorationElements.delete(l),r.remove()})),r.style.top=s*this._renderService.dimensions.css.cell.height+"px",r.style.display=this._altBufferIsActive?"none":"block",l.onRenderEmitter.fire(r)}}_refreshXPosition(l,s=l.element){if(!s)return;const r=l.options.x??0;(l.options.anchor||"left")==="right"?s.style.right=r?r*this._renderService.dimensions.css.cell.width+"px":"":s.style.left=r?r*this._renderService.dimensions.css.cell.width+"px":""}_removeDecoration(l){var s;(s=this._decorationElements.get(l))==null||s.remove(),this._decorationElements.delete(l),l.dispose()}};t.BufferDecorationRenderer=S=c([u(1,f.IBufferService),u(2,o.ICoreBrowserService),u(3,f.IDecorationService),u(4,o.IRenderService)],S)},5871:(x,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ColorZoneStore=void 0,t.ColorZoneStore=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration(n){if(n.options.overviewRulerOptions){for(const c of this._zones)if(c.color===n.options.overviewRulerOptions.color&&c.position===n.options.overviewRulerOptions.position){if(this._lineIntersectsZone(c,n.marker.line))return;if(this._lineAdjacentToZone(c,n.marker.line,n.options.overviewRulerOptions.position))return void this._addLineToZone(c,n.marker.line)}if(this._zonePoolIndex<this._zonePool.length)return this._zonePool[this._zonePoolIndex].color=n.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=n.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=n.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=n.marker.line,void this._zones.push(this._zonePool[this._zonePoolIndex++]);this._zones.push({color:n.options.overviewRulerOptions.color,position:n.options.overviewRulerOptions.position,startBufferLine:n.marker.line,endBufferLine:n.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding(n){this._linePadding=n}_lineIntersectsZone(n,c){return c>=n.startBufferLine&&c<=n.endBufferLine}_lineAdjacentToZone(n,c,u){return c>=n.startBufferLine-this._linePadding[u||"full"]&&c<=n.endBufferLine+this._linePadding[u||"full"]}_addLineToZone(n,c){n.startBufferLine=Math.min(n.startBufferLine,c),n.endBufferLine=Math.max(n.endBufferLine,c)}}},5744:function(x,t,n){var c=this&&this.__decorate||function(i,a,p,g){var m,d=arguments.length,C=d<3?a:g===null?g=Object.getOwnPropertyDescriptor(a,p):g;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")C=Reflect.decorate(i,a,p,g);else for(var R=i.length-1;R>=0;R--)(m=i[R])&&(C=(d<3?m(C):d>3?m(a,p,C):m(a,p))||C);return d>3&&C&&Object.defineProperty(a,p,C),C},u=this&&this.__param||function(i,a){return function(p,g){a(p,g,i)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OverviewRulerRenderer=void 0;const o=n(5871),_=n(4725),f=n(844),S=n(2585),l={full:0,left:0,center:0,right:0},s={full:0,left:0,center:0,right:0},r={full:0,left:0,center:0,right:0};let e=t.OverviewRulerRenderer=class extends f.Disposable{get _width(){return this._optionsService.options.overviewRulerWidth||0}constructor(i,a,p,g,m,d,C){var A;super(),this._viewportElement=i,this._screenElement=a,this._bufferService=p,this._decorationService=g,this._renderService=m,this._optionsService=d,this._coreBrowserService=C,this._colorZoneStore=new o.ColorZoneStore,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),(A=this._viewportElement.parentElement)==null||A.insertBefore(this._canvas,this._viewportElement);const R=this._canvas.getContext("2d");if(!R)throw new Error("Ctx cannot be null");this._ctx=R,this._registerDecorationListeners(),this._registerBufferChangeListeners(),this._registerDimensionChangeListeners(),this.register((0,f.toDisposable)(()=>{var T;(T=this._canvas)==null||T.remove()}))}_registerDecorationListeners(){this.register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh(void 0,!0))),this.register(this._decorationService.onDecorationRemoved(()=>this._queueRefresh(void 0,!0)))}_registerBufferChangeListeners(){this.register(this._renderService.onRenderedViewportChange(()=>this._queueRefresh())),this.register(this._bufferService.buffers.onBufferActivate(()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"})),this.register(this._bufferService.onScroll(()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())}))}_registerDimensionChangeListeners(){this.register(this._renderService.onRender(()=>{this._containerHeight&&this._containerHeight===this._screenElement.clientHeight||(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)})),this.register(this._optionsService.onSpecificOptionChange("overviewRulerWidth",()=>this._queueRefresh(!0))),this.register(this._coreBrowserService.onDprChange(()=>this._queueRefresh(!0))),this._queueRefresh(!0)}_refreshDrawConstants(){const i=Math.floor(this._canvas.width/3),a=Math.ceil(this._canvas.width/3);s.full=this._canvas.width,s.left=i,s.center=a,s.right=i,this._refreshDrawHeightConstants(),r.full=0,r.left=0,r.center=s.left,r.right=s.left+s.center}_refreshDrawHeightConstants(){l.full=Math.round(2*this._coreBrowserService.dpr);const i=this._canvas.height/this._bufferService.buffer.lines.length,a=Math.round(Math.max(Math.min(i,12),6)*this._coreBrowserService.dpr);l.left=a,l.center=a,l.right=a}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*l.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*l.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*l.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*l.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowserService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowserService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();for(const a of this._decorationService.decorations)this._colorZoneStore.addDecoration(a);this._ctx.lineWidth=1;const i=this._colorZoneStore.zones;for(const a of i)a.position!=="full"&&this._renderColorZone(a);for(const a of i)a.position==="full"&&this._renderColorZone(a);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderColorZone(i){this._ctx.fillStyle=i.color,this._ctx.fillRect(r[i.position||"full"],Math.round((this._canvas.height-1)*(i.startBufferLine/this._bufferService.buffers.active.lines.length)-l[i.position||"full"]/2),s[i.position||"full"],Math.round((this._canvas.height-1)*((i.endBufferLine-i.startBufferLine)/this._bufferService.buffers.active.lines.length)+l[i.position||"full"]))}_queueRefresh(i,a){this._shouldUpdateDimensions=i||this._shouldUpdateDimensions,this._shouldUpdateAnchor=a||this._shouldUpdateAnchor,this._animationFrame===void 0&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._refreshDecorations(),this._animationFrame=void 0}))}};t.OverviewRulerRenderer=e=c([u(2,S.IBufferService),u(3,S.IDecorationService),u(4,_.IRenderService),u(5,S.IOptionsService),u(6,_.ICoreBrowserService)],e)},2950:function(x,t,n){var c=this&&this.__decorate||function(l,s,r,e){var i,a=arguments.length,p=a<3?s:e===null?e=Object.getOwnPropertyDescriptor(s,r):e;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")p=Reflect.decorate(l,s,r,e);else for(var g=l.length-1;g>=0;g--)(i=l[g])&&(p=(a<3?i(p):a>3?i(s,r,p):i(s,r))||p);return a>3&&p&&Object.defineProperty(s,r,p),p},u=this&&this.__param||function(l,s){return function(r,e){s(r,e,l)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CompositionHelper=void 0;const o=n(4725),_=n(2585),f=n(2584);let S=t.CompositionHelper=class{get isComposing(){return this._isComposing}constructor(l,s,r,e,i,a){this._textarea=l,this._compositionView=s,this._bufferService=r,this._optionsService=e,this._coreService=i,this._renderService=a,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate(l){this._compositionView.textContent=l.data,this.updateCompositionElements(),setTimeout(()=>{this._compositionPosition.end=this._textarea.value.length},0)}compositionend(){this._finalizeComposition(!0)}keydown(l){if(this._isComposing||this._isSendingComposition){if(l.keyCode===229||l.keyCode===16||l.keyCode===17||l.keyCode===18)return!1;this._finalizeComposition(!1)}return l.keyCode!==229||(this._handleAnyTextareaChanges(),!1)}_finalizeComposition(l){if(this._compositionView.classList.remove("active"),this._isComposing=!1,l){const s={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout(()=>{if(this._isSendingComposition){let r;this._isSendingComposition=!1,s.start+=this._dataAlreadySent.length,r=this._isComposing?this._textarea.value.substring(s.start,s.end):this._textarea.value.substring(s.start),r.length>0&&this._coreService.triggerDataEvent(r,!0)}},0)}else{this._isSendingComposition=!1;const s=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(s,!0)}}_handleAnyTextareaChanges(){const l=this._textarea.value;setTimeout(()=>{if(!this._isComposing){const s=this._textarea.value,r=s.replace(l,"");this._dataAlreadySent=r,s.length>l.length?this._coreService.triggerDataEvent(r,!0):s.length<l.length?this._coreService.triggerDataEvent(`${f.C0.DEL}`,!0):s.length===l.length&&s!==l&&this._coreService.triggerDataEvent(s,!0)}},0)}updateCompositionElements(l){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){const s=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),r=this._renderService.dimensions.css.cell.height,e=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,i=s*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=i+"px",this._compositionView.style.top=e+"px",this._compositionView.style.height=r+"px",this._compositionView.style.lineHeight=r+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";const a=this._compositionView.getBoundingClientRect();this._textarea.style.left=i+"px",this._textarea.style.top=e+"px",this._textarea.style.width=Math.max(a.width,1)+"px",this._textarea.style.height=Math.max(a.height,1)+"px",this._textarea.style.lineHeight=a.height+"px"}l||setTimeout(()=>this.updateCompositionElements(!0),0)}}};t.CompositionHelper=S=c([u(2,_.IBufferService),u(3,_.IOptionsService),u(4,_.ICoreService),u(5,o.IRenderService)],S)},9806:(x,t)=>{function n(c,u,o){const _=o.getBoundingClientRect(),f=c.getComputedStyle(o),S=parseInt(f.getPropertyValue("padding-left")),l=parseInt(f.getPropertyValue("padding-top"));return[u.clientX-_.left-S,u.clientY-_.top-l]}Object.defineProperty(t,"__esModule",{value:!0}),t.getCoords=t.getCoordsRelativeToElement=void 0,t.getCoordsRelativeToElement=n,t.getCoords=function(c,u,o,_,f,S,l,s,r){if(!S)return;const e=n(c,u,o);return e?(e[0]=Math.ceil((e[0]+(r?l/2:0))/l),e[1]=Math.ceil(e[1]/s),e[0]=Math.min(Math.max(e[0],1),_+(r?1:0)),e[1]=Math.min(Math.max(e[1],1),f),e):void 0}},9504:(x,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.moveToCellSequence=void 0;const c=n(2584);function u(s,r,e,i){const a=s-o(s,e),p=r-o(r,e),g=Math.abs(a-p)-function(m,d,C){var L;let R=0;const A=m-o(m,C),T=d-o(d,C);for(let H=0;H<Math.abs(A-T);H++){const N=_(m,d)==="A"?-1:1;(L=C.buffer.lines.get(A+N*H))!=null&&L.isWrapped&&R++}return R}(s,r,e);return l(g,S(_(s,r),i))}function o(s,r){let e=0,i=r.buffer.lines.get(s),a=i==null?void 0:i.isWrapped;for(;a&&s>=0&&s<r.rows;)e++,i=r.buffer.lines.get(--s),a=i==null?void 0:i.isWrapped;return e}function _(s,r){return s>r?"A":"B"}function f(s,r,e,i,a,p){let g=s,m=r,d="";for(;g!==e||m!==i;)g+=a?1:-1,a&&g>p.cols-1?(d+=p.buffer.translateBufferLineToString(m,!1,s,g),g=0,s=0,m++):!a&&g<0&&(d+=p.buffer.translateBufferLineToString(m,!1,0,s+1),g=p.cols-1,s=g,m--);return d+p.buffer.translateBufferLineToString(m,!1,s,g)}function S(s,r){const e=r?"O":"[";return c.C0.ESC+e+s}function l(s,r){s=Math.floor(s);let e="";for(let i=0;i<s;i++)e+=r;return e}t.moveToCellSequence=function(s,r,e,i){const a=e.buffer.x,p=e.buffer.y;if(!e.buffer.hasScrollback)return function(d,C,R,A,T,L){return u(C,A,T,L).length===0?"":l(f(d,C,d,C-o(C,T),!1,T).length,S("D",L))}(a,p,0,r,e,i)+u(p,r,e,i)+function(d,C,R,A,T,L){let H;H=u(C,A,T,L).length>0?A-o(A,T):C;const N=A,$=function(I,F,b,E,D,B){let U;return U=u(b,E,D,B).length>0?E-o(E,D):F,I<b&&U<=E||I>=b&&U<E?"C":"D"}(d,C,R,A,T,L);return l(f(d,H,R,N,$==="C",T).length,S($,L))}(a,p,s,r,e,i);let g;if(p===r)return g=a>s?"D":"C",l(Math.abs(a-s),S(g,i));g=p>r?"D":"C";const m=Math.abs(p-r);return l(function(d,C){return C.cols-d}(p>r?s:a,e)+(m-1)*e.cols+1+((p>r?a:s)-1),S(g,i))}},1296:function(x,t,n){var c=this&&this.__decorate||function(L,H,N,$){var I,F=arguments.length,b=F<3?H:$===null?$=Object.getOwnPropertyDescriptor(H,N):$;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(L,H,N,$);else for(var E=L.length-1;E>=0;E--)(I=L[E])&&(b=(F<3?I(b):F>3?I(H,N,b):I(H,N))||b);return F>3&&b&&Object.defineProperty(H,N,b),b},u=this&&this.__param||function(L,H){return function(N,$){H(N,$,L)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DomRenderer=void 0;const o=n(3787),_=n(2550),f=n(2223),S=n(6171),l=n(6052),s=n(4725),r=n(8055),e=n(8460),i=n(844),a=n(2585),p="xterm-dom-renderer-owner-",g="xterm-rows",m="xterm-fg-",d="xterm-bg-",C="xterm-focus",R="xterm-selection";let A=1,T=t.DomRenderer=class extends i.Disposable{constructor(L,H,N,$,I,F,b,E,D,B,U,z,G){super(),this._terminal=L,this._document=H,this._element=N,this._screenElement=$,this._viewportElement=I,this._helperContainer=F,this._linkifier2=b,this._charSizeService=D,this._optionsService=B,this._bufferService=U,this._coreBrowserService=z,this._themeService=G,this._terminalClass=A++,this._rowElements=[],this._selectionRenderModel=(0,l.createSelectionRenderModel)(),this.onRequestRedraw=this.register(new e.EventEmitter).event,this._rowContainer=this._document.createElement("div"),this._rowContainer.classList.add(g),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=this._document.createElement("div"),this._selectionContainer.classList.add(R),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions=(0,S.createRenderDimensions)(),this._updateDimensions(),this.register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this.register(this._themeService.onChangeColors(J=>this._injectCss(J))),this._injectCss(this._themeService.colors),this._rowFactory=E.createInstance(o.DomRendererRowFactory,document),this._element.classList.add(p+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this.register(this._linkifier2.onShowLinkUnderline(J=>this._handleLinkHover(J))),this.register(this._linkifier2.onHideLinkUnderline(J=>this._handleLinkLeave(J))),this.register((0,i.toDisposable)(()=>{this._element.classList.remove(p+this._terminalClass),this._rowContainer.remove(),this._selectionContainer.remove(),this._widthCache.dispose(),this._themeStyleElement.remove(),this._dimensionsStyleElement.remove()})),this._widthCache=new _.WidthCache(this._document,this._helperContainer),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}_updateDimensions(){const L=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*L,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*L),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/L),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/L),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;for(const N of this._rowElements)N.style.width=`${this.dimensions.css.canvas.width}px`,N.style.height=`${this.dimensions.css.cell.height}px`,N.style.lineHeight=`${this.dimensions.css.cell.height}px`,N.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));const H=`${this._terminalSelector} .${g} span { display: inline-block; height: 100%; vertical-align: top;}`;this._dimensionsStyleElement.textContent=H,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss(L){this._themeStyleElement||(this._themeStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let H=`${this._terminalSelector} .${g} { color: ${L.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px; font-kerning: none; white-space: pre}`;H+=`${this._terminalSelector} .${g} .xterm-dim { color: ${r.color.multiplyOpacity(L.foreground,.5).css};}`,H+=`${this._terminalSelector} span:not(.xterm-bold) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.xterm-bold { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.xterm-italic { font-style: italic;}`;const N=`blink_underline_${this._terminalClass}`,$=`blink_bar_${this._terminalClass}`,I=`blink_block_${this._terminalClass}`;H+=`@keyframes ${N} { 50% {  border-bottom-style: hidden; }}`,H+=`@keyframes ${$} { 50% {  box-shadow: none; }}`,H+=`@keyframes ${I} { 0% {  background-color: ${L.cursor.css};  color: ${L.cursorAccent.css}; } 50% {  background-color: inherit;  color: ${L.cursor.css}; }}`,H+=`${this._terminalSelector} .${g}.${C} .xterm-cursor.xterm-cursor-blink.xterm-cursor-underline { animation: ${N} 1s step-end infinite;}${this._terminalSelector} .${g}.${C} .xterm-cursor.xterm-cursor-blink.xterm-cursor-bar { animation: ${$} 1s step-end infinite;}${this._terminalSelector} .${g}.${C} .xterm-cursor.xterm-cursor-blink.xterm-cursor-block { animation: ${I} 1s step-end infinite;}${this._terminalSelector} .${g} .xterm-cursor.xterm-cursor-block { background-color: ${L.cursor.css}; color: ${L.cursorAccent.css};}${this._terminalSelector} .${g} .xterm-cursor.xterm-cursor-block:not(.xterm-cursor-blink) { background-color: ${L.cursor.css} !important; color: ${L.cursorAccent.css} !important;}${this._terminalSelector} .${g} .xterm-cursor.xterm-cursor-outline { outline: 1px solid ${L.cursor.css}; outline-offset: -1px;}${this._terminalSelector} .${g} .xterm-cursor.xterm-cursor-bar { box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${L.cursor.css} inset;}${this._terminalSelector} .${g} .xterm-cursor.xterm-cursor-underline { border-bottom: 1px ${L.cursor.css}; border-bottom-style: solid; height: calc(100% - 1px);}`,H+=`${this._terminalSelector} .${R} { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .${R} div { position: absolute; background-color: ${L.selectionBackgroundOpaque.css};}${this._terminalSelector} .${R} div { position: absolute; background-color: ${L.selectionInactiveBackgroundOpaque.css};}`;for(const[F,b]of L.ansi.entries())H+=`${this._terminalSelector} .${m}${F} { color: ${b.css}; }${this._terminalSelector} .${m}${F}.xterm-dim { color: ${r.color.multiplyOpacity(b,.5).css}; }${this._terminalSelector} .${d}${F} { background-color: ${b.css}; }`;H+=`${this._terminalSelector} .${m}${f.INVERTED_DEFAULT_COLOR} { color: ${r.color.opaque(L.background).css}; }${this._terminalSelector} .${m}${f.INVERTED_DEFAULT_COLOR}.xterm-dim { color: ${r.color.multiplyOpacity(r.color.opaque(L.background),.5).css}; }${this._terminalSelector} .${d}${f.INVERTED_DEFAULT_COLOR} { background-color: ${L.foreground.css}; }`,this._themeStyleElement.textContent=H}_setDefaultSpacing(){const L=this.dimensions.css.cell.width-this._widthCache.get("W",!1,!1);this._rowContainer.style.letterSpacing=`${L}px`,this._rowFactory.defaultSpacing=L}handleDevicePixelRatioChange(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}_refreshRowElements(L,H){for(let N=this._rowElements.length;N<=H;N++){const $=this._document.createElement("div");this._rowContainer.appendChild($),this._rowElements.push($)}for(;this._rowElements.length>H;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize(L,H){this._refreshRowElements(L,H),this._updateDimensions(),this.handleSelectionChanged(this._selectionRenderModel.selectionStart,this._selectionRenderModel.selectionEnd,this._selectionRenderModel.columnSelectMode)}handleCharSizeChanged(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}handleBlur(){this._rowContainer.classList.remove(C),this.renderRows(0,this._bufferService.rows-1)}handleFocus(){this._rowContainer.classList.add(C),this.renderRows(this._bufferService.buffer.y,this._bufferService.buffer.y)}handleSelectionChanged(L,H,N){if(this._selectionContainer.replaceChildren(),this._rowFactory.handleSelectionChanged(L,H,N),this.renderRows(0,this._bufferService.rows-1),!L||!H)return;this._selectionRenderModel.update(this._terminal,L,H,N);const $=this._selectionRenderModel.viewportStartRow,I=this._selectionRenderModel.viewportEndRow,F=this._selectionRenderModel.viewportCappedStartRow,b=this._selectionRenderModel.viewportCappedEndRow;if(F>=this._bufferService.rows||b<0)return;const E=this._document.createDocumentFragment();if(N){const D=L[0]>H[0];E.appendChild(this._createSelectionElement(F,D?H[0]:L[0],D?L[0]:H[0],b-F+1))}else{const D=$===F?L[0]:0,B=F===I?H[0]:this._bufferService.cols;E.appendChild(this._createSelectionElement(F,D,B));const U=b-F-1;if(E.appendChild(this._createSelectionElement(F+1,0,this._bufferService.cols,U)),F!==b){const z=I===b?H[0]:this._bufferService.cols;E.appendChild(this._createSelectionElement(b,0,z))}}this._selectionContainer.appendChild(E)}_createSelectionElement(L,H,N,$=1){const I=this._document.createElement("div"),F=H*this.dimensions.css.cell.width;let b=this.dimensions.css.cell.width*(N-H);return F+b>this.dimensions.css.canvas.width&&(b=this.dimensions.css.canvas.width-F),I.style.height=$*this.dimensions.css.cell.height+"px",I.style.top=L*this.dimensions.css.cell.height+"px",I.style.left=`${F}px`,I.style.width=`${b}px`,I}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions(),this._injectCss(this._themeService.colors),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}clear(){for(const L of this._rowElements)L.replaceChildren()}renderRows(L,H){const N=this._bufferService.buffer,$=N.ybase+N.y,I=Math.min(N.x,this._bufferService.cols-1),F=this._optionsService.rawOptions.cursorBlink,b=this._optionsService.rawOptions.cursorStyle,E=this._optionsService.rawOptions.cursorInactiveStyle;for(let D=L;D<=H;D++){const B=D+N.ydisp,U=this._rowElements[D],z=N.lines.get(B);if(!U||!z)break;U.replaceChildren(...this._rowFactory.createRow(z,B,B===$,b,E,I,F,this.dimensions.css.cell.width,this._widthCache,-1,-1))}}get _terminalSelector(){return`.${p}${this._terminalClass}`}_handleLinkHover(L){this._setCellUnderline(L.x1,L.x2,L.y1,L.y2,L.cols,!0)}_handleLinkLeave(L){this._setCellUnderline(L.x1,L.x2,L.y1,L.y2,L.cols,!1)}_setCellUnderline(L,H,N,$,I,F){N<0&&(L=0),$<0&&(H=0);const b=this._bufferService.rows-1;N=Math.max(Math.min(N,b),0),$=Math.max(Math.min($,b),0),I=Math.min(I,this._bufferService.cols);const E=this._bufferService.buffer,D=E.ybase+E.y,B=Math.min(E.x,I-1),U=this._optionsService.rawOptions.cursorBlink,z=this._optionsService.rawOptions.cursorStyle,G=this._optionsService.rawOptions.cursorInactiveStyle;for(let J=N;J<=$;++J){const O=J+E.ydisp,y=this._rowElements[J],j=E.lines.get(O);if(!y||!j)break;y.replaceChildren(...this._rowFactory.createRow(j,O,O===D,z,G,B,U,this.dimensions.css.cell.width,this._widthCache,F?J===N?L:0:-1,F?(J===$?H:I)-1:-1))}}};t.DomRenderer=T=c([u(7,a.IInstantiationService),u(8,s.ICharSizeService),u(9,a.IOptionsService),u(10,a.IBufferService),u(11,s.ICoreBrowserService),u(12,s.IThemeService)],T)},3787:function(x,t,n){var c=this&&this.__decorate||function(g,m,d,C){var R,A=arguments.length,T=A<3?m:C===null?C=Object.getOwnPropertyDescriptor(m,d):C;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")T=Reflect.decorate(g,m,d,C);else for(var L=g.length-1;L>=0;L--)(R=g[L])&&(T=(A<3?R(T):A>3?R(m,d,T):R(m,d))||T);return A>3&&T&&Object.defineProperty(m,d,T),T},u=this&&this.__param||function(g,m){return function(d,C){m(d,C,g)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DomRendererRowFactory=void 0;const o=n(2223),_=n(643),f=n(511),S=n(2585),l=n(8055),s=n(4725),r=n(4269),e=n(6171),i=n(3734);let a=t.DomRendererRowFactory=class{constructor(g,m,d,C,R,A,T){this._document=g,this._characterJoinerService=m,this._optionsService=d,this._coreBrowserService=C,this._coreService=R,this._decorationService=A,this._themeService=T,this._workCell=new f.CellData,this._columnSelectMode=!1,this.defaultSpacing=0}handleSelectionChanged(g,m,d){this._selectionStart=g,this._selectionEnd=m,this._columnSelectMode=d}createRow(g,m,d,C,R,A,T,L,H,N,$){const I=[],F=this._characterJoinerService.getJoinedCharacters(m),b=this._themeService.colors;let E,D=g.getNoBgTrimmedLength();d&&D<A+1&&(D=A+1);let B=0,U="",z=0,G=0,J=0,O=!1,y=0,j=!1,W=0;const q=[],V=N!==-1&&$!==-1;for(let te=0;te<D;te++){g.loadCell(te,this._workCell);let ne=this._workCell.getWidth();if(ne===0)continue;let oe=!1,ae=te,Z=this._workCell;if(F.length>0&&te===F[0][0]){oe=!0;const se=F.shift();Z=new r.JoinedCellData(this._workCell,g.translateToString(!0,se[0],se[1]),se[1]-se[0]),ae=se[1]-1,ne=Z.getWidth()}const Ee=this._isCellInSelection(te,m),Y=d&&te===A,Oe=V&&te>=N&&te<=$;let de=!1;this._decorationService.forEachDecorationAtCell(te,m,void 0,se=>{de=!0});let re=Z.getChars()||_.WHITESPACE_CELL_CHAR;if(re===" "&&(Z.isUnderline()||Z.isOverline())&&(re="\xA0"),W=ne*L-H.get(re,Z.isBold(),Z.isItalic()),E){if(B&&(Ee&&j||!Ee&&!j&&Z.bg===z)&&(Ee&&j&&b.selectionForeground||Z.fg===G)&&Z.extended.ext===J&&Oe===O&&W===y&&!Y&&!oe&&!de){Z.isInvisible()?U+=_.WHITESPACE_CELL_CHAR:U+=re,B++;continue}B&&(E.textContent=U),E=this._document.createElement("span"),B=0,U=""}else E=this._document.createElement("span");if(z=Z.bg,G=Z.fg,J=Z.extended.ext,O=Oe,y=W,j=Ee,oe&&A>=te&&A<=ae&&(A=te),!this._coreService.isCursorHidden&&Y&&this._coreService.isCursorInitialized){if(q.push("xterm-cursor"),this._coreBrowserService.isFocused)T&&q.push("xterm-cursor-blink"),q.push(C==="bar"?"xterm-cursor-bar":C==="underline"?"xterm-cursor-underline":"xterm-cursor-block");else if(R)switch(R){case"outline":q.push("xterm-cursor-outline");break;case"block":q.push("xterm-cursor-block");break;case"bar":q.push("xterm-cursor-bar");break;case"underline":q.push("xterm-cursor-underline")}}if(Z.isBold()&&q.push("xterm-bold"),Z.isItalic()&&q.push("xterm-italic"),Z.isDim()&&q.push("xterm-dim"),U=Z.isInvisible()?_.WHITESPACE_CELL_CHAR:Z.getChars()||_.WHITESPACE_CELL_CHAR,Z.isUnderline()&&(q.push(`xterm-underline-${Z.extended.underlineStyle}`),U===" "&&(U="\xA0"),!Z.isUnderlineColorDefault()))if(Z.isUnderlineColorRGB())E.style.textDecorationColor=`rgb(${i.AttributeData.toColorRGB(Z.getUnderlineColor()).join(",")})`;else{let se=Z.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&Z.isBold()&&se<8&&(se+=8),E.style.textDecorationColor=b.ansi[se].css}Z.isOverline()&&(q.push("xterm-overline"),U===" "&&(U="\xA0")),Z.isStrikethrough()&&q.push("xterm-strikethrough"),Oe&&(E.style.textDecoration="underline");let ue=Z.getFgColor(),pe=Z.getFgColorMode(),fe=Z.getBgColor(),xe=Z.getBgColorMode();const K=!!Z.isInverse();if(K){const se=ue;ue=fe,fe=se;const wt=pe;pe=xe,xe=wt}let X,Q,ee,le=!1;switch(this._decorationService.forEachDecorationAtCell(te,m,void 0,se=>{se.options.layer!=="top"&&le||(se.backgroundColorRGB&&(xe=50331648,fe=se.backgroundColorRGB.rgba>>8&16777215,X=se.backgroundColorRGB),se.foregroundColorRGB&&(pe=50331648,ue=se.foregroundColorRGB.rgba>>8&16777215,Q=se.foregroundColorRGB),le=se.options.layer==="top")}),!le&&Ee&&(X=this._coreBrowserService.isFocused?b.selectionBackgroundOpaque:b.selectionInactiveBackgroundOpaque,fe=X.rgba>>8&16777215,xe=50331648,le=!0,b.selectionForeground&&(pe=50331648,ue=b.selectionForeground.rgba>>8&16777215,Q=b.selectionForeground)),le&&q.push("xterm-decoration-top"),xe){case 16777216:case 33554432:ee=b.ansi[fe],q.push(`xterm-bg-${fe}`);break;case 50331648:ee=l.channels.toColor(fe>>16,fe>>8&255,255&fe),this._addStyle(E,`background-color:#${p((fe>>>0).toString(16),"0",6)}`);break;default:K?(ee=b.foreground,q.push(`xterm-bg-${o.INVERTED_DEFAULT_COLOR}`)):ee=b.background}switch(X||Z.isDim()&&(X=l.color.multiplyOpacity(ee,.5)),pe){case 16777216:case 33554432:Z.isBold()&&ue<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(ue+=8),this._applyMinimumContrast(E,ee,b.ansi[ue],Z,X,void 0)||q.push(`xterm-fg-${ue}`);break;case 50331648:const se=l.channels.toColor(ue>>16&255,ue>>8&255,255&ue);this._applyMinimumContrast(E,ee,se,Z,X,Q)||this._addStyle(E,`color:#${p(ue.toString(16),"0",6)}`);break;default:this._applyMinimumContrast(E,ee,b.foreground,Z,X,Q)||K&&q.push(`xterm-fg-${o.INVERTED_DEFAULT_COLOR}`)}q.length&&(E.className=q.join(" "),q.length=0),Y||oe||de?E.textContent=U:B++,W!==this.defaultSpacing&&(E.style.letterSpacing=`${W}px`),I.push(E),te=ae}return E&&B&&(E.textContent=U),I}_applyMinimumContrast(g,m,d,C,R,A){if(this._optionsService.rawOptions.minimumContrastRatio===1||(0,e.treatGlyphAsBackgroundColor)(C.getCode()))return!1;const T=this._getContrastCache(C);let L;if(R||A||(L=T.getColor(m.rgba,d.rgba)),L===void 0){const H=this._optionsService.rawOptions.minimumContrastRatio/(C.isDim()?2:1);L=l.color.ensureContrastRatio(R||m,A||d,H),T.setColor((R||m).rgba,(A||d).rgba,L??null)}return!!L&&(this._addStyle(g,`color:${L.css}`),!0)}_getContrastCache(g){return g.isDim()?this._themeService.colors.halfContrastCache:this._themeService.colors.contrastCache}_addStyle(g,m){g.setAttribute("style",`${g.getAttribute("style")||""}${m};`)}_isCellInSelection(g,m){const d=this._selectionStart,C=this._selectionEnd;return!(!d||!C)&&(this._columnSelectMode?d[0]<=C[0]?g>=d[0]&&m>=d[1]&&g<C[0]&&m<=C[1]:g<d[0]&&m>=d[1]&&g>=C[0]&&m<=C[1]:m>d[1]&&m<C[1]||d[1]===C[1]&&m===d[1]&&g>=d[0]&&g<C[0]||d[1]<C[1]&&m===C[1]&&g<C[0]||d[1]<C[1]&&m===d[1]&&g>=d[0])}};function p(g,m,d){for(;g.length<d;)g=m+g;return g}t.DomRendererRowFactory=a=c([u(1,s.ICharacterJoinerService),u(2,S.IOptionsService),u(3,s.ICoreBrowserService),u(4,S.ICoreService),u(5,S.IDecorationService),u(6,s.IThemeService)],a)},2550:(x,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WidthCache=void 0,t.WidthCache=class{constructor(n,c){this._flat=new Float32Array(256),this._font="",this._fontSize=0,this._weight="normal",this._weightBold="bold",this._measureElements=[],this._container=n.createElement("div"),this._container.classList.add("xterm-width-cache-measure-container"),this._container.setAttribute("aria-hidden","true"),this._container.style.whiteSpace="pre",this._container.style.fontKerning="none";const u=n.createElement("span");u.classList.add("xterm-char-measure-element");const o=n.createElement("span");o.classList.add("xterm-char-measure-element"),o.style.fontWeight="bold";const _=n.createElement("span");_.classList.add("xterm-char-measure-element"),_.style.fontStyle="italic";const f=n.createElement("span");f.classList.add("xterm-char-measure-element"),f.style.fontWeight="bold",f.style.fontStyle="italic",this._measureElements=[u,o,_,f],this._container.appendChild(u),this._container.appendChild(o),this._container.appendChild(_),this._container.appendChild(f),c.appendChild(this._container),this.clear()}dispose(){this._container.remove(),this._measureElements.length=0,this._holey=void 0}clear(){this._flat.fill(-9999),this._holey=new Map}setFont(n,c,u,o){n===this._font&&c===this._fontSize&&u===this._weight&&o===this._weightBold||(this._font=n,this._fontSize=c,this._weight=u,this._weightBold=o,this._container.style.fontFamily=this._font,this._container.style.fontSize=`${this._fontSize}px`,this._measureElements[0].style.fontWeight=`${u}`,this._measureElements[1].style.fontWeight=`${o}`,this._measureElements[2].style.fontWeight=`${u}`,this._measureElements[3].style.fontWeight=`${o}`,this.clear())}get(n,c,u){let o=0;if(!c&&!u&&n.length===1&&(o=n.charCodeAt(0))<256){if(this._flat[o]!==-9999)return this._flat[o];const S=this._measure(n,0);return S>0&&(this._flat[o]=S),S}let _=n;c&&(_+="B"),u&&(_+="I");let f=this._holey.get(_);if(f===void 0){let S=0;c&&(S|=1),u&&(S|=2),f=this._measure(n,S),f>0&&this._holey.set(_,f)}return f}_measure(n,c){const u=this._measureElements[c];return u.textContent=n.repeat(32),u.offsetWidth/32}}},2223:(x,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TEXT_BASELINE=t.DIM_OPACITY=t.INVERTED_DEFAULT_COLOR=void 0;const c=n(6114);t.INVERTED_DEFAULT_COLOR=257,t.DIM_OPACITY=.5,t.TEXT_BASELINE=c.isFirefox||c.isLegacyEdge?"bottom":"ideographic"},6171:(x,t)=>{function n(u){return 57508<=u&&u<=57558}function c(u){return u>=128512&&u<=128591||u>=127744&&u<=128511||u>=128640&&u<=128767||u>=9728&&u<=9983||u>=9984&&u<=10175||u>=65024&&u<=65039||u>=129280&&u<=129535||u>=127462&&u<=127487}Object.defineProperty(t,"__esModule",{value:!0}),t.computeNextVariantOffset=t.createRenderDimensions=t.treatGlyphAsBackgroundColor=t.allowRescaling=t.isEmoji=t.isRestrictedPowerlineGlyph=t.isPowerlineGlyph=t.throwIfFalsy=void 0,t.throwIfFalsy=function(u){if(!u)throw new Error("value must not be falsy");return u},t.isPowerlineGlyph=n,t.isRestrictedPowerlineGlyph=function(u){return 57520<=u&&u<=57527},t.isEmoji=c,t.allowRescaling=function(u,o,_,f){return o===1&&_>Math.ceil(1.5*f)&&u!==void 0&&u>255&&!c(u)&&!n(u)&&!function(S){return 57344<=S&&S<=63743}(u)},t.treatGlyphAsBackgroundColor=function(u){return n(u)||function(o){return 9472<=o&&o<=9631}(u)},t.createRenderDimensions=function(){return{css:{canvas:{width:0,height:0},cell:{width:0,height:0}},device:{canvas:{width:0,height:0},cell:{width:0,height:0},char:{width:0,height:0,left:0,top:0}}}},t.computeNextVariantOffset=function(u,o,_=0){return(u-(2*Math.round(o)-_))%(2*Math.round(o))}},6052:(x,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createSelectionRenderModel=void 0;class n{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update(u,o,_,f=!1){if(this.selectionStart=o,this.selectionEnd=_,!o||!_||o[0]===_[0]&&o[1]===_[1])return void this.clear();const S=u.buffers.active.ydisp,l=o[1]-S,s=_[1]-S,r=Math.max(l,0),e=Math.min(s,u.rows-1);r>=u.rows||e<0?this.clear():(this.hasSelection=!0,this.columnSelectMode=f,this.viewportStartRow=l,this.viewportEndRow=s,this.viewportCappedStartRow=r,this.viewportCappedEndRow=e,this.startCol=o[0],this.endCol=_[0])}isCellSelected(u,o,_){return!!this.hasSelection&&(_-=u.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?o>=this.startCol&&_>=this.viewportCappedStartRow&&o<this.endCol&&_<=this.viewportCappedEndRow:o<this.startCol&&_>=this.viewportCappedStartRow&&o>=this.endCol&&_<=this.viewportCappedEndRow:_>this.viewportStartRow&&_<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&_===this.viewportStartRow&&o>=this.startCol&&o<this.endCol||this.viewportStartRow<this.viewportEndRow&&_===this.viewportEndRow&&o<this.endCol||this.viewportStartRow<this.viewportEndRow&&_===this.viewportStartRow&&o>=this.startCol)}}t.createSelectionRenderModel=function(){return new n}},456:(x,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SelectionModel=void 0,t.SelectionModel=class{constructor(n){this._bufferService=n,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:this.selectionEnd&&this.selectionStart&&this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){const n=this.selectionStart[0]+this.selectionStartLength;return n>this._bufferService.cols?n%this._bufferService.cols==0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(n/this._bufferService.cols)-1]:[n%this._bufferService.cols,this.selectionStart[1]+Math.floor(n/this._bufferService.cols)]:[n,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){const n=this.selectionStart[0]+this.selectionStartLength;return n>this._bufferService.cols?[n%this._bufferService.cols,this.selectionStart[1]+Math.floor(n/this._bufferService.cols)]:[Math.max(n,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){const n=this.selectionStart,c=this.selectionEnd;return!(!n||!c)&&(n[1]>c[1]||n[1]===c[1]&&n[0]>c[0])}handleTrim(n){return this.selectionStart&&(this.selectionStart[1]-=n),this.selectionEnd&&(this.selectionEnd[1]-=n),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}}},428:function(x,t,n){var c=this&&this.__decorate||function(e,i,a,p){var g,m=arguments.length,d=m<3?i:p===null?p=Object.getOwnPropertyDescriptor(i,a):p;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(e,i,a,p);else for(var C=e.length-1;C>=0;C--)(g=e[C])&&(d=(m<3?g(d):m>3?g(i,a,d):g(i,a))||d);return m>3&&d&&Object.defineProperty(i,a,d),d},u=this&&this.__param||function(e,i){return function(a,p){i(a,p,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CharSizeService=void 0;const o=n(2585),_=n(8460),f=n(844);let S=t.CharSizeService=class extends f.Disposable{get hasValidSize(){return this.width>0&&this.height>0}constructor(e,i,a){super(),this._optionsService=a,this.width=0,this.height=0,this._onCharSizeChange=this.register(new _.EventEmitter),this.onCharSizeChange=this._onCharSizeChange.event;try{this._measureStrategy=this.register(new r(this._optionsService))}catch{this._measureStrategy=this.register(new s(e,i,this._optionsService))}this.register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],()=>this.measure()))}measure(){const e=this._measureStrategy.measure();e.width===this.width&&e.height===this.height||(this.width=e.width,this.height=e.height,this._onCharSizeChange.fire())}};t.CharSizeService=S=c([u(2,o.IOptionsService)],S);class l extends f.Disposable{constructor(){super(...arguments),this._result={width:0,height:0}}_validateAndSet(i,a){i!==void 0&&i>0&&a!==void 0&&a>0&&(this._result.width=i,this._result.height=a)}}class s extends l{constructor(i,a,p){super(),this._document=i,this._parentElement=a,this._optionsService=p,this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W".repeat(32),this._measureElement.setAttribute("aria-hidden","true"),this._measureElement.style.whiteSpace="pre",this._measureElement.style.fontKerning="none",this._parentElement.appendChild(this._measureElement)}measure(){return this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`,this._validateAndSet(Number(this._measureElement.offsetWidth)/32,Number(this._measureElement.offsetHeight)),this._result}}class r extends l{constructor(i){super(),this._optionsService=i,this._canvas=new OffscreenCanvas(100,100),this._ctx=this._canvas.getContext("2d");const a=this._ctx.measureText("W");if(!("width"in a&&"fontBoundingBoxAscent"in a&&"fontBoundingBoxDescent"in a))throw new Error("Required font metrics not supported")}measure(){this._ctx.font=`${this._optionsService.rawOptions.fontSize}px ${this._optionsService.rawOptions.fontFamily}`;const i=this._ctx.measureText("W");return this._validateAndSet(i.width,i.fontBoundingBoxAscent+i.fontBoundingBoxDescent),this._result}}},4269:function(x,t,n){var c=this&&this.__decorate||function(r,e,i,a){var p,g=arguments.length,m=g<3?e:a===null?a=Object.getOwnPropertyDescriptor(e,i):a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")m=Reflect.decorate(r,e,i,a);else for(var d=r.length-1;d>=0;d--)(p=r[d])&&(m=(g<3?p(m):g>3?p(e,i,m):p(e,i))||m);return g>3&&m&&Object.defineProperty(e,i,m),m},u=this&&this.__param||function(r,e){return function(i,a){e(i,a,r)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CharacterJoinerService=t.JoinedCellData=void 0;const o=n(3734),_=n(643),f=n(511),S=n(2585);class l extends o.AttributeData{constructor(e,i,a){super(),this.content=0,this.combinedData="",this.fg=e.fg,this.bg=e.bg,this.combinedData=i,this._width=a}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(e){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}t.JoinedCellData=l;let s=t.CharacterJoinerService=class gi{constructor(e){this._bufferService=e,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new f.CellData}register(e){const i={id:this._nextCharacterJoinerId++,handler:e};return this._characterJoiners.push(i),i.id}deregister(e){for(let i=0;i<this._characterJoiners.length;i++)if(this._characterJoiners[i].id===e)return this._characterJoiners.splice(i,1),!0;return!1}getJoinedCharacters(e){if(this._characterJoiners.length===0)return[];const i=this._bufferService.buffer.lines.get(e);if(!i||i.length===0)return[];const a=[],p=i.translateToString(!0);let g=0,m=0,d=0,C=i.getFg(0),R=i.getBg(0);for(let A=0;A<i.getTrimmedLength();A++)if(i.loadCell(A,this._workCell),this._workCell.getWidth()!==0){if(this._workCell.fg!==C||this._workCell.bg!==R){if(A-g>1){const T=this._getJoinedRanges(p,d,m,i,g);for(let L=0;L<T.length;L++)a.push(T[L])}g=A,d=m,C=this._workCell.fg,R=this._workCell.bg}m+=this._workCell.getChars().length||_.WHITESPACE_CELL_CHAR.length}if(this._bufferService.cols-g>1){const A=this._getJoinedRanges(p,d,m,i,g);for(let T=0;T<A.length;T++)a.push(A[T])}return a}_getJoinedRanges(e,i,a,p,g){const m=e.substring(i,a);let d=[];try{d=this._characterJoiners[0].handler(m)}catch(C){console.error(C)}for(let C=1;C<this._characterJoiners.length;C++)try{const R=this._characterJoiners[C].handler(m);for(let A=0;A<R.length;A++)gi._mergeRanges(d,R[A])}catch(R){console.error(R)}return this._stringRangesToCellRanges(d,p,g),d}_stringRangesToCellRanges(e,i,a){let p=0,g=!1,m=0,d=e[p];if(d){for(let C=a;C<this._bufferService.cols;C++){const R=i.getWidth(C),A=i.getString(C).length||_.WHITESPACE_CELL_CHAR.length;if(R!==0){if(!g&&d[0]<=m&&(d[0]=C,g=!0),d[1]<=m){if(d[1]=C,d=e[++p],!d)break;d[0]<=m?(d[0]=C,g=!0):g=!1}m+=A}}d&&(d[1]=this._bufferService.cols)}}static _mergeRanges(e,i){let a=!1;for(let p=0;p<e.length;p++){const g=e[p];if(a){if(i[1]<=g[0])return e[p-1][1]=i[1],e;if(i[1]<=g[1])return e[p-1][1]=Math.max(i[1],g[1]),e.splice(p,1),e;e.splice(p,1),p--}else{if(i[1]<=g[0])return e.splice(p,0,i),e;if(i[1]<=g[1])return g[0]=Math.min(i[0],g[0]),e;i[0]<g[1]&&(g[0]=Math.min(i[0],g[0]),a=!0)}}return a?e[e.length-1][1]=i[1]:e.push(i),e}};t.CharacterJoinerService=s=c([u(0,S.IBufferService)],s)},5114:(x,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CoreBrowserService=void 0;const c=n(844),u=n(8460),o=n(3656);class _ extends c.Disposable{constructor(l,s,r){super(),this._textarea=l,this._window=s,this.mainDocument=r,this._isFocused=!1,this._cachedIsFocused=void 0,this._screenDprMonitor=new f(this._window),this._onDprChange=this.register(new u.EventEmitter),this.onDprChange=this._onDprChange.event,this._onWindowChange=this.register(new u.EventEmitter),this.onWindowChange=this._onWindowChange.event,this.register(this.onWindowChange(e=>this._screenDprMonitor.setWindow(e))),this.register((0,u.forwardEvent)(this._screenDprMonitor.onDprChange,this._onDprChange)),this._textarea.addEventListener("focus",()=>this._isFocused=!0),this._textarea.addEventListener("blur",()=>this._isFocused=!1)}get window(){return this._window}set window(l){this._window!==l&&(this._window=l,this._onWindowChange.fire(this._window))}get dpr(){return this.window.devicePixelRatio}get isFocused(){return this._cachedIsFocused===void 0&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask(()=>this._cachedIsFocused=void 0)),this._cachedIsFocused}}t.CoreBrowserService=_;class f extends c.Disposable{constructor(l){super(),this._parentWindow=l,this._windowResizeListener=this.register(new c.MutableDisposable),this._onDprChange=this.register(new u.EventEmitter),this.onDprChange=this._onDprChange.event,this._outerListener=()=>this._setDprAndFireIfDiffers(),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._updateDpr(),this._setWindowResizeListener(),this.register((0,c.toDisposable)(()=>this.clearListener()))}setWindow(l){this._parentWindow=l,this._setWindowResizeListener(),this._setDprAndFireIfDiffers()}_setWindowResizeListener(){this._windowResizeListener.value=(0,o.addDisposableDomListener)(this._parentWindow,"resize",()=>this._setDprAndFireIfDiffers())}_setDprAndFireIfDiffers(){this._parentWindow.devicePixelRatio!==this._currentDevicePixelRatio&&this._onDprChange.fire(this._parentWindow.devicePixelRatio),this._updateDpr()}_updateDpr(){var l;this._outerListener&&((l=this._resolutionMediaMatchList)==null||l.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){this._resolutionMediaMatchList&&this._outerListener&&(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._outerListener=void 0)}}},779:(x,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LinkProviderService=void 0;const c=n(844);class u extends c.Disposable{constructor(){super(),this.linkProviders=[],this.register((0,c.toDisposable)(()=>this.linkProviders.length=0))}registerLinkProvider(_){return this.linkProviders.push(_),{dispose:()=>{const f=this.linkProviders.indexOf(_);f!==-1&&this.linkProviders.splice(f,1)}}}}t.LinkProviderService=u},8934:function(x,t,n){var c=this&&this.__decorate||function(S,l,s,r){var e,i=arguments.length,a=i<3?l:r===null?r=Object.getOwnPropertyDescriptor(l,s):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(S,l,s,r);else for(var p=S.length-1;p>=0;p--)(e=S[p])&&(a=(i<3?e(a):i>3?e(l,s,a):e(l,s))||a);return i>3&&a&&Object.defineProperty(l,s,a),a},u=this&&this.__param||function(S,l){return function(s,r){l(s,r,S)}};Object.defineProperty(t,"__esModule",{value:!0}),t.MouseService=void 0;const o=n(4725),_=n(9806);let f=t.MouseService=class{constructor(S,l){this._renderService=S,this._charSizeService=l}getCoords(S,l,s,r,e){return(0,_.getCoords)(window,S,l,s,r,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,e)}getMouseReportCoords(S,l){const s=(0,_.getCoordsRelativeToElement)(window,S,l);if(this._charSizeService.hasValidSize)return s[0]=Math.min(Math.max(s[0],0),this._renderService.dimensions.css.canvas.width-1),s[1]=Math.min(Math.max(s[1],0),this._renderService.dimensions.css.canvas.height-1),{col:Math.floor(s[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(s[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(s[0]),y:Math.floor(s[1])}}};t.MouseService=f=c([u(0,o.IRenderService),u(1,o.ICharSizeService)],f)},3230:function(x,t,n){var c=this&&this.__decorate||function(e,i,a,p){var g,m=arguments.length,d=m<3?i:p===null?p=Object.getOwnPropertyDescriptor(i,a):p;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(e,i,a,p);else for(var C=e.length-1;C>=0;C--)(g=e[C])&&(d=(m<3?g(d):m>3?g(i,a,d):g(i,a))||d);return m>3&&d&&Object.defineProperty(i,a,d),d},u=this&&this.__param||function(e,i){return function(a,p){i(a,p,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.RenderService=void 0;const o=n(6193),_=n(4725),f=n(8460),S=n(844),l=n(7226),s=n(2585);let r=t.RenderService=class extends S.Disposable{get dimensions(){return this._renderer.value.dimensions}constructor(e,i,a,p,g,m,d,C){super(),this._rowCount=e,this._charSizeService=p,this._renderer=this.register(new S.MutableDisposable),this._pausedResizeTask=new l.DebouncedIdleTask,this._observerDisposable=this.register(new S.MutableDisposable),this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this.register(new f.EventEmitter),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this.register(new f.EventEmitter),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this.register(new f.EventEmitter),this.onRender=this._onRender.event,this._onRefreshRequest=this.register(new f.EventEmitter),this.onRefreshRequest=this._onRefreshRequest.event,this._renderDebouncer=new o.RenderDebouncer((R,A)=>this._renderRows(R,A),d),this.register(this._renderDebouncer),this.register(d.onDprChange(()=>this.handleDevicePixelRatioChange())),this.register(m.onResize(()=>this._fullRefresh())),this.register(m.buffers.onBufferActivate(()=>{var R;return(R=this._renderer.value)==null?void 0:R.clear()})),this.register(a.onOptionChange(()=>this._handleOptionsChanged())),this.register(this._charSizeService.onCharSizeChange(()=>this.handleCharSizeChanged())),this.register(g.onDecorationRegistered(()=>this._fullRefresh())),this.register(g.onDecorationRemoved(()=>this._fullRefresh())),this.register(a.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio","rescaleOverlappingGlyphs"],()=>{this.clear(),this.handleResize(m.cols,m.rows),this._fullRefresh()})),this.register(a.onMultipleOptionChange(["cursorBlink","cursorStyle"],()=>this.refreshRows(m.buffer.y,m.buffer.y,!0))),this.register(C.onChangeColors(()=>this._fullRefresh())),this._registerIntersectionObserver(d.window,i),this.register(d.onWindowChange(R=>this._registerIntersectionObserver(R,i)))}_registerIntersectionObserver(e,i){if("IntersectionObserver"in e){const a=new e.IntersectionObserver(p=>this._handleIntersectionChange(p[p.length-1]),{threshold:0});a.observe(i),this._observerDisposable.value=(0,S.toDisposable)(()=>a.disconnect())}}_handleIntersectionChange(e){this._isPaused=e.isIntersecting===void 0?e.intersectionRatio===0:!e.isIntersecting,this._isPaused||this._charSizeService.hasValidSize||this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows(e,i,a=!1){this._isPaused?this._needsFullRefresh=!0:(a||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(e,i,this._rowCount))}_renderRows(e,i){this._renderer.value&&(e=Math.min(e,this._rowCount-1),i=Math.min(i,this._rowCount-1),this._renderer.value.renderRows(e,i),this._needsSelectionRefresh&&(this._renderer.value.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:e,end:i}),this._onRender.fire({start:e,end:i}),this._isNextRenderRedrawOnly=!0)}resize(e,i){this._rowCount=i,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer.value&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer.value&&(this._renderer.value.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.value.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.value.dimensions))}hasRenderer(){return!!this._renderer.value}setRenderer(e){this._renderer.value=e,this._renderer.value&&(this._renderer.value.onRequestRedraw(i=>this.refreshRows(i.start,i.end,!0)),this._needsSelectionRefresh=!0,this._fullRefresh())}addRefreshCallback(e){return this._renderDebouncer.addRefreshCallback(e)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){var e,i;this._renderer.value&&((i=(e=this._renderer.value).clearTextureAtlas)==null||i.call(e),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer.value&&(this._renderer.value.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize(e,i){this._renderer.value&&(this._isPaused?this._pausedResizeTask.set(()=>{var a;return(a=this._renderer.value)==null?void 0:a.handleResize(e,i)}):this._renderer.value.handleResize(e,i),this._fullRefresh())}handleCharSizeChanged(){var e;(e=this._renderer.value)==null||e.handleCharSizeChanged()}handleBlur(){var e;(e=this._renderer.value)==null||e.handleBlur()}handleFocus(){var e;(e=this._renderer.value)==null||e.handleFocus()}handleSelectionChanged(e,i,a){var p;this._selectionState.start=e,this._selectionState.end=i,this._selectionState.columnSelectMode=a,(p=this._renderer.value)==null||p.handleSelectionChanged(e,i,a)}handleCursorMove(){var e;(e=this._renderer.value)==null||e.handleCursorMove()}clear(){var e;(e=this._renderer.value)==null||e.clear()}};t.RenderService=r=c([u(2,s.IOptionsService),u(3,_.ICharSizeService),u(4,s.IDecorationService),u(5,s.IBufferService),u(6,_.ICoreBrowserService),u(7,_.IThemeService)],r)},9312:function(x,t,n){var c=this&&this.__decorate||function(d,C,R,A){var T,L=arguments.length,H=L<3?C:A===null?A=Object.getOwnPropertyDescriptor(C,R):A;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")H=Reflect.decorate(d,C,R,A);else for(var N=d.length-1;N>=0;N--)(T=d[N])&&(H=(L<3?T(H):L>3?T(C,R,H):T(C,R))||H);return L>3&&H&&Object.defineProperty(C,R,H),H},u=this&&this.__param||function(d,C){return function(R,A){C(R,A,d)}};Object.defineProperty(t,"__esModule",{value:!0}),t.SelectionService=void 0;const o=n(9806),_=n(9504),f=n(456),S=n(4725),l=n(8460),s=n(844),r=n(6114),e=n(4841),i=n(511),a=n(2585),p="\xA0",g=new RegExp(p,"g");let m=t.SelectionService=class extends s.Disposable{constructor(d,C,R,A,T,L,H,N,$){super(),this._element=d,this._screenElement=C,this._linkifier=R,this._bufferService=A,this._coreService=T,this._mouseService=L,this._optionsService=H,this._renderService=N,this._coreBrowserService=$,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new i.CellData,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this.register(new l.EventEmitter),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this.register(new l.EventEmitter),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this.register(new l.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this.register(new l.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=I=>this._handleMouseMove(I),this._mouseUpListener=I=>this._handleMouseUp(I),this._coreService.onUserInput(()=>{this.hasSelection&&this.clearSelection()}),this._trimListener=this._bufferService.buffer.lines.onTrim(I=>this._handleTrim(I)),this.register(this._bufferService.buffers.onBufferActivate(I=>this._handleBufferActivate(I))),this.enable(),this._model=new f.SelectionModel(this._bufferService),this._activeSelectionMode=0,this.register((0,s.toDisposable)(()=>{this._removeMouseDownListeners()}))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){const d=this._model.finalSelectionStart,C=this._model.finalSelectionEnd;return!(!d||!C||d[0]===C[0]&&d[1]===C[1])}get selectionText(){const d=this._model.finalSelectionStart,C=this._model.finalSelectionEnd;if(!d||!C)return"";const R=this._bufferService.buffer,A=[];if(this._activeSelectionMode===3){if(d[0]===C[0])return"";const T=d[0]<C[0]?d[0]:C[0],L=d[0]<C[0]?C[0]:d[0];for(let H=d[1];H<=C[1];H++){const N=R.translateBufferLineToString(H,!0,T,L);A.push(N)}}else{const T=d[1]===C[1]?C[0]:void 0;A.push(R.translateBufferLineToString(d[1],!0,d[0],T));for(let L=d[1]+1;L<=C[1]-1;L++){const H=R.lines.get(L),N=R.translateBufferLineToString(L,!0);H!=null&&H.isWrapped?A[A.length-1]+=N:A.push(N)}if(d[1]!==C[1]){const L=R.lines.get(C[1]),H=R.translateBufferLineToString(C[1],!0,0,C[0]);L&&L.isWrapped?A[A.length-1]+=H:A.push(H)}}return A.map(T=>T.replace(g," ")).join(r.isWindows?`\r
`:`
`)}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh(d){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._refresh())),r.isLinux&&d&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:this._activeSelectionMode===3})}_isClickInSelection(d){const C=this._getMouseBufferCoords(d),R=this._model.finalSelectionStart,A=this._model.finalSelectionEnd;return!!(R&&A&&C)&&this._areCoordsInSelection(C,R,A)}isCellInSelection(d,C){const R=this._model.finalSelectionStart,A=this._model.finalSelectionEnd;return!(!R||!A)&&this._areCoordsInSelection([d,C],R,A)}_areCoordsInSelection(d,C,R){return d[1]>C[1]&&d[1]<R[1]||C[1]===R[1]&&d[1]===C[1]&&d[0]>=C[0]&&d[0]<R[0]||C[1]<R[1]&&d[1]===R[1]&&d[0]<R[0]||C[1]<R[1]&&d[1]===C[1]&&d[0]>=C[0]}_selectWordAtCursor(d,C){var T,L;const R=(L=(T=this._linkifier.currentLink)==null?void 0:T.link)==null?void 0:L.range;if(R)return this._model.selectionStart=[R.start.x-1,R.start.y-1],this._model.selectionStartLength=(0,e.getRangeLength)(R,this._bufferService.cols),this._model.selectionEnd=void 0,!0;const A=this._getMouseBufferCoords(d);return!!A&&(this._selectWordAt(A,C),this._model.selectionEnd=void 0,!0)}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines(d,C){this._model.clearSelection(),d=Math.max(d,0),C=Math.min(C,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,d],this._model.selectionEnd=[this._bufferService.cols,C],this.refresh(),this._onSelectionChange.fire()}_handleTrim(d){this._model.handleTrim(d)&&this.refresh()}_getMouseBufferCoords(d){const C=this._mouseService.getCoords(d,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(C)return C[0]--,C[1]--,C[1]+=this._bufferService.buffer.ydisp,C}_getMouseEventScrollAmount(d){let C=(0,o.getCoordsRelativeToElement)(this._coreBrowserService.window,d,this._screenElement)[1];const R=this._renderService.dimensions.css.canvas.height;return C>=0&&C<=R?0:(C>R&&(C-=R),C=Math.min(Math.max(C,-50),50),C/=50,C/Math.abs(C)+Math.round(14*C))}shouldForceSelection(d){return r.isMac?d.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:d.shiftKey}handleMouseDown(d){if(this._mouseDownTimeStamp=d.timeStamp,(d.button!==2||!this.hasSelection)&&d.button===0){if(!this._enabled){if(!this.shouldForceSelection(d))return;d.stopPropagation()}d.preventDefault(),this._dragScrollAmount=0,this._enabled&&d.shiftKey?this._handleIncrementalClick(d):d.detail===1?this._handleSingleClick(d):d.detail===2?this._handleDoubleClick(d):d.detail===3&&this._handleTripleClick(d),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval(()=>this._dragScroll(),50)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick(d){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(d))}_handleSingleClick(d){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(d)?3:0,this._model.selectionStart=this._getMouseBufferCoords(d),!this._model.selectionStart)return;this._model.selectionEnd=void 0;const C=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);C&&C.length!==this._model.selectionStart[0]&&C.hasWidth(this._model.selectionStart[0])===0&&this._model.selectionStart[0]++}_handleDoubleClick(d){this._selectWordAtCursor(d,!0)&&(this._activeSelectionMode=1)}_handleTripleClick(d){const C=this._getMouseBufferCoords(d);C&&(this._activeSelectionMode=2,this._selectLineAt(C[1]))}shouldColumnSelect(d){return d.altKey&&!(r.isMac&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove(d){if(d.stopImmediatePropagation(),!this._model.selectionStart)return;const C=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(d),!this._model.selectionEnd)return void this.refresh(!0);this._activeSelectionMode===2?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:this._activeSelectionMode===1&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(d),this._activeSelectionMode!==3&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));const R=this._bufferService.buffer;if(this._model.selectionEnd[1]<R.lines.length){const A=R.lines.get(this._model.selectionEnd[1]);A&&A.hasWidth(this._model.selectionEnd[0])===0&&this._model.selectionEnd[0]<this._bufferService.cols&&this._model.selectionEnd[0]++}C&&C[0]===this._model.selectionEnd[0]&&C[1]===this._model.selectionEnd[1]||this.refresh(!0)}_dragScroll(){if(this._model.selectionEnd&&this._model.selectionStart&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});const d=this._bufferService.buffer;this._dragScrollAmount>0?(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(d.ydisp+this._bufferService.rows,d.lines.length-1)):(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=d.ydisp),this.refresh()}}_handleMouseUp(d){const C=d.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&C<500&&d.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){const R=this._mouseService.getCoords(d,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(R&&R[0]!==void 0&&R[1]!==void 0){const A=(0,_.moveToCellSequence)(R[0]-1,R[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(A,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){const d=this._model.finalSelectionStart,C=this._model.finalSelectionEnd,R=!(!d||!C||d[0]===C[0]&&d[1]===C[1]);R?d&&C&&(this._oldSelectionStart&&this._oldSelectionEnd&&d[0]===this._oldSelectionStart[0]&&d[1]===this._oldSelectionStart[1]&&C[0]===this._oldSelectionEnd[0]&&C[1]===this._oldSelectionEnd[1]||this._fireOnSelectionChange(d,C,R)):this._oldHasSelection&&this._fireOnSelectionChange(d,C,R)}_fireOnSelectionChange(d,C,R){this._oldSelectionStart=d,this._oldSelectionEnd=C,this._oldHasSelection=R,this._onSelectionChange.fire()}_handleBufferActivate(d){this.clearSelection(),this._trimListener.dispose(),this._trimListener=d.activeBuffer.lines.onTrim(C=>this._handleTrim(C))}_convertViewportColToCharacterIndex(d,C){let R=C;for(let A=0;C>=A;A++){const T=d.loadCell(A,this._workCell).getChars().length;this._workCell.getWidth()===0?R--:T>1&&C!==A&&(R+=T-1)}return R}setSelection(d,C,R){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[d,C],this._model.selectionStartLength=R,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect(d){this._isClickInSelection(d)||(this._selectWordAtCursor(d,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt(d,C,R=!0,A=!0){if(d[0]>=this._bufferService.cols)return;const T=this._bufferService.buffer,L=T.lines.get(d[1]);if(!L)return;const H=T.translateBufferLineToString(d[1],!1);let N=this._convertViewportColToCharacterIndex(L,d[0]),$=N;const I=d[0]-N;let F=0,b=0,E=0,D=0;if(H.charAt(N)===" "){for(;N>0&&H.charAt(N-1)===" ";)N--;for(;$<H.length&&H.charAt($+1)===" ";)$++}else{let z=d[0],G=d[0];L.getWidth(z)===0&&(F++,z--),L.getWidth(G)===2&&(b++,G++);const J=L.getString(G).length;for(J>1&&(D+=J-1,$+=J-1);z>0&&N>0&&!this._isCharWordSeparator(L.loadCell(z-1,this._workCell));){L.loadCell(z-1,this._workCell);const O=this._workCell.getChars().length;this._workCell.getWidth()===0?(F++,z--):O>1&&(E+=O-1,N-=O-1),N--,z--}for(;G<L.length&&$+1<H.length&&!this._isCharWordSeparator(L.loadCell(G+1,this._workCell));){L.loadCell(G+1,this._workCell);const O=this._workCell.getChars().length;this._workCell.getWidth()===2?(b++,G++):O>1&&(D+=O-1,$+=O-1),$++,G++}}$++;let B=N+I-F+E,U=Math.min(this._bufferService.cols,$-N+F+b-E-D);if(C||H.slice(N,$).trim()!==""){if(R&&B===0&&L.getCodePoint(0)!==32){const z=T.lines.get(d[1]-1);if(z&&L.isWrapped&&z.getCodePoint(this._bufferService.cols-1)!==32){const G=this._getWordAt([this._bufferService.cols-1,d[1]-1],!1,!0,!1);if(G){const J=this._bufferService.cols-G.start;B-=J,U+=J}}}if(A&&B+U===this._bufferService.cols&&L.getCodePoint(this._bufferService.cols-1)!==32){const z=T.lines.get(d[1]+1);if(z!=null&&z.isWrapped&&z.getCodePoint(0)!==32){const G=this._getWordAt([0,d[1]+1],!1,!1,!0);G&&(U+=G.length)}}return{start:B,length:U}}}_selectWordAt(d,C){const R=this._getWordAt(d,C);if(R){for(;R.start<0;)R.start+=this._bufferService.cols,d[1]--;this._model.selectionStart=[R.start,d[1]],this._model.selectionStartLength=R.length}}_selectToWordAt(d){const C=this._getWordAt(d,!0);if(C){let R=d[1];for(;C.start<0;)C.start+=this._bufferService.cols,R--;if(!this._model.areSelectionValuesReversed())for(;C.start+C.length>this._bufferService.cols;)C.length-=this._bufferService.cols,R++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?C.start:C.start+C.length,R]}}_isCharWordSeparator(d){return d.getWidth()!==0&&this._optionsService.rawOptions.wordSeparator.indexOf(d.getChars())>=0}_selectLineAt(d){const C=this._bufferService.buffer.getWrappedRangeForLine(d),R={start:{x:0,y:C.first},end:{x:this._bufferService.cols-1,y:C.last}};this._model.selectionStart=[0,C.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=(0,e.getRangeLength)(R,this._bufferService.cols)}};t.SelectionService=m=c([u(3,a.IBufferService),u(4,a.ICoreService),u(5,S.IMouseService),u(6,a.IOptionsService),u(7,S.IRenderService),u(8,S.ICoreBrowserService)],m)},4725:(x,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ILinkProviderService=t.IThemeService=t.ICharacterJoinerService=t.ISelectionService=t.IRenderService=t.IMouseService=t.ICoreBrowserService=t.ICharSizeService=void 0;const c=n(8343);t.ICharSizeService=(0,c.createDecorator)("CharSizeService"),t.ICoreBrowserService=(0,c.createDecorator)("CoreBrowserService"),t.IMouseService=(0,c.createDecorator)("MouseService"),t.IRenderService=(0,c.createDecorator)("RenderService"),t.ISelectionService=(0,c.createDecorator)("SelectionService"),t.ICharacterJoinerService=(0,c.createDecorator)("CharacterJoinerService"),t.IThemeService=(0,c.createDecorator)("ThemeService"),t.ILinkProviderService=(0,c.createDecorator)("LinkProviderService")},6731:function(x,t,n){var c=this&&this.__decorate||function(m,d,C,R){var A,T=arguments.length,L=T<3?d:R===null?R=Object.getOwnPropertyDescriptor(d,C):R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")L=Reflect.decorate(m,d,C,R);else for(var H=m.length-1;H>=0;H--)(A=m[H])&&(L=(T<3?A(L):T>3?A(d,C,L):A(d,C))||L);return T>3&&L&&Object.defineProperty(d,C,L),L},u=this&&this.__param||function(m,d){return function(C,R){d(C,R,m)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ThemeService=t.DEFAULT_ANSI_COLORS=void 0;const o=n(7239),_=n(8055),f=n(8460),S=n(844),l=n(2585),s=_.css.toColor("#ffffff"),r=_.css.toColor("#000000"),e=_.css.toColor("#ffffff"),i=_.css.toColor("#000000"),a={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117};t.DEFAULT_ANSI_COLORS=Object.freeze((()=>{const m=[_.css.toColor("#2e3436"),_.css.toColor("#cc0000"),_.css.toColor("#4e9a06"),_.css.toColor("#c4a000"),_.css.toColor("#3465a4"),_.css.toColor("#75507b"),_.css.toColor("#06989a"),_.css.toColor("#d3d7cf"),_.css.toColor("#555753"),_.css.toColor("#ef2929"),_.css.toColor("#8ae234"),_.css.toColor("#fce94f"),_.css.toColor("#729fcf"),_.css.toColor("#ad7fa8"),_.css.toColor("#34e2e2"),_.css.toColor("#eeeeec")],d=[0,95,135,175,215,255];for(let C=0;C<216;C++){const R=d[C/36%6|0],A=d[C/6%6|0],T=d[C%6];m.push({css:_.channels.toCss(R,A,T),rgba:_.channels.toRgba(R,A,T)})}for(let C=0;C<24;C++){const R=8+10*C;m.push({css:_.channels.toCss(R,R,R),rgba:_.channels.toRgba(R,R,R)})}return m})());let p=t.ThemeService=class extends S.Disposable{get colors(){return this._colors}constructor(m){super(),this._optionsService=m,this._contrastCache=new o.ColorContrastCache,this._halfContrastCache=new o.ColorContrastCache,this._onChangeColors=this.register(new f.EventEmitter),this.onChangeColors=this._onChangeColors.event,this._colors={foreground:s,background:r,cursor:e,cursorAccent:i,selectionForeground:void 0,selectionBackgroundTransparent:a,selectionBackgroundOpaque:_.color.blend(r,a),selectionInactiveBackgroundTransparent:a,selectionInactiveBackgroundOpaque:_.color.blend(r,a),ansi:t.DEFAULT_ANSI_COLORS.slice(),contrastCache:this._contrastCache,halfContrastCache:this._halfContrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this.register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",()=>this._contrastCache.clear())),this.register(this._optionsService.onSpecificOptionChange("theme",()=>this._setTheme(this._optionsService.rawOptions.theme)))}_setTheme(m={}){const d=this._colors;if(d.foreground=g(m.foreground,s),d.background=g(m.background,r),d.cursor=g(m.cursor,e),d.cursorAccent=g(m.cursorAccent,i),d.selectionBackgroundTransparent=g(m.selectionBackground,a),d.selectionBackgroundOpaque=_.color.blend(d.background,d.selectionBackgroundTransparent),d.selectionInactiveBackgroundTransparent=g(m.selectionInactiveBackground,d.selectionBackgroundTransparent),d.selectionInactiveBackgroundOpaque=_.color.blend(d.background,d.selectionInactiveBackgroundTransparent),d.selectionForeground=m.selectionForeground?g(m.selectionForeground,_.NULL_COLOR):void 0,d.selectionForeground===_.NULL_COLOR&&(d.selectionForeground=void 0),_.color.isOpaque(d.selectionBackgroundTransparent)&&(d.selectionBackgroundTransparent=_.color.opacity(d.selectionBackgroundTransparent,.3)),_.color.isOpaque(d.selectionInactiveBackgroundTransparent)&&(d.selectionInactiveBackgroundTransparent=_.color.opacity(d.selectionInactiveBackgroundTransparent,.3)),d.ansi=t.DEFAULT_ANSI_COLORS.slice(),d.ansi[0]=g(m.black,t.DEFAULT_ANSI_COLORS[0]),d.ansi[1]=g(m.red,t.DEFAULT_ANSI_COLORS[1]),d.ansi[2]=g(m.green,t.DEFAULT_ANSI_COLORS[2]),d.ansi[3]=g(m.yellow,t.DEFAULT_ANSI_COLORS[3]),d.ansi[4]=g(m.blue,t.DEFAULT_ANSI_COLORS[4]),d.ansi[5]=g(m.magenta,t.DEFAULT_ANSI_COLORS[5]),d.ansi[6]=g(m.cyan,t.DEFAULT_ANSI_COLORS[6]),d.ansi[7]=g(m.white,t.DEFAULT_ANSI_COLORS[7]),d.ansi[8]=g(m.brightBlack,t.DEFAULT_ANSI_COLORS[8]),d.ansi[9]=g(m.brightRed,t.DEFAULT_ANSI_COLORS[9]),d.ansi[10]=g(m.brightGreen,t.DEFAULT_ANSI_COLORS[10]),d.ansi[11]=g(m.brightYellow,t.DEFAULT_ANSI_COLORS[11]),d.ansi[12]=g(m.brightBlue,t.DEFAULT_ANSI_COLORS[12]),d.ansi[13]=g(m.brightMagenta,t.DEFAULT_ANSI_COLORS[13]),d.ansi[14]=g(m.brightCyan,t.DEFAULT_ANSI_COLORS[14]),d.ansi[15]=g(m.brightWhite,t.DEFAULT_ANSI_COLORS[15]),m.extendedAnsi){const C=Math.min(d.ansi.length-16,m.extendedAnsi.length);for(let R=0;R<C;R++)d.ansi[R+16]=g(m.extendedAnsi[R],t.DEFAULT_ANSI_COLORS[R+16])}this._contrastCache.clear(),this._halfContrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(m){this._restoreColor(m),this._onChangeColors.fire(this.colors)}_restoreColor(m){if(m!==void 0)switch(m){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[m]=this._restoreColors.ansi[m]}else for(let d=0;d<this._restoreColors.ansi.length;++d)this._colors.ansi[d]=this._restoreColors.ansi[d]}modifyColors(m){m(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};function g(m,d){if(m!==void 0)try{return _.css.toColor(m)}catch{}return d}t.ThemeService=p=c([u(0,l.IOptionsService)],p)},6349:(x,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CircularList=void 0;const c=n(8460),u=n(844);class o extends u.Disposable{constructor(f){super(),this._maxLength=f,this.onDeleteEmitter=this.register(new c.EventEmitter),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this.register(new c.EventEmitter),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this.register(new c.EventEmitter),this.onTrim=this.onTrimEmitter.event,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(f){if(this._maxLength===f)return;const S=new Array(f);for(let l=0;l<Math.min(f,this.length);l++)S[l]=this._array[this._getCyclicIndex(l)];this._array=S,this._maxLength=f,this._startIndex=0}get length(){return this._length}set length(f){if(f>this._length)for(let S=this._length;S<f;S++)this._array[S]=void 0;this._length=f}get(f){return this._array[this._getCyclicIndex(f)]}set(f,S){this._array[this._getCyclicIndex(f)]=S}push(f){this._array[this._getCyclicIndex(this._length)]=f,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(f,S,...l){if(S){for(let s=f;s<this._length-S;s++)this._array[this._getCyclicIndex(s)]=this._array[this._getCyclicIndex(s+S)];this._length-=S,this.onDeleteEmitter.fire({index:f,amount:S})}for(let s=this._length-1;s>=f;s--)this._array[this._getCyclicIndex(s+l.length)]=this._array[this._getCyclicIndex(s)];for(let s=0;s<l.length;s++)this._array[this._getCyclicIndex(f+s)]=l[s];if(l.length&&this.onInsertEmitter.fire({index:f,amount:l.length}),this._length+l.length>this._maxLength){const s=this._length+l.length-this._maxLength;this._startIndex+=s,this._length=this._maxLength,this.onTrimEmitter.fire(s)}else this._length+=l.length}trimStart(f){f>this._length&&(f=this._length),this._startIndex+=f,this._length-=f,this.onTrimEmitter.fire(f)}shiftElements(f,S,l){if(!(S<=0)){if(f<0||f>=this._length)throw new Error("start argument out of range");if(f+l<0)throw new Error("Cannot shift elements in list beyond index 0");if(l>0){for(let r=S-1;r>=0;r--)this.set(f+r+l,this.get(f+r));const s=f+S+l-this._length;if(s>0)for(this._length+=s;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let s=0;s<S;s++)this.set(f+s+l,this.get(f+s))}}_getCyclicIndex(f){return(this._startIndex+f)%this._maxLength}}t.CircularList=o},1439:(x,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.clone=void 0,t.clone=function n(c,u=5){if(typeof c!="object")return c;const o=Array.isArray(c)?[]:{};for(const _ in c)o[_]=u<=1?c[_]:c[_]&&n(c[_],u-1);return o}},8055:(x,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.contrastRatio=t.toPaddedHex=t.rgba=t.rgb=t.css=t.color=t.channels=t.NULL_COLOR=void 0;let n=0,c=0,u=0,o=0;var _,f,S,l,s;function r(i){const a=i.toString(16);return a.length<2?"0"+a:a}function e(i,a){return i<a?(a+.05)/(i+.05):(i+.05)/(a+.05)}t.NULL_COLOR={css:"#00000000",rgba:0},function(i){i.toCss=function(a,p,g,m){return m!==void 0?`#${r(a)}${r(p)}${r(g)}${r(m)}`:`#${r(a)}${r(p)}${r(g)}`},i.toRgba=function(a,p,g,m=255){return(a<<24|p<<16|g<<8|m)>>>0},i.toColor=function(a,p,g,m){return{css:i.toCss(a,p,g,m),rgba:i.toRgba(a,p,g,m)}}}(_||(t.channels=_={})),function(i){function a(p,g){return o=Math.round(255*g),[n,c,u]=s.toChannels(p.rgba),{css:_.toCss(n,c,u,o),rgba:_.toRgba(n,c,u,o)}}i.blend=function(p,g){if(o=(255&g.rgba)/255,o===1)return{css:g.css,rgba:g.rgba};const m=g.rgba>>24&255,d=g.rgba>>16&255,C=g.rgba>>8&255,R=p.rgba>>24&255,A=p.rgba>>16&255,T=p.rgba>>8&255;return n=R+Math.round((m-R)*o),c=A+Math.round((d-A)*o),u=T+Math.round((C-T)*o),{css:_.toCss(n,c,u),rgba:_.toRgba(n,c,u)}},i.isOpaque=function(p){return(255&p.rgba)==255},i.ensureContrastRatio=function(p,g,m){const d=s.ensureContrastRatio(p.rgba,g.rgba,m);if(d)return _.toColor(d>>24&255,d>>16&255,d>>8&255)},i.opaque=function(p){const g=(255|p.rgba)>>>0;return[n,c,u]=s.toChannels(g),{css:_.toCss(n,c,u),rgba:g}},i.opacity=a,i.multiplyOpacity=function(p,g){return o=255&p.rgba,a(p,o*g/255)},i.toColorRGB=function(p){return[p.rgba>>24&255,p.rgba>>16&255,p.rgba>>8&255]}}(f||(t.color=f={})),function(i){let a,p;try{const g=document.createElement("canvas");g.width=1,g.height=1;const m=g.getContext("2d",{willReadFrequently:!0});m&&(a=m,a.globalCompositeOperation="copy",p=a.createLinearGradient(0,0,1,1))}catch{}i.toColor=function(g){if(g.match(/#[\da-f]{3,8}/i))switch(g.length){case 4:return n=parseInt(g.slice(1,2).repeat(2),16),c=parseInt(g.slice(2,3).repeat(2),16),u=parseInt(g.slice(3,4).repeat(2),16),_.toColor(n,c,u);case 5:return n=parseInt(g.slice(1,2).repeat(2),16),c=parseInt(g.slice(2,3).repeat(2),16),u=parseInt(g.slice(3,4).repeat(2),16),o=parseInt(g.slice(4,5).repeat(2),16),_.toColor(n,c,u,o);case 7:return{css:g,rgba:(parseInt(g.slice(1),16)<<8|255)>>>0};case 9:return{css:g,rgba:parseInt(g.slice(1),16)>>>0}}const m=g.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(m)return n=parseInt(m[1]),c=parseInt(m[2]),u=parseInt(m[3]),o=Math.round(255*(m[5]===void 0?1:parseFloat(m[5]))),_.toColor(n,c,u,o);if(!a||!p)throw new Error("css.toColor: Unsupported css format");if(a.fillStyle=p,a.fillStyle=g,typeof a.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if(a.fillRect(0,0,1,1),[n,c,u,o]=a.getImageData(0,0,1,1).data,o!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:_.toRgba(n,c,u,o),css:g}}}(S||(t.css=S={})),function(i){function a(p,g,m){const d=p/255,C=g/255,R=m/255;return .2126*(d<=.03928?d/12.92:Math.pow((d+.055)/1.055,2.4))+.7152*(C<=.03928?C/12.92:Math.pow((C+.055)/1.055,2.4))+.0722*(R<=.03928?R/12.92:Math.pow((R+.055)/1.055,2.4))}i.relativeLuminance=function(p){return a(p>>16&255,p>>8&255,255&p)},i.relativeLuminance2=a}(l||(t.rgb=l={})),function(i){function a(g,m,d){const C=g>>24&255,R=g>>16&255,A=g>>8&255;let T=m>>24&255,L=m>>16&255,H=m>>8&255,N=e(l.relativeLuminance2(T,L,H),l.relativeLuminance2(C,R,A));for(;N<d&&(T>0||L>0||H>0);)T-=Math.max(0,Math.ceil(.1*T)),L-=Math.max(0,Math.ceil(.1*L)),H-=Math.max(0,Math.ceil(.1*H)),N=e(l.relativeLuminance2(T,L,H),l.relativeLuminance2(C,R,A));return(T<<24|L<<16|H<<8|255)>>>0}function p(g,m,d){const C=g>>24&255,R=g>>16&255,A=g>>8&255;let T=m>>24&255,L=m>>16&255,H=m>>8&255,N=e(l.relativeLuminance2(T,L,H),l.relativeLuminance2(C,R,A));for(;N<d&&(T<255||L<255||H<255);)T=Math.min(255,T+Math.ceil(.1*(255-T))),L=Math.min(255,L+Math.ceil(.1*(255-L))),H=Math.min(255,H+Math.ceil(.1*(255-H))),N=e(l.relativeLuminance2(T,L,H),l.relativeLuminance2(C,R,A));return(T<<24|L<<16|H<<8|255)>>>0}i.blend=function(g,m){if(o=(255&m)/255,o===1)return m;const d=m>>24&255,C=m>>16&255,R=m>>8&255,A=g>>24&255,T=g>>16&255,L=g>>8&255;return n=A+Math.round((d-A)*o),c=T+Math.round((C-T)*o),u=L+Math.round((R-L)*o),_.toRgba(n,c,u)},i.ensureContrastRatio=function(g,m,d){const C=l.relativeLuminance(g>>8),R=l.relativeLuminance(m>>8);if(e(C,R)<d){if(R<C){const L=a(g,m,d),H=e(C,l.relativeLuminance(L>>8));if(H<d){const N=p(g,m,d);return H>e(C,l.relativeLuminance(N>>8))?L:N}return L}const A=p(g,m,d),T=e(C,l.relativeLuminance(A>>8));if(T<d){const L=a(g,m,d);return T>e(C,l.relativeLuminance(L>>8))?A:L}return A}},i.reduceLuminance=a,i.increaseLuminance=p,i.toChannels=function(g){return[g>>24&255,g>>16&255,g>>8&255,255&g]}}(s||(t.rgba=s={})),t.toPaddedHex=r,t.contrastRatio=e},8969:(x,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CoreTerminal=void 0;const c=n(844),u=n(2585),o=n(4348),_=n(7866),f=n(744),S=n(7302),l=n(6975),s=n(8460),r=n(1753),e=n(1480),i=n(7994),a=n(9282),p=n(5435),g=n(5981),m=n(2660);let d=!1;class C extends c.Disposable{get onScroll(){return this._onScrollApi||(this._onScrollApi=this.register(new s.EventEmitter),this._onScroll.event(A=>{var T;(T=this._onScrollApi)==null||T.fire(A.position)})),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(A){for(const T in A)this.optionsService.options[T]=A[T]}constructor(A){super(),this._windowsWrappingHeuristics=this.register(new c.MutableDisposable),this._onBinary=this.register(new s.EventEmitter),this.onBinary=this._onBinary.event,this._onData=this.register(new s.EventEmitter),this.onData=this._onData.event,this._onLineFeed=this.register(new s.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onResize=this.register(new s.EventEmitter),this.onResize=this._onResize.event,this._onWriteParsed=this.register(new s.EventEmitter),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this.register(new s.EventEmitter),this._instantiationService=new o.InstantiationService,this.optionsService=this.register(new S.OptionsService(A)),this._instantiationService.setService(u.IOptionsService,this.optionsService),this._bufferService=this.register(this._instantiationService.createInstance(f.BufferService)),this._instantiationService.setService(u.IBufferService,this._bufferService),this._logService=this.register(this._instantiationService.createInstance(_.LogService)),this._instantiationService.setService(u.ILogService,this._logService),this.coreService=this.register(this._instantiationService.createInstance(l.CoreService)),this._instantiationService.setService(u.ICoreService,this.coreService),this.coreMouseService=this.register(this._instantiationService.createInstance(r.CoreMouseService)),this._instantiationService.setService(u.ICoreMouseService,this.coreMouseService),this.unicodeService=this.register(this._instantiationService.createInstance(e.UnicodeService)),this._instantiationService.setService(u.IUnicodeService,this.unicodeService),this._charsetService=this._instantiationService.createInstance(i.CharsetService),this._instantiationService.setService(u.ICharsetService,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(m.OscLinkService),this._instantiationService.setService(u.IOscLinkService,this._oscLinkService),this._inputHandler=this.register(new p.InputHandler(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this.register((0,s.forwardEvent)(this._inputHandler.onLineFeed,this._onLineFeed)),this.register(this._inputHandler),this.register((0,s.forwardEvent)(this._bufferService.onResize,this._onResize)),this.register((0,s.forwardEvent)(this.coreService.onData,this._onData)),this.register((0,s.forwardEvent)(this.coreService.onBinary,this._onBinary)),this.register(this.coreService.onRequestScrollToBottom(()=>this.scrollToBottom())),this.register(this.coreService.onUserInput(()=>this._writeBuffer.handleUserInput())),this.register(this.optionsService.onMultipleOptionChange(["windowsMode","windowsPty"],()=>this._handleWindowsPtyOptionChange())),this.register(this._bufferService.onScroll(T=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this.register(this._inputHandler.onScroll(T=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this._writeBuffer=this.register(new g.WriteBuffer((T,L)=>this._inputHandler.parse(T,L))),this.register((0,s.forwardEvent)(this._writeBuffer.onWriteParsed,this._onWriteParsed))}write(A,T){this._writeBuffer.write(A,T)}writeSync(A,T){this._logService.logLevel<=u.LogLevelEnum.WARN&&!d&&(this._logService.warn("writeSync is unreliable and will be removed soon."),d=!0),this._writeBuffer.writeSync(A,T)}input(A,T=!0){this.coreService.triggerDataEvent(A,T)}resize(A,T){isNaN(A)||isNaN(T)||(A=Math.max(A,f.MINIMUM_COLS),T=Math.max(T,f.MINIMUM_ROWS),this._bufferService.resize(A,T))}scroll(A,T=!1){this._bufferService.scroll(A,T)}scrollLines(A,T,L){this._bufferService.scrollLines(A,T,L)}scrollPages(A){this.scrollLines(A*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(){this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(A){const T=A-this._bufferService.buffer.ydisp;T!==0&&this.scrollLines(T)}registerEscHandler(A,T){return this._inputHandler.registerEscHandler(A,T)}registerDcsHandler(A,T){return this._inputHandler.registerDcsHandler(A,T)}registerCsiHandler(A,T){return this._inputHandler.registerCsiHandler(A,T)}registerOscHandler(A,T){return this._inputHandler.registerOscHandler(A,T)}_setup(){this._handleWindowsPtyOptionChange()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsPtyOptionChange(){let A=!1;const T=this.optionsService.rawOptions.windowsPty;T&&T.buildNumber!==void 0&&T.buildNumber!==void 0?A=T.backend==="conpty"&&T.buildNumber<21376:this.optionsService.rawOptions.windowsMode&&(A=!0),A?this._enableWindowsWrappingHeuristics():this._windowsWrappingHeuristics.clear()}_enableWindowsWrappingHeuristics(){if(!this._windowsWrappingHeuristics.value){const A=[];A.push(this.onLineFeed(a.updateWindowsModeWrappedState.bind(null,this._bufferService))),A.push(this.registerCsiHandler({final:"H"},()=>((0,a.updateWindowsModeWrappedState)(this._bufferService),!1))),this._windowsWrappingHeuristics.value=(0,c.toDisposable)(()=>{for(const T of A)T.dispose()})}}}t.CoreTerminal=C},8460:(x,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.runAndSubscribe=t.forwardEvent=t.EventEmitter=void 0,t.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=n=>(this._listeners.push(n),{dispose:()=>{if(!this._disposed){for(let c=0;c<this._listeners.length;c++)if(this._listeners[c]===n)return void this._listeners.splice(c,1)}}})),this._event}fire(n,c){const u=[];for(let o=0;o<this._listeners.length;o++)u.push(this._listeners[o]);for(let o=0;o<u.length;o++)u[o].call(void 0,n,c)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},t.forwardEvent=function(n,c){return n(u=>c.fire(u))},t.runAndSubscribe=function(n,c){return c(void 0),n(u=>c(u))}},5435:function(x,t,n){var c=this&&this.__decorate||function(F,b,E,D){var B,U=arguments.length,z=U<3?b:D===null?D=Object.getOwnPropertyDescriptor(b,E):D;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")z=Reflect.decorate(F,b,E,D);else for(var G=F.length-1;G>=0;G--)(B=F[G])&&(z=(U<3?B(z):U>3?B(b,E,z):B(b,E))||z);return U>3&&z&&Object.defineProperty(b,E,z),z},u=this&&this.__param||function(F,b){return function(E,D){b(E,D,F)}};Object.defineProperty(t,"__esModule",{value:!0}),t.InputHandler=t.WindowsOptionsReportType=void 0;const o=n(2584),_=n(7116),f=n(2015),S=n(844),l=n(482),s=n(8437),r=n(8460),e=n(643),i=n(511),a=n(3734),p=n(2585),g=n(1480),m=n(6242),d=n(6351),C=n(5941),R={"(":0,")":1,"*":2,"+":3,"-":1,".":2},A=131072;function T(F,b){if(F>24)return b.setWinLines||!1;switch(F){case 1:return!!b.restoreWin;case 2:return!!b.minimizeWin;case 3:return!!b.setWinPosition;case 4:return!!b.setWinSizePixels;case 5:return!!b.raiseWin;case 6:return!!b.lowerWin;case 7:return!!b.refreshWin;case 8:return!!b.setWinSizeChars;case 9:return!!b.maximizeWin;case 10:return!!b.fullscreenWin;case 11:return!!b.getWinState;case 13:return!!b.getWinPosition;case 14:return!!b.getWinSizePixels;case 15:return!!b.getScreenSizePixels;case 16:return!!b.getCellSizePixels;case 18:return!!b.getWinSizeChars;case 19:return!!b.getScreenSizeChars;case 20:return!!b.getIconTitle;case 21:return!!b.getWinTitle;case 22:return!!b.pushTitle;case 23:return!!b.popTitle;case 24:return!!b.setWinLines}return!1}var L;(function(F){F[F.GET_WIN_SIZE_PIXELS=0]="GET_WIN_SIZE_PIXELS",F[F.GET_CELL_SIZE_PIXELS=1]="GET_CELL_SIZE_PIXELS"})(L||(t.WindowsOptionsReportType=L={}));let H=0;class N extends S.Disposable{getAttrData(){return this._curAttrData}constructor(b,E,D,B,U,z,G,J,O=new f.EscapeSequenceParser){super(),this._bufferService=b,this._charsetService=E,this._coreService=D,this._logService=B,this._optionsService=U,this._oscLinkService=z,this._coreMouseService=G,this._unicodeService=J,this._parser=O,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new l.StringToUtf32,this._utf8Decoder=new l.Utf8ToUtf32,this._workCell=new i.CellData,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=s.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=s.DEFAULT_ATTR_DATA.clone(),this._onRequestBell=this.register(new r.EventEmitter),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this.register(new r.EventEmitter),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this.register(new r.EventEmitter),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this.register(new r.EventEmitter),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this.register(new r.EventEmitter),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this.register(new r.EventEmitter),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this.register(new r.EventEmitter),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this.register(new r.EventEmitter),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this.register(new r.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this.register(new r.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onScroll=this.register(new r.EventEmitter),this.onScroll=this._onScroll.event,this._onTitleChange=this.register(new r.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onColor=this.register(new r.EventEmitter),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this.register(this._parser),this._dirtyRowTracker=new $(this._bufferService),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate(y=>this._activeBuffer=y.activeBuffer)),this._parser.setCsiHandlerFallback((y,j)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(y),params:j.toArray()})}),this._parser.setEscHandlerFallback(y=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(y)})}),this._parser.setExecuteHandlerFallback(y=>{this._logService.debug("Unknown EXECUTE code: ",{code:y})}),this._parser.setOscHandlerFallback((y,j,W)=>{this._logService.debug("Unknown OSC code: ",{identifier:y,action:j,data:W})}),this._parser.setDcsHandlerFallback((y,j,W)=>{j==="HOOK"&&(W=W.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(y),action:j,payload:W})}),this._parser.setPrintHandler((y,j,W)=>this.print(y,j,W)),this._parser.registerCsiHandler({final:"@"},y=>this.insertChars(y)),this._parser.registerCsiHandler({intermediates:" ",final:"@"},y=>this.scrollLeft(y)),this._parser.registerCsiHandler({final:"A"},y=>this.cursorUp(y)),this._parser.registerCsiHandler({intermediates:" ",final:"A"},y=>this.scrollRight(y)),this._parser.registerCsiHandler({final:"B"},y=>this.cursorDown(y)),this._parser.registerCsiHandler({final:"C"},y=>this.cursorForward(y)),this._parser.registerCsiHandler({final:"D"},y=>this.cursorBackward(y)),this._parser.registerCsiHandler({final:"E"},y=>this.cursorNextLine(y)),this._parser.registerCsiHandler({final:"F"},y=>this.cursorPrecedingLine(y)),this._parser.registerCsiHandler({final:"G"},y=>this.cursorCharAbsolute(y)),this._parser.registerCsiHandler({final:"H"},y=>this.cursorPosition(y)),this._parser.registerCsiHandler({final:"I"},y=>this.cursorForwardTab(y)),this._parser.registerCsiHandler({final:"J"},y=>this.eraseInDisplay(y,!1)),this._parser.registerCsiHandler({prefix:"?",final:"J"},y=>this.eraseInDisplay(y,!0)),this._parser.registerCsiHandler({final:"K"},y=>this.eraseInLine(y,!1)),this._parser.registerCsiHandler({prefix:"?",final:"K"},y=>this.eraseInLine(y,!0)),this._parser.registerCsiHandler({final:"L"},y=>this.insertLines(y)),this._parser.registerCsiHandler({final:"M"},y=>this.deleteLines(y)),this._parser.registerCsiHandler({final:"P"},y=>this.deleteChars(y)),this._parser.registerCsiHandler({final:"S"},y=>this.scrollUp(y)),this._parser.registerCsiHandler({final:"T"},y=>this.scrollDown(y)),this._parser.registerCsiHandler({final:"X"},y=>this.eraseChars(y)),this._parser.registerCsiHandler({final:"Z"},y=>this.cursorBackwardTab(y)),this._parser.registerCsiHandler({final:"`"},y=>this.charPosAbsolute(y)),this._parser.registerCsiHandler({final:"a"},y=>this.hPositionRelative(y)),this._parser.registerCsiHandler({final:"b"},y=>this.repeatPrecedingCharacter(y)),this._parser.registerCsiHandler({final:"c"},y=>this.sendDeviceAttributesPrimary(y)),this._parser.registerCsiHandler({prefix:">",final:"c"},y=>this.sendDeviceAttributesSecondary(y)),this._parser.registerCsiHandler({final:"d"},y=>this.linePosAbsolute(y)),this._parser.registerCsiHandler({final:"e"},y=>this.vPositionRelative(y)),this._parser.registerCsiHandler({final:"f"},y=>this.hVPosition(y)),this._parser.registerCsiHandler({final:"g"},y=>this.tabClear(y)),this._parser.registerCsiHandler({final:"h"},y=>this.setMode(y)),this._parser.registerCsiHandler({prefix:"?",final:"h"},y=>this.setModePrivate(y)),this._parser.registerCsiHandler({final:"l"},y=>this.resetMode(y)),this._parser.registerCsiHandler({prefix:"?",final:"l"},y=>this.resetModePrivate(y)),this._parser.registerCsiHandler({final:"m"},y=>this.charAttributes(y)),this._parser.registerCsiHandler({final:"n"},y=>this.deviceStatus(y)),this._parser.registerCsiHandler({prefix:"?",final:"n"},y=>this.deviceStatusPrivate(y)),this._parser.registerCsiHandler({intermediates:"!",final:"p"},y=>this.softReset(y)),this._parser.registerCsiHandler({intermediates:" ",final:"q"},y=>this.setCursorStyle(y)),this._parser.registerCsiHandler({final:"r"},y=>this.setScrollRegion(y)),this._parser.registerCsiHandler({final:"s"},y=>this.saveCursor(y)),this._parser.registerCsiHandler({final:"t"},y=>this.windowOptions(y)),this._parser.registerCsiHandler({final:"u"},y=>this.restoreCursor(y)),this._parser.registerCsiHandler({intermediates:"'",final:"}"},y=>this.insertColumns(y)),this._parser.registerCsiHandler({intermediates:"'",final:"~"},y=>this.deleteColumns(y)),this._parser.registerCsiHandler({intermediates:'"',final:"q"},y=>this.selectProtected(y)),this._parser.registerCsiHandler({intermediates:"$",final:"p"},y=>this.requestMode(y,!0)),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},y=>this.requestMode(y,!1)),this._parser.setExecuteHandler(o.C0.BEL,()=>this.bell()),this._parser.setExecuteHandler(o.C0.LF,()=>this.lineFeed()),this._parser.setExecuteHandler(o.C0.VT,()=>this.lineFeed()),this._parser.setExecuteHandler(o.C0.FF,()=>this.lineFeed()),this._parser.setExecuteHandler(o.C0.CR,()=>this.carriageReturn()),this._parser.setExecuteHandler(o.C0.BS,()=>this.backspace()),this._parser.setExecuteHandler(o.C0.HT,()=>this.tab()),this._parser.setExecuteHandler(o.C0.SO,()=>this.shiftOut()),this._parser.setExecuteHandler(o.C0.SI,()=>this.shiftIn()),this._parser.setExecuteHandler(o.C1.IND,()=>this.index()),this._parser.setExecuteHandler(o.C1.NEL,()=>this.nextLine()),this._parser.setExecuteHandler(o.C1.HTS,()=>this.tabSet()),this._parser.registerOscHandler(0,new m.OscHandler(y=>(this.setTitle(y),this.setIconName(y),!0))),this._parser.registerOscHandler(1,new m.OscHandler(y=>this.setIconName(y))),this._parser.registerOscHandler(2,new m.OscHandler(y=>this.setTitle(y))),this._parser.registerOscHandler(4,new m.OscHandler(y=>this.setOrReportIndexedColor(y))),this._parser.registerOscHandler(8,new m.OscHandler(y=>this.setHyperlink(y))),this._parser.registerOscHandler(10,new m.OscHandler(y=>this.setOrReportFgColor(y))),this._parser.registerOscHandler(11,new m.OscHandler(y=>this.setOrReportBgColor(y))),this._parser.registerOscHandler(12,new m.OscHandler(y=>this.setOrReportCursorColor(y))),this._parser.registerOscHandler(104,new m.OscHandler(y=>this.restoreIndexedColor(y))),this._parser.registerOscHandler(110,new m.OscHandler(y=>this.restoreFgColor(y))),this._parser.registerOscHandler(111,new m.OscHandler(y=>this.restoreBgColor(y))),this._parser.registerOscHandler(112,new m.OscHandler(y=>this.restoreCursorColor(y))),this._parser.registerEscHandler({final:"7"},()=>this.saveCursor()),this._parser.registerEscHandler({final:"8"},()=>this.restoreCursor()),this._parser.registerEscHandler({final:"D"},()=>this.index()),this._parser.registerEscHandler({final:"E"},()=>this.nextLine()),this._parser.registerEscHandler({final:"H"},()=>this.tabSet()),this._parser.registerEscHandler({final:"M"},()=>this.reverseIndex()),this._parser.registerEscHandler({final:"="},()=>this.keypadApplicationMode()),this._parser.registerEscHandler({final:">"},()=>this.keypadNumericMode()),this._parser.registerEscHandler({final:"c"},()=>this.fullReset()),this._parser.registerEscHandler({final:"n"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"o"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"|"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"}"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"~"},()=>this.setgLevel(1)),this._parser.registerEscHandler({intermediates:"%",final:"@"},()=>this.selectDefaultCharset()),this._parser.registerEscHandler({intermediates:"%",final:"G"},()=>this.selectDefaultCharset());for(const y in _.CHARSETS)this._parser.registerEscHandler({intermediates:"(",final:y},()=>this.selectCharset("("+y)),this._parser.registerEscHandler({intermediates:")",final:y},()=>this.selectCharset(")"+y)),this._parser.registerEscHandler({intermediates:"*",final:y},()=>this.selectCharset("*"+y)),this._parser.registerEscHandler({intermediates:"+",final:y},()=>this.selectCharset("+"+y)),this._parser.registerEscHandler({intermediates:"-",final:y},()=>this.selectCharset("-"+y)),this._parser.registerEscHandler({intermediates:".",final:y},()=>this.selectCharset("."+y)),this._parser.registerEscHandler({intermediates:"/",final:y},()=>this.selectCharset("/"+y));this._parser.registerEscHandler({intermediates:"#",final:"8"},()=>this.screenAlignmentPattern()),this._parser.setErrorHandler(y=>(this._logService.error("Parsing error: ",y),y)),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new d.DcsHandler((y,j)=>this.requestStatusString(y,j)))}_preserveStack(b,E,D,B){this._parseStack.paused=!0,this._parseStack.cursorStartX=b,this._parseStack.cursorStartY=E,this._parseStack.decodedLength=D,this._parseStack.position=B}_logSlowResolvingAsync(b){this._logService.logLevel<=p.LogLevelEnum.WARN&&Promise.race([b,new Promise((E,D)=>setTimeout(()=>D("#SLOW_TIMEOUT"),5e3))]).catch(E=>{if(E!=="#SLOW_TIMEOUT")throw E;console.warn("async parser handler taking longer than 5000 ms")})}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(b,E){let D,B=this._activeBuffer.x,U=this._activeBuffer.y,z=0;const G=this._parseStack.paused;if(G){if(D=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,E))return this._logSlowResolvingAsync(D),D;B=this._parseStack.cursorStartX,U=this._parseStack.cursorStartY,this._parseStack.paused=!1,b.length>A&&(z=this._parseStack.position+A)}if(this._logService.logLevel<=p.LogLevelEnum.DEBUG&&this._logService.debug("parsing data"+(typeof b=="string"?` "${b}"`:` "${Array.prototype.map.call(b,y=>String.fromCharCode(y)).join("")}"`),typeof b=="string"?b.split("").map(y=>y.charCodeAt(0)):b),this._parseBuffer.length<b.length&&this._parseBuffer.length<A&&(this._parseBuffer=new Uint32Array(Math.min(b.length,A))),G||this._dirtyRowTracker.clearRange(),b.length>A)for(let y=z;y<b.length;y+=A){const j=y+A<b.length?y+A:b.length,W=typeof b=="string"?this._stringDecoder.decode(b.substring(y,j),this._parseBuffer):this._utf8Decoder.decode(b.subarray(y,j),this._parseBuffer);if(D=this._parser.parse(this._parseBuffer,W))return this._preserveStack(B,U,W,y),this._logSlowResolvingAsync(D),D}else if(!G){const y=typeof b=="string"?this._stringDecoder.decode(b,this._parseBuffer):this._utf8Decoder.decode(b,this._parseBuffer);if(D=this._parser.parse(this._parseBuffer,y))return this._preserveStack(B,U,y,0),this._logSlowResolvingAsync(D),D}this._activeBuffer.x===B&&this._activeBuffer.y===U||this._onCursorMove.fire();const J=this._dirtyRowTracker.end+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp),O=this._dirtyRowTracker.start+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp);O<this._bufferService.rows&&this._onRequestRefreshRows.fire(Math.min(O,this._bufferService.rows-1),Math.min(J,this._bufferService.rows-1))}print(b,E,D){let B,U;const z=this._charsetService.charset,G=this._optionsService.rawOptions.screenReaderMode,J=this._bufferService.cols,O=this._coreService.decPrivateModes.wraparound,y=this._coreService.modes.insertMode,j=this._curAttrData;let W=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&D-E>0&&W.getWidth(this._activeBuffer.x-1)===2&&W.setCellFromCodepoint(this._activeBuffer.x-1,0,1,j);let q=this._parser.precedingJoinState;for(let V=E;V<D;++V){if(B=b[V],B<127&&z){const ae=z[String.fromCharCode(B)];ae&&(B=ae.charCodeAt(0))}const te=this._unicodeService.charProperties(B,q);U=g.UnicodeService.extractWidth(te);const ne=g.UnicodeService.extractShouldJoin(te),oe=ne?g.UnicodeService.extractWidth(q):0;if(q=te,G&&this._onA11yChar.fire((0,l.stringFromCodePoint)(B)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),this._activeBuffer.x+U-oe>J){if(O){const ae=W;let Z=this._activeBuffer.x-oe;for(this._activeBuffer.x=oe,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),W=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y),oe>0&&W instanceof s.BufferLine&&W.copyCellsFrom(ae,Z,0,oe,!1);Z<J;)ae.setCellFromCodepoint(Z++,0,1,j)}else if(this._activeBuffer.x=J-1,U===2)continue}if(ne&&this._activeBuffer.x){const ae=W.getWidth(this._activeBuffer.x-1)?1:2;W.addCodepointToCell(this._activeBuffer.x-ae,B,U);for(let Z=U-oe;--Z>=0;)W.setCellFromCodepoint(this._activeBuffer.x++,0,0,j)}else if(y&&(W.insertCells(this._activeBuffer.x,U-oe,this._activeBuffer.getNullCell(j)),W.getWidth(J-1)===2&&W.setCellFromCodepoint(J-1,e.NULL_CELL_CODE,e.NULL_CELL_WIDTH,j)),W.setCellFromCodepoint(this._activeBuffer.x++,B,U,j),U>0)for(;--U;)W.setCellFromCodepoint(this._activeBuffer.x++,0,0,j)}this._parser.precedingJoinState=q,this._activeBuffer.x<J&&D-E>0&&W.getWidth(this._activeBuffer.x)===0&&!W.hasContent(this._activeBuffer.x)&&W.setCellFromCodepoint(this._activeBuffer.x,0,1,j),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(b,E){return b.final!=="t"||b.prefix||b.intermediates?this._parser.registerCsiHandler(b,E):this._parser.registerCsiHandler(b,D=>!T(D.params[0],this._optionsService.rawOptions.windowOptions)||E(D))}registerDcsHandler(b,E){return this._parser.registerDcsHandler(b,new d.DcsHandler(E))}registerEscHandler(b,E){return this._parser.registerEscHandler(b,E)}registerOscHandler(b,E){return this._parser.registerOscHandler(b,new m.OscHandler(E))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows?this._activeBuffer.y=this._bufferService.rows-1:this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){var b;if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(this._activeBuffer.x===0&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&((b=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y))!=null&&b.isWrapped)){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;const E=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);E.hasWidth(this._activeBuffer.x)&&!E.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;const b=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-b),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(b=this._bufferService.cols-1){this._activeBuffer.x=Math.min(b,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(b,E){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=b,this._activeBuffer.y=this._activeBuffer.scrollTop+E):(this._activeBuffer.x=b,this._activeBuffer.y=E),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(b,E){this._restrictCursor(),this._setCursor(this._activeBuffer.x+b,this._activeBuffer.y+E)}cursorUp(b){const E=this._activeBuffer.y-this._activeBuffer.scrollTop;return E>=0?this._moveCursor(0,-Math.min(E,b.params[0]||1)):this._moveCursor(0,-(b.params[0]||1)),!0}cursorDown(b){const E=this._activeBuffer.scrollBottom-this._activeBuffer.y;return E>=0?this._moveCursor(0,Math.min(E,b.params[0]||1)):this._moveCursor(0,b.params[0]||1),!0}cursorForward(b){return this._moveCursor(b.params[0]||1,0),!0}cursorBackward(b){return this._moveCursor(-(b.params[0]||1),0),!0}cursorNextLine(b){return this.cursorDown(b),this._activeBuffer.x=0,!0}cursorPrecedingLine(b){return this.cursorUp(b),this._activeBuffer.x=0,!0}cursorCharAbsolute(b){return this._setCursor((b.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(b){return this._setCursor(b.length>=2?(b.params[1]||1)-1:0,(b.params[0]||1)-1),!0}charPosAbsolute(b){return this._setCursor((b.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(b){return this._moveCursor(b.params[0]||1,0),!0}linePosAbsolute(b){return this._setCursor(this._activeBuffer.x,(b.params[0]||1)-1),!0}vPositionRelative(b){return this._moveCursor(0,b.params[0]||1),!0}hVPosition(b){return this.cursorPosition(b),!0}tabClear(b){const E=b.params[0];return E===0?delete this._activeBuffer.tabs[this._activeBuffer.x]:E===3&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(b){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let E=b.params[0]||1;for(;E--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(b){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let E=b.params[0]||1;for(;E--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(b){const E=b.params[0];return E===1&&(this._curAttrData.bg|=536870912),E!==2&&E!==0||(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(b,E,D,B=!1,U=!1){const z=this._activeBuffer.lines.get(this._activeBuffer.ybase+b);z.replaceCells(E,D,this._activeBuffer.getNullCell(this._eraseAttrData()),U),B&&(z.isWrapped=!1)}_resetBufferLine(b,E=!1){const D=this._activeBuffer.lines.get(this._activeBuffer.ybase+b);D&&(D.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),E),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+b),D.isWrapped=!1)}eraseInDisplay(b,E=!1){let D;switch(this._restrictCursor(this._bufferService.cols),b.params[0]){case 0:for(D=this._activeBuffer.y,this._dirtyRowTracker.markDirty(D),this._eraseInBufferLine(D++,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,E);D<this._bufferService.rows;D++)this._resetBufferLine(D,E);this._dirtyRowTracker.markDirty(D);break;case 1:for(D=this._activeBuffer.y,this._dirtyRowTracker.markDirty(D),this._eraseInBufferLine(D,0,this._activeBuffer.x+1,!0,E),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(D+1).isWrapped=!1);D--;)this._resetBufferLine(D,E);this._dirtyRowTracker.markDirty(0);break;case 2:for(D=this._bufferService.rows,this._dirtyRowTracker.markDirty(D-1);D--;)this._resetBufferLine(D,E);this._dirtyRowTracker.markDirty(0);break;case 3:const B=this._activeBuffer.lines.length-this._bufferService.rows;B>0&&(this._activeBuffer.lines.trimStart(B),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-B,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-B,0),this._onScroll.fire(0))}return!0}eraseInLine(b,E=!1){switch(this._restrictCursor(this._bufferService.cols),b.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,E);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,E);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,E)}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(b){this._restrictCursor();let E=b.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const D=this._activeBuffer.ybase+this._activeBuffer.y,B=this._bufferService.rows-1-this._activeBuffer.scrollBottom,U=this._bufferService.rows-1+this._activeBuffer.ybase-B+1;for(;E--;)this._activeBuffer.lines.splice(U-1,1),this._activeBuffer.lines.splice(D,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(b){this._restrictCursor();let E=b.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const D=this._activeBuffer.ybase+this._activeBuffer.y;let B;for(B=this._bufferService.rows-1-this._activeBuffer.scrollBottom,B=this._bufferService.rows-1+this._activeBuffer.ybase-B;E--;)this._activeBuffer.lines.splice(D,1),this._activeBuffer.lines.splice(B,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(b){this._restrictCursor();const E=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return E&&(E.insertCells(this._activeBuffer.x,b.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(b){this._restrictCursor();const E=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return E&&(E.deleteCells(this._activeBuffer.x,b.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(b){let E=b.params[0]||1;for(;E--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(b){let E=b.params[0]||1;for(;E--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(s.DEFAULT_ATTR_DATA));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(b){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const E=b.params[0]||1;for(let D=this._activeBuffer.scrollTop;D<=this._activeBuffer.scrollBottom;++D){const B=this._activeBuffer.lines.get(this._activeBuffer.ybase+D);B.deleteCells(0,E,this._activeBuffer.getNullCell(this._eraseAttrData())),B.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(b){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const E=b.params[0]||1;for(let D=this._activeBuffer.scrollTop;D<=this._activeBuffer.scrollBottom;++D){const B=this._activeBuffer.lines.get(this._activeBuffer.ybase+D);B.insertCells(0,E,this._activeBuffer.getNullCell(this._eraseAttrData())),B.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(b){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const E=b.params[0]||1;for(let D=this._activeBuffer.scrollTop;D<=this._activeBuffer.scrollBottom;++D){const B=this._activeBuffer.lines.get(this._activeBuffer.ybase+D);B.insertCells(this._activeBuffer.x,E,this._activeBuffer.getNullCell(this._eraseAttrData())),B.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(b){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const E=b.params[0]||1;for(let D=this._activeBuffer.scrollTop;D<=this._activeBuffer.scrollBottom;++D){const B=this._activeBuffer.lines.get(this._activeBuffer.ybase+D);B.deleteCells(this._activeBuffer.x,E,this._activeBuffer.getNullCell(this._eraseAttrData())),B.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(b){this._restrictCursor();const E=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return E&&(E.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(b.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(b){const E=this._parser.precedingJoinState;if(!E)return!0;const D=b.params[0]||1,B=g.UnicodeService.extractWidth(E),U=this._activeBuffer.x-B,z=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).getString(U),G=new Uint32Array(z.length*D);let J=0;for(let y=0;y<z.length;){const j=z.codePointAt(y)||0;G[J++]=j,y+=j>65535?2:1}let O=J;for(let y=1;y<D;++y)G.copyWithin(O,0,J),O+=J;return this.print(G,0,O),!0}sendDeviceAttributesPrimary(b){return b.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(o.C0.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(o.C0.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(b){return b.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(o.C0.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(o.C0.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(b.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(o.C0.ESC+"[>83;40003;0c")),!0}_is(b){return(this._optionsService.rawOptions.termName+"").indexOf(b)===0}setMode(b){for(let E=0;E<b.length;E++)switch(b.params[E]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0}return!0}setModePrivate(b){for(let E=0;E<b.length;E++)switch(b.params[E]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,_.DEFAULT_CHARSET),this._charsetService.setgCharset(1,_.DEFAULT_CHARSET),this._charsetService.setgCharset(2,_.DEFAULT_CHARSET),this._charsetService.setgCharset(3,_.DEFAULT_CHARSET);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0}return!0}resetMode(b){for(let E=0;E<b.length;E++)switch(b.params[E]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1}return!0}resetModePrivate(b){for(let E=0;E<b.length;E++)switch(b.params[E]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),b.params[E]===1049&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1}return!0}requestMode(b,E){const D=this._coreService.decPrivateModes,{activeProtocol:B,activeEncoding:U}=this._coreMouseService,z=this._coreService,{buffers:G,cols:J}=this._bufferService,{active:O,alt:y}=G,j=this._optionsService.rawOptions,W=ne=>ne?1:2,q=b.params[0];return V=q,te=E?q===2?4:q===4?W(z.modes.insertMode):q===12?3:q===20?W(j.convertEol):0:q===1?W(D.applicationCursorKeys):q===3?j.windowOptions.setWinLines?J===80?2:J===132?1:0:0:q===6?W(D.origin):q===7?W(D.wraparound):q===8?3:q===9?W(B==="X10"):q===12?W(j.cursorBlink):q===25?W(!z.isCursorHidden):q===45?W(D.reverseWraparound):q===66?W(D.applicationKeypad):q===67?4:q===1e3?W(B==="VT200"):q===1002?W(B==="DRAG"):q===1003?W(B==="ANY"):q===1004?W(D.sendFocus):q===1005?4:q===1006?W(U==="SGR"):q===1015?4:q===1016?W(U==="SGR_PIXELS"):q===1048?1:q===47||q===1047||q===1049?W(O===y):q===2004?W(D.bracketedPasteMode):0,z.triggerDataEvent(`${o.C0.ESC}[${E?"":"?"}${V};${te}$y`),!0;var V,te}_updateAttrColor(b,E,D,B,U){return E===2?(b|=50331648,b&=-16777216,b|=a.AttributeData.fromColorRGB([D,B,U])):E===5&&(b&=-50331904,b|=33554432|255&D),b}_extractColor(b,E,D){const B=[0,0,-1,0,0,0];let U=0,z=0;do{if(B[z+U]=b.params[E+z],b.hasSubParams(E+z)){const G=b.getSubParams(E+z);let J=0;do B[1]===5&&(U=1),B[z+J+1+U]=G[J];while(++J<G.length&&J+z+1+U<B.length);break}if(B[1]===5&&z+U>=2||B[1]===2&&z+U>=5)break;B[1]&&(U=1)}while(++z+E<b.length&&z+U<B.length);for(let G=2;G<B.length;++G)B[G]===-1&&(B[G]=0);switch(B[0]){case 38:D.fg=this._updateAttrColor(D.fg,B[1],B[3],B[4],B[5]);break;case 48:D.bg=this._updateAttrColor(D.bg,B[1],B[3],B[4],B[5]);break;case 58:D.extended=D.extended.clone(),D.extended.underlineColor=this._updateAttrColor(D.extended.underlineColor,B[1],B[3],B[4],B[5])}return z}_processUnderline(b,E){E.extended=E.extended.clone(),(!~b||b>5)&&(b=1),E.extended.underlineStyle=b,E.fg|=268435456,b===0&&(E.fg&=-268435457),E.updateExtended()}_processSGR0(b){b.fg=s.DEFAULT_ATTR_DATA.fg,b.bg=s.DEFAULT_ATTR_DATA.bg,b.extended=b.extended.clone(),b.extended.underlineStyle=0,b.extended.underlineColor&=-67108864,b.updateExtended()}charAttributes(b){if(b.length===1&&b.params[0]===0)return this._processSGR0(this._curAttrData),!0;const E=b.length;let D;const B=this._curAttrData;for(let U=0;U<E;U++)D=b.params[U],D>=30&&D<=37?(B.fg&=-50331904,B.fg|=16777216|D-30):D>=40&&D<=47?(B.bg&=-50331904,B.bg|=16777216|D-40):D>=90&&D<=97?(B.fg&=-50331904,B.fg|=16777224|D-90):D>=100&&D<=107?(B.bg&=-50331904,B.bg|=16777224|D-100):D===0?this._processSGR0(B):D===1?B.fg|=134217728:D===3?B.bg|=67108864:D===4?(B.fg|=268435456,this._processUnderline(b.hasSubParams(U)?b.getSubParams(U)[0]:1,B)):D===5?B.fg|=536870912:D===7?B.fg|=67108864:D===8?B.fg|=1073741824:D===9?B.fg|=2147483648:D===2?B.bg|=134217728:D===21?this._processUnderline(2,B):D===22?(B.fg&=-134217729,B.bg&=-134217729):D===23?B.bg&=-67108865:D===24?(B.fg&=-268435457,this._processUnderline(0,B)):D===25?B.fg&=-536870913:D===27?B.fg&=-67108865:D===28?B.fg&=-1073741825:D===29?B.fg&=2147483647:D===39?(B.fg&=-67108864,B.fg|=16777215&s.DEFAULT_ATTR_DATA.fg):D===49?(B.bg&=-67108864,B.bg|=16777215&s.DEFAULT_ATTR_DATA.bg):D===38||D===48||D===58?U+=this._extractColor(b,U,B):D===53?B.bg|=1073741824:D===55?B.bg&=-1073741825:D===59?(B.extended=B.extended.clone(),B.extended.underlineColor=-1,B.updateExtended()):D===100?(B.fg&=-67108864,B.fg|=16777215&s.DEFAULT_ATTR_DATA.fg,B.bg&=-67108864,B.bg|=16777215&s.DEFAULT_ATTR_DATA.bg):this._logService.debug("Unknown SGR attribute: %d.",D);return!0}deviceStatus(b){switch(b.params[0]){case 5:this._coreService.triggerDataEvent(`${o.C0.ESC}[0n`);break;case 6:const E=this._activeBuffer.y+1,D=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${o.C0.ESC}[${E};${D}R`)}return!0}deviceStatusPrivate(b){if(b.params[0]===6){const E=this._activeBuffer.y+1,D=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${o.C0.ESC}[?${E};${D}R`)}return!0}softReset(b){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=s.DEFAULT_ATTR_DATA.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(b){const E=b.params[0]||1;switch(E){case 1:case 2:this._optionsService.options.cursorStyle="block";break;case 3:case 4:this._optionsService.options.cursorStyle="underline";break;case 5:case 6:this._optionsService.options.cursorStyle="bar"}const D=E%2==1;return this._optionsService.options.cursorBlink=D,!0}setScrollRegion(b){const E=b.params[0]||1;let D;return(b.length<2||(D=b.params[1])>this._bufferService.rows||D===0)&&(D=this._bufferService.rows),D>E&&(this._activeBuffer.scrollTop=E-1,this._activeBuffer.scrollBottom=D-1,this._setCursor(0,0)),!0}windowOptions(b){if(!T(b.params[0],this._optionsService.rawOptions.windowOptions))return!0;const E=b.length>1?b.params[1]:0;switch(b.params[0]){case 14:E!==2&&this._onRequestWindowsOptionsReport.fire(L.GET_WIN_SIZE_PIXELS);break;case 16:this._onRequestWindowsOptionsReport.fire(L.GET_CELL_SIZE_PIXELS);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${o.C0.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:E!==0&&E!==2||(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>10&&this._windowTitleStack.shift()),E!==0&&E!==1||(this._iconNameStack.push(this._iconName),this._iconNameStack.length>10&&this._iconNameStack.shift());break;case 23:E!==0&&E!==2||this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),E!==0&&E!==1||this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop())}return!0}saveCursor(b){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(b){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(b){return this._windowTitle=b,this._onTitleChange.fire(b),!0}setIconName(b){return this._iconName=b,!0}setOrReportIndexedColor(b){const E=[],D=b.split(";");for(;D.length>1;){const B=D.shift(),U=D.shift();if(/^\d+$/.exec(B)){const z=parseInt(B);if(I(z))if(U==="?")E.push({type:0,index:z});else{const G=(0,C.parseColor)(U);G&&E.push({type:1,index:z,color:G})}}}return E.length&&this._onColor.fire(E),!0}setHyperlink(b){const E=b.split(";");return!(E.length<2)&&(E[1]?this._createHyperlink(E[0],E[1]):!E[0]&&this._finishHyperlink())}_createHyperlink(b,E){this._getCurrentLinkId()&&this._finishHyperlink();const D=b.split(":");let B;const U=D.findIndex(z=>z.startsWith("id="));return U!==-1&&(B=D[U].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:B,uri:E}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(b,E){const D=b.split(";");for(let B=0;B<D.length&&!(E>=this._specialColors.length);++B,++E)if(D[B]==="?")this._onColor.fire([{type:0,index:this._specialColors[E]}]);else{const U=(0,C.parseColor)(D[B]);U&&this._onColor.fire([{type:1,index:this._specialColors[E],color:U}])}return!0}setOrReportFgColor(b){return this._setOrReportSpecialColor(b,0)}setOrReportBgColor(b){return this._setOrReportSpecialColor(b,1)}setOrReportCursorColor(b){return this._setOrReportSpecialColor(b,2)}restoreIndexedColor(b){if(!b)return this._onColor.fire([{type:2}]),!0;const E=[],D=b.split(";");for(let B=0;B<D.length;++B)if(/^\d+$/.exec(D[B])){const U=parseInt(D[B]);I(U)&&E.push({type:2,index:U})}return E.length&&this._onColor.fire(E),!0}restoreFgColor(b){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(b){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(b){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,_.DEFAULT_CHARSET),!0}selectCharset(b){return b.length!==2?(this.selectDefaultCharset(),!0):(b[0]==="/"||this._charsetService.setgCharset(R[b[0]],_.CHARSETS[b[1]]||_.DEFAULT_CHARSET),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){const b=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,b,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=s.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=s.DEFAULT_ATTR_DATA.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=67108863&this._curAttrData.bg,this._eraseAttrDataInternal}setgLevel(b){return this._charsetService.setgLevel(b),!0}screenAlignmentPattern(){const b=new i.CellData;b.content=4194373,b.fg=this._curAttrData.fg,b.bg=this._curAttrData.bg,this._setCursor(0,0);for(let E=0;E<this._bufferService.rows;++E){const D=this._activeBuffer.ybase+this._activeBuffer.y+E,B=this._activeBuffer.lines.get(D);B&&(B.fill(b),B.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(b,E){const D=this._bufferService.buffer,B=this._optionsService.rawOptions;return(U=>(this._coreService.triggerDataEvent(`${o.C0.ESC}${U}${o.C0.ESC}\\`),!0))(b==='"q'?`P1$r${this._curAttrData.isProtected()?1:0}"q`:b==='"p'?'P1$r61;1"p':b==="r"?`P1$r${D.scrollTop+1};${D.scrollBottom+1}r`:b==="m"?"P1$r0m":b===" q"?`P1$r${{block:2,underline:4,bar:6}[B.cursorStyle]-(B.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty(b,E){this._dirtyRowTracker.markRangeDirty(b,E)}}t.InputHandler=N;let $=class{constructor(F){this._bufferService=F,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty(F){F<this.start?this.start=F:F>this.end&&(this.end=F)}markRangeDirty(F,b){F>b&&(H=F,F=b,b=H),F<this.start&&(this.start=F),b>this.end&&(this.end=b)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};function I(F){return 0<=F&&F<256}$=c([u(0,p.IBufferService)],$)},844:(x,t)=>{function n(c){for(const u of c)u.dispose();c.length=0}Object.defineProperty(t,"__esModule",{value:!0}),t.getDisposeArrayDisposable=t.disposeArray=t.toDisposable=t.MutableDisposable=t.Disposable=void 0,t.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(const c of this._disposables)c.dispose();this._disposables.length=0}register(c){return this._disposables.push(c),c}unregister(c){const u=this._disposables.indexOf(c);u!==-1&&this._disposables.splice(u,1)}},t.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(c){var u;this._isDisposed||c===this._value||((u=this._value)==null||u.dispose(),this._value=c)}clear(){this.value=void 0}dispose(){var c;this._isDisposed=!0,(c=this._value)==null||c.dispose(),this._value=void 0}},t.toDisposable=function(c){return{dispose:c}},t.disposeArray=n,t.getDisposeArrayDisposable=function(c){return{dispose:()=>n(c)}}},1505:(x,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FourKeyMap=t.TwoKeyMap=void 0;class n{constructor(){this._data={}}set(u,o,_){this._data[u]||(this._data[u]={}),this._data[u][o]=_}get(u,o){return this._data[u]?this._data[u][o]:void 0}clear(){this._data={}}}t.TwoKeyMap=n,t.FourKeyMap=class{constructor(){this._data=new n}set(c,u,o,_,f){this._data.get(c,u)||this._data.set(c,u,new n),this._data.get(c,u).set(o,_,f)}get(c,u,o,_){var f;return(f=this._data.get(c,u))==null?void 0:f.get(o,_)}clear(){this._data.clear()}}},6114:(x,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isChromeOS=t.isLinux=t.isWindows=t.isIphone=t.isIpad=t.isMac=t.getSafariVersion=t.isSafari=t.isLegacyEdge=t.isFirefox=t.isNode=void 0,t.isNode=typeof process<"u"&&"title"in process;const n=t.isNode?"node":navigator.userAgent,c=t.isNode?"node":navigator.platform;t.isFirefox=n.includes("Firefox"),t.isLegacyEdge=n.includes("Edge"),t.isSafari=/^((?!chrome|android).)*safari/i.test(n),t.getSafariVersion=function(){if(!t.isSafari)return 0;const u=n.match(/Version\/(\d+)/);return u===null||u.length<2?0:parseInt(u[1])},t.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(c),t.isIpad=c==="iPad",t.isIphone=c==="iPhone",t.isWindows=["Windows","Win16","Win32","WinCE"].includes(c),t.isLinux=c.indexOf("Linux")>=0,t.isChromeOS=/\bCrOS\b/.test(n)},6106:(x,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SortedList=void 0;let n=0;t.SortedList=class{constructor(c){this._getKey=c,this._array=[]}clear(){this._array.length=0}insert(c){this._array.length!==0?(n=this._search(this._getKey(c)),this._array.splice(n,0,c)):this._array.push(c)}delete(c){if(this._array.length===0)return!1;const u=this._getKey(c);if(u===void 0||(n=this._search(u),n===-1)||this._getKey(this._array[n])!==u)return!1;do if(this._array[n]===c)return this._array.splice(n,1),!0;while(++n<this._array.length&&this._getKey(this._array[n])===u);return!1}*getKeyIterator(c){if(this._array.length!==0&&(n=this._search(c),!(n<0||n>=this._array.length)&&this._getKey(this._array[n])===c))do yield this._array[n];while(++n<this._array.length&&this._getKey(this._array[n])===c)}forEachByKey(c,u){if(this._array.length!==0&&(n=this._search(c),!(n<0||n>=this._array.length)&&this._getKey(this._array[n])===c))do u(this._array[n]);while(++n<this._array.length&&this._getKey(this._array[n])===c)}values(){return[...this._array].values()}_search(c){let u=0,o=this._array.length-1;for(;o>=u;){let _=u+o>>1;const f=this._getKey(this._array[_]);if(f>c)o=_-1;else{if(!(f<c)){for(;_>0&&this._getKey(this._array[_-1])===c;)_--;return _}u=_+1}}return u}}},7226:(x,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DebouncedIdleTask=t.IdleTaskQueue=t.PriorityTaskQueue=void 0;const c=n(6114);class u{constructor(){this._tasks=[],this._i=0}enqueue(f){this._tasks.push(f),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(f){this._idleCallback=void 0;let S=0,l=0,s=f.timeRemaining(),r=0;for(;this._i<this._tasks.length;){if(S=Date.now(),this._tasks[this._i]()||this._i++,S=Math.max(1,Date.now()-S),l=Math.max(S,l),r=f.timeRemaining(),1.5*l>r)return s-S<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(s-S))}ms`),void this._start();s=r}this.clear()}}class o extends u{_requestCallback(f){return setTimeout(()=>f(this._createDeadline(16)))}_cancelCallback(f){clearTimeout(f)}_createDeadline(f){const S=Date.now()+f;return{timeRemaining:()=>Math.max(0,S-Date.now())}}}t.PriorityTaskQueue=o,t.IdleTaskQueue=!c.isNode&&"requestIdleCallback"in window?class extends u{_requestCallback(_){return requestIdleCallback(_)}_cancelCallback(_){cancelIdleCallback(_)}}:o,t.DebouncedIdleTask=class{constructor(){this._queue=new t.IdleTaskQueue}set(_){this._queue.clear(),this._queue.enqueue(_)}flush(){this._queue.flush()}}},9282:(x,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.updateWindowsModeWrappedState=void 0;const c=n(643);t.updateWindowsModeWrappedState=function(u){const o=u.buffer.lines.get(u.buffer.ybase+u.buffer.y-1),_=o==null?void 0:o.get(u.cols-1),f=u.buffer.lines.get(u.buffer.ybase+u.buffer.y);f&&_&&(f.isWrapped=_[c.CHAR_DATA_CODE_INDEX]!==c.NULL_CELL_CODE&&_[c.CHAR_DATA_CODE_INDEX]!==c.WHITESPACE_CELL_CODE)}},3734:(x,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ExtendedAttrs=t.AttributeData=void 0;class n{constructor(){this.fg=0,this.bg=0,this.extended=new c}static toColorRGB(o){return[o>>>16&255,o>>>8&255,255&o]}static fromColorRGB(o){return(255&o[0])<<16|(255&o[1])<<8|255&o[2]}clone(){const o=new n;return o.fg=this.fg,o.bg=this.bg,o.extended=this.extended.clone(),o}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}isOverline(){return 1073741824&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return(50331648&this.fg)==50331648}isBgRGB(){return(50331648&this.bg)==50331648}isFgPalette(){return(50331648&this.fg)==16777216||(50331648&this.fg)==33554432}isBgPalette(){return(50331648&this.bg)==16777216||(50331648&this.bg)==33554432}isFgDefault(){return(50331648&this.fg)==0}isBgDefault(){return(50331648&this.bg)==0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==50331648:this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==16777216||(50331648&this.extended.underlineColor)==33554432:this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==0:this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}}t.AttributeData=n;class c{get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(o){this._ext=o}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(o){this._ext&=-469762049,this._ext|=o<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(o){this._ext&=-67108864,this._ext|=67108863&o}get urlId(){return this._urlId}set urlId(o){this._urlId=o}get underlineVariantOffset(){const o=(3758096384&this._ext)>>29;return o<0?4294967288^o:o}set underlineVariantOffset(o){this._ext&=536870911,this._ext|=o<<29&3758096384}constructor(o=0,_=0){this._ext=0,this._urlId=0,this._ext=o,this._urlId=_}clone(){return new c(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}}t.ExtendedAttrs=c},9092:(x,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Buffer=t.MAX_BUFFER_SIZE=void 0;const c=n(6349),u=n(7226),o=n(3734),_=n(8437),f=n(4634),S=n(511),l=n(643),s=n(4863),r=n(7116);t.MAX_BUFFER_SIZE=4294967295,t.Buffer=class{constructor(e,i,a){this._hasScrollback=e,this._optionsService=i,this._bufferService=a,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=_.DEFAULT_ATTR_DATA.clone(),this.savedCharset=r.DEFAULT_CHARSET,this.markers=[],this._nullCell=S.CellData.fromCharData([0,l.NULL_CELL_CHAR,l.NULL_CELL_WIDTH,l.NULL_CELL_CODE]),this._whitespaceCell=S.CellData.fromCharData([0,l.WHITESPACE_CELL_CHAR,l.WHITESPACE_CELL_WIDTH,l.WHITESPACE_CELL_CODE]),this._isClearing=!1,this._memoryCleanupQueue=new u.IdleTaskQueue,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new c.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(e){return e?(this._nullCell.fg=e.fg,this._nullCell.bg=e.bg,this._nullCell.extended=e.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new o.ExtendedAttrs),this._nullCell}getWhitespaceCell(e){return e?(this._whitespaceCell.fg=e.fg,this._whitespaceCell.bg=e.bg,this._whitespaceCell.extended=e.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new o.ExtendedAttrs),this._whitespaceCell}getBlankLine(e,i){return new _.BufferLine(this._bufferService.cols,this.getNullCell(e),i)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){const e=this.ybase+this.y-this.ydisp;return e>=0&&e<this._rows}_getCorrectBufferLength(e){if(!this._hasScrollback)return e;const i=e+this._optionsService.rawOptions.scrollback;return i>t.MAX_BUFFER_SIZE?t.MAX_BUFFER_SIZE:i}fillViewportRows(e){if(this.lines.length===0){e===void 0&&(e=_.DEFAULT_ATTR_DATA);let i=this._rows;for(;i--;)this.lines.push(this.getBlankLine(e))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new c.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(e,i){const a=this.getNullCell(_.DEFAULT_ATTR_DATA);let p=0;const g=this._getCorrectBufferLength(i);if(g>this.lines.maxLength&&(this.lines.maxLength=g),this.lines.length>0){if(this._cols<e)for(let d=0;d<this.lines.length;d++)p+=+this.lines.get(d).resize(e,a);let m=0;if(this._rows<i)for(let d=this._rows;d<i;d++)this.lines.length<i+this.ybase&&(this._optionsService.rawOptions.windowsMode||this._optionsService.rawOptions.windowsPty.backend!==void 0||this._optionsService.rawOptions.windowsPty.buildNumber!==void 0?this.lines.push(new _.BufferLine(e,a)):this.ybase>0&&this.lines.length<=this.ybase+this.y+m+1?(this.ybase--,m++,this.ydisp>0&&this.ydisp--):this.lines.push(new _.BufferLine(e,a)));else for(let d=this._rows;d>i;d--)this.lines.length>i+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(g<this.lines.maxLength){const d=this.lines.length-g;d>0&&(this.lines.trimStart(d),this.ybase=Math.max(this.ybase-d,0),this.ydisp=Math.max(this.ydisp-d,0),this.savedY=Math.max(this.savedY-d,0)),this.lines.maxLength=g}this.x=Math.min(this.x,e-1),this.y=Math.min(this.y,i-1),m&&(this.y+=m),this.savedX=Math.min(this.savedX,e-1),this.scrollTop=0}if(this.scrollBottom=i-1,this._isReflowEnabled&&(this._reflow(e,i),this._cols>e))for(let m=0;m<this.lines.length;m++)p+=+this.lines.get(m).resize(e,a);this._cols=e,this._rows=i,this._memoryCleanupQueue.clear(),p>.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue(()=>this._batchedMemoryCleanup()))}_batchedMemoryCleanup(){let e=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,e=!1);let i=0;for(;this._memoryCleanupPosition<this.lines.length;)if(i+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),i>100)return!0;return e}get _isReflowEnabled(){const e=this._optionsService.rawOptions.windowsPty;return e&&e.buildNumber?this._hasScrollback&&e.backend==="conpty"&&e.buildNumber>=21376:this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(e,i){this._cols!==e&&(e>this._cols?this._reflowLarger(e,i):this._reflowSmaller(e,i))}_reflowLarger(e,i){const a=(0,f.reflowLargerGetLinesToRemove)(this.lines,this._cols,e,this.ybase+this.y,this.getNullCell(_.DEFAULT_ATTR_DATA));if(a.length>0){const p=(0,f.reflowLargerCreateNewLayout)(this.lines,a);(0,f.reflowLargerApplyNewLayout)(this.lines,p.layout),this._reflowLargerAdjustViewport(e,i,p.countRemoved)}}_reflowLargerAdjustViewport(e,i,a){const p=this.getNullCell(_.DEFAULT_ATTR_DATA);let g=a;for(;g-- >0;)this.ybase===0?(this.y>0&&this.y--,this.lines.length<i&&this.lines.push(new _.BufferLine(e,p))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-a,0)}_reflowSmaller(e,i){const a=this.getNullCell(_.DEFAULT_ATTR_DATA),p=[];let g=0;for(let m=this.lines.length-1;m>=0;m--){let d=this.lines.get(m);if(!d||!d.isWrapped&&d.getTrimmedLength()<=e)continue;const C=[d];for(;d.isWrapped&&m>0;)d=this.lines.get(--m),C.unshift(d);const R=this.ybase+this.y;if(R>=m&&R<m+C.length)continue;const A=C[C.length-1].getTrimmedLength(),T=(0,f.reflowSmallerGetNewLineLengths)(C,this._cols,e),L=T.length-C.length;let H;H=this.ybase===0&&this.y!==this.lines.length-1?Math.max(0,this.y-this.lines.maxLength+L):Math.max(0,this.lines.length-this.lines.maxLength+L);const N=[];for(let D=0;D<L;D++){const B=this.getBlankLine(_.DEFAULT_ATTR_DATA,!0);N.push(B)}N.length>0&&(p.push({start:m+C.length+g,newLines:N}),g+=N.length),C.push(...N);let $=T.length-1,I=T[$];I===0&&($--,I=T[$]);let F=C.length-L-1,b=A;for(;F>=0;){const D=Math.min(b,I);if(C[$]===void 0)break;if(C[$].copyCellsFrom(C[F],b-D,I-D,D,!0),I-=D,I===0&&($--,I=T[$]),b-=D,b===0){F--;const B=Math.max(F,0);b=(0,f.getWrappedLineTrimmedLength)(C,B,this._cols)}}for(let D=0;D<C.length;D++)T[D]<e&&C[D].setCell(T[D],a);let E=L-H;for(;E-- >0;)this.ybase===0?this.y<i-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+g)-i&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+L,this.ybase+i-1)}if(p.length>0){const m=[],d=[];for(let $=0;$<this.lines.length;$++)d.push(this.lines.get($));const C=this.lines.length;let R=C-1,A=0,T=p[A];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+g);let L=0;for(let $=Math.min(this.lines.maxLength-1,C+g-1);$>=0;$--)if(T&&T.start>R+L){for(let I=T.newLines.length-1;I>=0;I--)this.lines.set($--,T.newLines[I]);$++,m.push({index:R+1,amount:T.newLines.length}),L+=T.newLines.length,T=p[++A]}else this.lines.set($,d[R--]);let H=0;for(let $=m.length-1;$>=0;$--)m[$].index+=H,this.lines.onInsertEmitter.fire(m[$]),H+=m[$].amount;const N=Math.max(0,C+g-this.lines.maxLength);N>0&&this.lines.onTrimEmitter.fire(N)}}translateBufferLineToString(e,i,a=0,p){const g=this.lines.get(e);return g?g.translateToString(i,a,p):""}getWrappedRangeForLine(e){let i=e,a=e;for(;i>0&&this.lines.get(i).isWrapped;)i--;for(;a+1<this.lines.length&&this.lines.get(a+1).isWrapped;)a++;return{first:i,last:a}}setupTabStops(e){for(e!=null?this.tabs[e]||(e=this.prevStop(e)):(this.tabs={},e=0);e<this._cols;e+=this._optionsService.rawOptions.tabStopWidth)this.tabs[e]=!0}prevStop(e){for(e==null&&(e=this.x);!this.tabs[--e]&&e>0;);return e>=this._cols?this._cols-1:e<0?0:e}nextStop(e){for(e==null&&(e=this.x);!this.tabs[++e]&&e<this._cols;);return e>=this._cols?this._cols-1:e<0?0:e}clearMarkers(e){this._isClearing=!0;for(let i=0;i<this.markers.length;i++)this.markers[i].line===e&&(this.markers[i].dispose(),this.markers.splice(i--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let e=0;e<this.markers.length;e++)this.markers[e].dispose(),this.markers.splice(e--,1);this._isClearing=!1}addMarker(e){const i=new s.Marker(e);return this.markers.push(i),i.register(this.lines.onTrim(a=>{i.line-=a,i.line<0&&i.dispose()})),i.register(this.lines.onInsert(a=>{i.line>=a.index&&(i.line+=a.amount)})),i.register(this.lines.onDelete(a=>{i.line>=a.index&&i.line<a.index+a.amount&&i.dispose(),i.line>a.index&&(i.line-=a.amount)})),i.register(i.onDispose(()=>this._removeMarker(i))),i}_removeMarker(e){this._isClearing||this.markers.splice(this.markers.indexOf(e),1)}}},8437:(x,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferLine=t.DEFAULT_ATTR_DATA=void 0;const c=n(3734),u=n(511),o=n(643),_=n(482);t.DEFAULT_ATTR_DATA=Object.freeze(new c.AttributeData);let f=0;class S{constructor(s,r,e=!1){this.isWrapped=e,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(3*s);const i=r||u.CellData.fromCharData([0,o.NULL_CELL_CHAR,o.NULL_CELL_WIDTH,o.NULL_CELL_CODE]);for(let a=0;a<s;++a)this.setCell(a,i);this.length=s}get(s){const r=this._data[3*s+0],e=2097151&r;return[this._data[3*s+1],2097152&r?this._combined[s]:e?(0,_.stringFromCodePoint)(e):"",r>>22,2097152&r?this._combined[s].charCodeAt(this._combined[s].length-1):e]}set(s,r){this._data[3*s+1]=r[o.CHAR_DATA_ATTR_INDEX],r[o.CHAR_DATA_CHAR_INDEX].length>1?(this._combined[s]=r[1],this._data[3*s+0]=2097152|s|r[o.CHAR_DATA_WIDTH_INDEX]<<22):this._data[3*s+0]=r[o.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|r[o.CHAR_DATA_WIDTH_INDEX]<<22}getWidth(s){return this._data[3*s+0]>>22}hasWidth(s){return 12582912&this._data[3*s+0]}getFg(s){return this._data[3*s+1]}getBg(s){return this._data[3*s+2]}hasContent(s){return 4194303&this._data[3*s+0]}getCodePoint(s){const r=this._data[3*s+0];return 2097152&r?this._combined[s].charCodeAt(this._combined[s].length-1):2097151&r}isCombined(s){return 2097152&this._data[3*s+0]}getString(s){const r=this._data[3*s+0];return 2097152&r?this._combined[s]:2097151&r?(0,_.stringFromCodePoint)(2097151&r):""}isProtected(s){return 536870912&this._data[3*s+2]}loadCell(s,r){return f=3*s,r.content=this._data[f+0],r.fg=this._data[f+1],r.bg=this._data[f+2],2097152&r.content&&(r.combinedData=this._combined[s]),268435456&r.bg&&(r.extended=this._extendedAttrs[s]),r}setCell(s,r){2097152&r.content&&(this._combined[s]=r.combinedData),268435456&r.bg&&(this._extendedAttrs[s]=r.extended),this._data[3*s+0]=r.content,this._data[3*s+1]=r.fg,this._data[3*s+2]=r.bg}setCellFromCodepoint(s,r,e,i){268435456&i.bg&&(this._extendedAttrs[s]=i.extended),this._data[3*s+0]=r|e<<22,this._data[3*s+1]=i.fg,this._data[3*s+2]=i.bg}addCodepointToCell(s,r,e){let i=this._data[3*s+0];2097152&i?this._combined[s]+=(0,_.stringFromCodePoint)(r):2097151&i?(this._combined[s]=(0,_.stringFromCodePoint)(2097151&i)+(0,_.stringFromCodePoint)(r),i&=-2097152,i|=2097152):i=r|4194304,e&&(i&=-12582913,i|=e<<22),this._data[3*s+0]=i}insertCells(s,r,e){if((s%=this.length)&&this.getWidth(s-1)===2&&this.setCellFromCodepoint(s-1,0,1,e),r<this.length-s){const i=new u.CellData;for(let a=this.length-s-r-1;a>=0;--a)this.setCell(s+r+a,this.loadCell(s+a,i));for(let a=0;a<r;++a)this.setCell(s+a,e)}else for(let i=s;i<this.length;++i)this.setCell(i,e);this.getWidth(this.length-1)===2&&this.setCellFromCodepoint(this.length-1,0,1,e)}deleteCells(s,r,e){if(s%=this.length,r<this.length-s){const i=new u.CellData;for(let a=0;a<this.length-s-r;++a)this.setCell(s+a,this.loadCell(s+r+a,i));for(let a=this.length-r;a<this.length;++a)this.setCell(a,e)}else for(let i=s;i<this.length;++i)this.setCell(i,e);s&&this.getWidth(s-1)===2&&this.setCellFromCodepoint(s-1,0,1,e),this.getWidth(s)!==0||this.hasContent(s)||this.setCellFromCodepoint(s,0,1,e)}replaceCells(s,r,e,i=!1){if(i)for(s&&this.getWidth(s-1)===2&&!this.isProtected(s-1)&&this.setCellFromCodepoint(s-1,0,1,e),r<this.length&&this.getWidth(r-1)===2&&!this.isProtected(r)&&this.setCellFromCodepoint(r,0,1,e);s<r&&s<this.length;)this.isProtected(s)||this.setCell(s,e),s++;else for(s&&this.getWidth(s-1)===2&&this.setCellFromCodepoint(s-1,0,1,e),r<this.length&&this.getWidth(r-1)===2&&this.setCellFromCodepoint(r,0,1,e);s<r&&s<this.length;)this.setCell(s++,e)}resize(s,r){if(s===this.length)return 4*this._data.length*2<this._data.buffer.byteLength;const e=3*s;if(s>this.length){if(this._data.buffer.byteLength>=4*e)this._data=new Uint32Array(this._data.buffer,0,e);else{const i=new Uint32Array(e);i.set(this._data),this._data=i}for(let i=this.length;i<s;++i)this.setCell(i,r)}else{this._data=this._data.subarray(0,e);const i=Object.keys(this._combined);for(let p=0;p<i.length;p++){const g=parseInt(i[p],10);g>=s&&delete this._combined[g]}const a=Object.keys(this._extendedAttrs);for(let p=0;p<a.length;p++){const g=parseInt(a[p],10);g>=s&&delete this._extendedAttrs[g]}}return this.length=s,4*e*2<this._data.buffer.byteLength}cleanupMemory(){if(4*this._data.length*2<this._data.buffer.byteLength){const s=new Uint32Array(this._data.length);return s.set(this._data),this._data=s,1}return 0}fill(s,r=!1){if(r)for(let e=0;e<this.length;++e)this.isProtected(e)||this.setCell(e,s);else{this._combined={},this._extendedAttrs={};for(let e=0;e<this.length;++e)this.setCell(e,s)}}copyFrom(s){this.length!==s.length?this._data=new Uint32Array(s._data):this._data.set(s._data),this.length=s.length,this._combined={};for(const r in s._combined)this._combined[r]=s._combined[r];this._extendedAttrs={};for(const r in s._extendedAttrs)this._extendedAttrs[r]=s._extendedAttrs[r];this.isWrapped=s.isWrapped}clone(){const s=new S(0);s._data=new Uint32Array(this._data),s.length=this.length;for(const r in this._combined)s._combined[r]=this._combined[r];for(const r in this._extendedAttrs)s._extendedAttrs[r]=this._extendedAttrs[r];return s.isWrapped=this.isWrapped,s}getTrimmedLength(){for(let s=this.length-1;s>=0;--s)if(4194303&this._data[3*s+0])return s+(this._data[3*s+0]>>22);return 0}getNoBgTrimmedLength(){for(let s=this.length-1;s>=0;--s)if(4194303&this._data[3*s+0]||50331648&this._data[3*s+2])return s+(this._data[3*s+0]>>22);return 0}copyCellsFrom(s,r,e,i,a){const p=s._data;if(a)for(let m=i-1;m>=0;m--){for(let d=0;d<3;d++)this._data[3*(e+m)+d]=p[3*(r+m)+d];268435456&p[3*(r+m)+2]&&(this._extendedAttrs[e+m]=s._extendedAttrs[r+m])}else for(let m=0;m<i;m++){for(let d=0;d<3;d++)this._data[3*(e+m)+d]=p[3*(r+m)+d];268435456&p[3*(r+m)+2]&&(this._extendedAttrs[e+m]=s._extendedAttrs[r+m])}const g=Object.keys(s._combined);for(let m=0;m<g.length;m++){const d=parseInt(g[m],10);d>=r&&(this._combined[d-r+e]=s._combined[d])}}translateToString(s,r,e,i){r=r??0,e=e??this.length,s&&(e=Math.min(e,this.getTrimmedLength())),i&&(i.length=0);let a="";for(;r<e;){const p=this._data[3*r+0],g=2097151&p,m=2097152&p?this._combined[r]:g?(0,_.stringFromCodePoint)(g):o.WHITESPACE_CELL_CHAR;if(a+=m,i)for(let d=0;d<m.length;++d)i.push(r);r+=p>>22||1}return i&&i.push(r),a}}t.BufferLine=S},4841:(x,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getRangeLength=void 0,t.getRangeLength=function(n,c){if(n.start.y>n.end.y)throw new Error(`Buffer range end (${n.end.x}, ${n.end.y}) cannot be before start (${n.start.x}, ${n.start.y})`);return c*(n.end.y-n.start.y)+(n.end.x-n.start.x+1)}},4634:(x,t)=>{function n(c,u,o){if(u===c.length-1)return c[u].getTrimmedLength();const _=!c[u].hasContent(o-1)&&c[u].getWidth(o-1)===1,f=c[u+1].getWidth(0)===2;return _&&f?o-1:o}Object.defineProperty(t,"__esModule",{value:!0}),t.getWrappedLineTrimmedLength=t.reflowSmallerGetNewLineLengths=t.reflowLargerApplyNewLayout=t.reflowLargerCreateNewLayout=t.reflowLargerGetLinesToRemove=void 0,t.reflowLargerGetLinesToRemove=function(c,u,o,_,f){const S=[];for(let l=0;l<c.length-1;l++){let s=l,r=c.get(++s);if(!r.isWrapped)continue;const e=[c.get(l)];for(;s<c.length&&r.isWrapped;)e.push(r),r=c.get(++s);if(_>=l&&_<s){l+=e.length-1;continue}let i=0,a=n(e,i,u),p=1,g=0;for(;p<e.length;){const d=n(e,p,u),C=d-g,R=o-a,A=Math.min(C,R);e[i].copyCellsFrom(e[p],g,a,A,!1),a+=A,a===o&&(i++,a=0),g+=A,g===d&&(p++,g=0),a===0&&i!==0&&e[i-1].getWidth(o-1)===2&&(e[i].copyCellsFrom(e[i-1],o-1,a++,1,!1),e[i-1].setCell(o-1,f))}e[i].replaceCells(a,o,f);let m=0;for(let d=e.length-1;d>0&&(d>i||e[d].getTrimmedLength()===0);d--)m++;m>0&&(S.push(l+e.length-m),S.push(m)),l+=e.length-1}return S},t.reflowLargerCreateNewLayout=function(c,u){const o=[];let _=0,f=u[_],S=0;for(let l=0;l<c.length;l++)if(f===l){const s=u[++_];c.onDeleteEmitter.fire({index:l-S,amount:s}),l+=s-1,S+=s,f=u[++_]}else o.push(l);return{layout:o,countRemoved:S}},t.reflowLargerApplyNewLayout=function(c,u){const o=[];for(let _=0;_<u.length;_++)o.push(c.get(u[_]));for(let _=0;_<o.length;_++)c.set(_,o[_]);c.length=u.length},t.reflowSmallerGetNewLineLengths=function(c,u,o){const _=[],f=c.map((r,e)=>n(c,e,u)).reduce((r,e)=>r+e);let S=0,l=0,s=0;for(;s<f;){if(f-s<o){_.push(f-s);break}S+=o;const r=n(c,l,u);S>r&&(S-=r,l++);const e=c[l].getWidth(S-1)===2;e&&S--;const i=e?o-1:o;_.push(i),s+=i}return _},t.getWrappedLineTrimmedLength=n},5295:(x,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferSet=void 0;const c=n(8460),u=n(844),o=n(9092);class _ extends u.Disposable{constructor(S,l){super(),this._optionsService=S,this._bufferService=l,this._onBufferActivate=this.register(new c.EventEmitter),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this.register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.resize(this._bufferService.cols,this._bufferService.rows))),this.register(this._optionsService.onSpecificOptionChange("tabStopWidth",()=>this.setupTabStops()))}reset(){this._normal=new o.Buffer(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new o.Buffer(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(S){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(S),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(S,l){this._normal.resize(S,l),this._alt.resize(S,l),this.setupTabStops(S)}setupTabStops(S){this._normal.setupTabStops(S),this._alt.setupTabStops(S)}}t.BufferSet=_},511:(x,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CellData=void 0;const c=n(482),u=n(643),o=n(3734);class _ extends o.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new o.ExtendedAttrs,this.combinedData=""}static fromCharData(S){const l=new _;return l.setFromCharData(S),l}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?(0,c.stringFromCodePoint)(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(S){this.fg=S[u.CHAR_DATA_ATTR_INDEX],this.bg=0;let l=!1;if(S[u.CHAR_DATA_CHAR_INDEX].length>2)l=!0;else if(S[u.CHAR_DATA_CHAR_INDEX].length===2){const s=S[u.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=s&&s<=56319){const r=S[u.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=r&&r<=57343?this.content=1024*(s-55296)+r-56320+65536|S[u.CHAR_DATA_WIDTH_INDEX]<<22:l=!0}else l=!0}else this.content=S[u.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|S[u.CHAR_DATA_WIDTH_INDEX]<<22;l&&(this.combinedData=S[u.CHAR_DATA_CHAR_INDEX],this.content=2097152|S[u.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}t.CellData=_},643:(x,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WHITESPACE_CELL_CODE=t.WHITESPACE_CELL_WIDTH=t.WHITESPACE_CELL_CHAR=t.NULL_CELL_CODE=t.NULL_CELL_WIDTH=t.NULL_CELL_CHAR=t.CHAR_DATA_CODE_INDEX=t.CHAR_DATA_WIDTH_INDEX=t.CHAR_DATA_CHAR_INDEX=t.CHAR_DATA_ATTR_INDEX=t.DEFAULT_EXT=t.DEFAULT_ATTR=t.DEFAULT_COLOR=void 0,t.DEFAULT_COLOR=0,t.DEFAULT_ATTR=256|t.DEFAULT_COLOR<<9,t.DEFAULT_EXT=0,t.CHAR_DATA_ATTR_INDEX=0,t.CHAR_DATA_CHAR_INDEX=1,t.CHAR_DATA_WIDTH_INDEX=2,t.CHAR_DATA_CODE_INDEX=3,t.NULL_CELL_CHAR="",t.NULL_CELL_WIDTH=1,t.NULL_CELL_CODE=0,t.WHITESPACE_CELL_CHAR=" ",t.WHITESPACE_CELL_WIDTH=1,t.WHITESPACE_CELL_CODE=32},4863:(x,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Marker=void 0;const c=n(8460),u=n(844);class o{get id(){return this._id}constructor(f){this.line=f,this.isDisposed=!1,this._disposables=[],this._id=o._nextId++,this._onDispose=this.register(new c.EventEmitter),this.onDispose=this._onDispose.event}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),(0,u.disposeArray)(this._disposables),this._disposables.length=0)}register(f){return this._disposables.push(f),f}}t.Marker=o,o._nextId=1},7116:(x,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_CHARSET=t.CHARSETS=void 0,t.CHARSETS={},t.DEFAULT_CHARSET=t.CHARSETS.B,t.CHARSETS[0]={"`":"\u25C6",a:"\u2592",b:"\u2409",c:"\u240C",d:"\u240D",e:"\u240A",f:"\xB0",g:"\xB1",h:"\u2424",i:"\u240B",j:"\u2518",k:"\u2510",l:"\u250C",m:"\u2514",n:"\u253C",o:"\u23BA",p:"\u23BB",q:"\u2500",r:"\u23BC",s:"\u23BD",t:"\u251C",u:"\u2524",v:"\u2534",w:"\u252C",x:"\u2502",y:"\u2264",z:"\u2265","{":"\u03C0","|":"\u2260","}":"\xA3","~":"\xB7"},t.CHARSETS.A={"#":"\xA3"},t.CHARSETS.B=void 0,t.CHARSETS[4]={"#":"\xA3","@":"\xBE","[":"ij","\\":"\xBD","]":"|","{":"\xA8","|":"f","}":"\xBC","~":"\xB4"},t.CHARSETS.C=t.CHARSETS[5]={"[":"\xC4","\\":"\xD6","]":"\xC5","^":"\xDC","`":"\xE9","{":"\xE4","|":"\xF6","}":"\xE5","~":"\xFC"},t.CHARSETS.R={"#":"\xA3","@":"\xE0","[":"\xB0","\\":"\xE7","]":"\xA7","{":"\xE9","|":"\xF9","}":"\xE8","~":"\xA8"},t.CHARSETS.Q={"@":"\xE0","[":"\xE2","\\":"\xE7","]":"\xEA","^":"\xEE","`":"\xF4","{":"\xE9","|":"\xF9","}":"\xE8","~":"\xFB"},t.CHARSETS.K={"@":"\xA7","[":"\xC4","\\":"\xD6","]":"\xDC","{":"\xE4","|":"\xF6","}":"\xFC","~":"\xDF"},t.CHARSETS.Y={"#":"\xA3","@":"\xA7","[":"\xB0","\\":"\xE7","]":"\xE9","`":"\xF9","{":"\xE0","|":"\xF2","}":"\xE8","~":"\xEC"},t.CHARSETS.E=t.CHARSETS[6]={"@":"\xC4","[":"\xC6","\\":"\xD8","]":"\xC5","^":"\xDC","`":"\xE4","{":"\xE6","|":"\xF8","}":"\xE5","~":"\xFC"},t.CHARSETS.Z={"#":"\xA3","@":"\xA7","[":"\xA1","\\":"\xD1","]":"\xBF","{":"\xB0","|":"\xF1","}":"\xE7"},t.CHARSETS.H=t.CHARSETS[7]={"@":"\xC9","[":"\xC4","\\":"\xD6","]":"\xC5","^":"\xDC","`":"\xE9","{":"\xE4","|":"\xF6","}":"\xE5","~":"\xFC"},t.CHARSETS["="]={"#":"\xF9","@":"\xE0","[":"\xE9","\\":"\xE7","]":"\xEA","^":"\xEE",_:"\xE8","`":"\xF4","{":"\xE4","|":"\xF6","}":"\xFC","~":"\xFB"}},2584:(x,t)=>{var n,c,u;Object.defineProperty(t,"__esModule",{value:!0}),t.C1_ESCAPED=t.C1=t.C0=void 0,function(o){o.NUL="\0",o.SOH="",o.STX="",o.ETX="",o.EOT="",o.ENQ="",o.ACK="",o.BEL="\x07",o.BS="\b",o.HT="	",o.LF=`
`,o.VT="\v",o.FF="\f",o.CR="\r",o.SO="",o.SI="",o.DLE="",o.DC1="",o.DC2="",o.DC3="",o.DC4="",o.NAK="",o.SYN="",o.ETB="",o.CAN="",o.EM="",o.SUB="",o.ESC="\x1B",o.FS="",o.GS="",o.RS="",o.US="",o.SP=" ",o.DEL="\x7F"}(n||(t.C0=n={})),function(o){o.PAD="\x80",o.HOP="\x81",o.BPH="\x82",o.NBH="\x83",o.IND="\x84",o.NEL="\x85",o.SSA="\x86",o.ESA="\x87",o.HTS="\x88",o.HTJ="\x89",o.VTS="\x8A",o.PLD="\x8B",o.PLU="\x8C",o.RI="\x8D",o.SS2="\x8E",o.SS3="\x8F",o.DCS="\x90",o.PU1="\x91",o.PU2="\x92",o.STS="\x93",o.CCH="\x94",o.MW="\x95",o.SPA="\x96",o.EPA="\x97",o.SOS="\x98",o.SGCI="\x99",o.SCI="\x9A",o.CSI="\x9B",o.ST="\x9C",o.OSC="\x9D",o.PM="\x9E",o.APC="\x9F"}(c||(t.C1=c={})),function(o){o.ST=`${n.ESC}\\`}(u||(t.C1_ESCAPED=u={}))},7399:(x,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.evaluateKeyboardEvent=void 0;const c=n(2584),u={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};t.evaluateKeyboardEvent=function(o,_,f,S){const l={type:0,cancel:!1,key:void 0},s=(o.shiftKey?1:0)|(o.altKey?2:0)|(o.ctrlKey?4:0)|(o.metaKey?8:0);switch(o.keyCode){case 0:o.key==="UIKeyInputUpArrow"?l.key=_?c.C0.ESC+"OA":c.C0.ESC+"[A":o.key==="UIKeyInputLeftArrow"?l.key=_?c.C0.ESC+"OD":c.C0.ESC+"[D":o.key==="UIKeyInputRightArrow"?l.key=_?c.C0.ESC+"OC":c.C0.ESC+"[C":o.key==="UIKeyInputDownArrow"&&(l.key=_?c.C0.ESC+"OB":c.C0.ESC+"[B");break;case 8:l.key=o.ctrlKey?"\b":c.C0.DEL,o.altKey&&(l.key=c.C0.ESC+l.key);break;case 9:if(o.shiftKey){l.key=c.C0.ESC+"[Z";break}l.key=c.C0.HT,l.cancel=!0;break;case 13:l.key=o.altKey?c.C0.ESC+c.C0.CR:c.C0.CR,l.cancel=!0;break;case 27:l.key=c.C0.ESC,o.altKey&&(l.key=c.C0.ESC+c.C0.ESC),l.cancel=!0;break;case 37:if(o.metaKey)break;s?(l.key=c.C0.ESC+"[1;"+(s+1)+"D",l.key===c.C0.ESC+"[1;3D"&&(l.key=c.C0.ESC+(f?"b":"[1;5D"))):l.key=_?c.C0.ESC+"OD":c.C0.ESC+"[D";break;case 39:if(o.metaKey)break;s?(l.key=c.C0.ESC+"[1;"+(s+1)+"C",l.key===c.C0.ESC+"[1;3C"&&(l.key=c.C0.ESC+(f?"f":"[1;5C"))):l.key=_?c.C0.ESC+"OC":c.C0.ESC+"[C";break;case 38:if(o.metaKey)break;s?(l.key=c.C0.ESC+"[1;"+(s+1)+"A",f||l.key!==c.C0.ESC+"[1;3A"||(l.key=c.C0.ESC+"[1;5A")):l.key=_?c.C0.ESC+"OA":c.C0.ESC+"[A";break;case 40:if(o.metaKey)break;s?(l.key=c.C0.ESC+"[1;"+(s+1)+"B",f||l.key!==c.C0.ESC+"[1;3B"||(l.key=c.C0.ESC+"[1;5B")):l.key=_?c.C0.ESC+"OB":c.C0.ESC+"[B";break;case 45:o.shiftKey||o.ctrlKey||(l.key=c.C0.ESC+"[2~");break;case 46:l.key=s?c.C0.ESC+"[3;"+(s+1)+"~":c.C0.ESC+"[3~";break;case 36:l.key=s?c.C0.ESC+"[1;"+(s+1)+"H":_?c.C0.ESC+"OH":c.C0.ESC+"[H";break;case 35:l.key=s?c.C0.ESC+"[1;"+(s+1)+"F":_?c.C0.ESC+"OF":c.C0.ESC+"[F";break;case 33:o.shiftKey?l.type=2:o.ctrlKey?l.key=c.C0.ESC+"[5;"+(s+1)+"~":l.key=c.C0.ESC+"[5~";break;case 34:o.shiftKey?l.type=3:o.ctrlKey?l.key=c.C0.ESC+"[6;"+(s+1)+"~":l.key=c.C0.ESC+"[6~";break;case 112:l.key=s?c.C0.ESC+"[1;"+(s+1)+"P":c.C0.ESC+"OP";break;case 113:l.key=s?c.C0.ESC+"[1;"+(s+1)+"Q":c.C0.ESC+"OQ";break;case 114:l.key=s?c.C0.ESC+"[1;"+(s+1)+"R":c.C0.ESC+"OR";break;case 115:l.key=s?c.C0.ESC+"[1;"+(s+1)+"S":c.C0.ESC+"OS";break;case 116:l.key=s?c.C0.ESC+"[15;"+(s+1)+"~":c.C0.ESC+"[15~";break;case 117:l.key=s?c.C0.ESC+"[17;"+(s+1)+"~":c.C0.ESC+"[17~";break;case 118:l.key=s?c.C0.ESC+"[18;"+(s+1)+"~":c.C0.ESC+"[18~";break;case 119:l.key=s?c.C0.ESC+"[19;"+(s+1)+"~":c.C0.ESC+"[19~";break;case 120:l.key=s?c.C0.ESC+"[20;"+(s+1)+"~":c.C0.ESC+"[20~";break;case 121:l.key=s?c.C0.ESC+"[21;"+(s+1)+"~":c.C0.ESC+"[21~";break;case 122:l.key=s?c.C0.ESC+"[23;"+(s+1)+"~":c.C0.ESC+"[23~";break;case 123:l.key=s?c.C0.ESC+"[24;"+(s+1)+"~":c.C0.ESC+"[24~";break;default:if(!o.ctrlKey||o.shiftKey||o.altKey||o.metaKey)if(f&&!S||!o.altKey||o.metaKey)!f||o.altKey||o.ctrlKey||o.shiftKey||!o.metaKey?o.key&&!o.ctrlKey&&!o.altKey&&!o.metaKey&&o.keyCode>=48&&o.key.length===1?l.key=o.key:o.key&&o.ctrlKey&&(o.key==="_"&&(l.key=c.C0.US),o.key==="@"&&(l.key=c.C0.NUL)):o.keyCode===65&&(l.type=1);else{const r=u[o.keyCode],e=r==null?void 0:r[o.shiftKey?1:0];if(e)l.key=c.C0.ESC+e;else if(o.keyCode>=65&&o.keyCode<=90){const i=o.ctrlKey?o.keyCode-64:o.keyCode+32;let a=String.fromCharCode(i);o.shiftKey&&(a=a.toUpperCase()),l.key=c.C0.ESC+a}else if(o.keyCode===32)l.key=c.C0.ESC+(o.ctrlKey?c.C0.NUL:" ");else if(o.key==="Dead"&&o.code.startsWith("Key")){let i=o.code.slice(3,4);o.shiftKey||(i=i.toLowerCase()),l.key=c.C0.ESC+i,l.cancel=!0}}else o.keyCode>=65&&o.keyCode<=90?l.key=String.fromCharCode(o.keyCode-64):o.keyCode===32?l.key=c.C0.NUL:o.keyCode>=51&&o.keyCode<=55?l.key=String.fromCharCode(o.keyCode-51+27):o.keyCode===56?l.key=c.C0.DEL:o.keyCode===219?l.key=c.C0.ESC:o.keyCode===220?l.key=c.C0.FS:o.keyCode===221&&(l.key=c.C0.GS)}return l}},482:(x,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Utf8ToUtf32=t.StringToUtf32=t.utf32ToString=t.stringFromCodePoint=void 0,t.stringFromCodePoint=function(n){return n>65535?(n-=65536,String.fromCharCode(55296+(n>>10))+String.fromCharCode(n%1024+56320)):String.fromCharCode(n)},t.utf32ToString=function(n,c=0,u=n.length){let o="";for(let _=c;_<u;++_){let f=n[_];f>65535?(f-=65536,o+=String.fromCharCode(55296+(f>>10))+String.fromCharCode(f%1024+56320)):o+=String.fromCharCode(f)}return o},t.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(n,c){const u=n.length;if(!u)return 0;let o=0,_=0;if(this._interim){const f=n.charCodeAt(_++);56320<=f&&f<=57343?c[o++]=1024*(this._interim-55296)+f-56320+65536:(c[o++]=this._interim,c[o++]=f),this._interim=0}for(let f=_;f<u;++f){const S=n.charCodeAt(f);if(55296<=S&&S<=56319){if(++f>=u)return this._interim=S,o;const l=n.charCodeAt(f);56320<=l&&l<=57343?c[o++]=1024*(S-55296)+l-56320+65536:(c[o++]=S,c[o++]=l)}else S!==65279&&(c[o++]=S)}return o}},t.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(n,c){const u=n.length;if(!u)return 0;let o,_,f,S,l=0,s=0,r=0;if(this.interim[0]){let a=!1,p=this.interim[0];p&=(224&p)==192?31:(240&p)==224?15:7;let g,m=0;for(;(g=63&this.interim[++m])&&m<4;)p<<=6,p|=g;const d=(224&this.interim[0])==192?2:(240&this.interim[0])==224?3:4,C=d-m;for(;r<C;){if(r>=u)return 0;if(g=n[r++],(192&g)!=128){r--,a=!0;break}this.interim[m++]=g,p<<=6,p|=63&g}a||(d===2?p<128?r--:c[l++]=p:d===3?p<2048||p>=55296&&p<=57343||p===65279||(c[l++]=p):p<65536||p>1114111||(c[l++]=p)),this.interim.fill(0)}const e=u-4;let i=r;for(;i<u;){for(;!(!(i<e)||128&(o=n[i])||128&(_=n[i+1])||128&(f=n[i+2])||128&(S=n[i+3]));)c[l++]=o,c[l++]=_,c[l++]=f,c[l++]=S,i+=4;if(o=n[i++],o<128)c[l++]=o;else if((224&o)==192){if(i>=u)return this.interim[0]=o,l;if(_=n[i++],(192&_)!=128){i--;continue}if(s=(31&o)<<6|63&_,s<128){i--;continue}c[l++]=s}else if((240&o)==224){if(i>=u)return this.interim[0]=o,l;if(_=n[i++],(192&_)!=128){i--;continue}if(i>=u)return this.interim[0]=o,this.interim[1]=_,l;if(f=n[i++],(192&f)!=128){i--;continue}if(s=(15&o)<<12|(63&_)<<6|63&f,s<2048||s>=55296&&s<=57343||s===65279)continue;c[l++]=s}else if((248&o)==240){if(i>=u)return this.interim[0]=o,l;if(_=n[i++],(192&_)!=128){i--;continue}if(i>=u)return this.interim[0]=o,this.interim[1]=_,l;if(f=n[i++],(192&f)!=128){i--;continue}if(i>=u)return this.interim[0]=o,this.interim[1]=_,this.interim[2]=f,l;if(S=n[i++],(192&S)!=128){i--;continue}if(s=(7&o)<<18|(63&_)<<12|(63&f)<<6|63&S,s<65536||s>1114111)continue;c[l++]=s}}return l}}},225:(x,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UnicodeV6=void 0;const c=n(1480),u=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],o=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]];let _;t.UnicodeV6=class{constructor(){if(this.version="6",!_){_=new Uint8Array(65536),_.fill(1),_[0]=0,_.fill(0,1,32),_.fill(0,127,160),_.fill(2,4352,4448),_[9001]=2,_[9002]=2,_.fill(2,11904,42192),_[12351]=1,_.fill(2,44032,55204),_.fill(2,63744,64256),_.fill(2,65040,65050),_.fill(2,65072,65136),_.fill(2,65280,65377),_.fill(2,65504,65511);for(let f=0;f<u.length;++f)_.fill(0,u[f][0],u[f][1]+1)}}wcwidth(f){return f<32?0:f<127?1:f<65536?_[f]:function(S,l){let s,r=0,e=l.length-1;if(S<l[0][0]||S>l[e][1])return!1;for(;e>=r;)if(s=r+e>>1,S>l[s][1])r=s+1;else{if(!(S<l[s][0]))return!0;e=s-1}return!1}(f,o)?0:f>=131072&&f<=196605||f>=196608&&f<=262141?2:1}charProperties(f,S){let l=this.wcwidth(f),s=l===0&&S!==0;if(s){const r=c.UnicodeService.extractWidth(S);r===0?s=!1:r>l&&(l=r)}return c.UnicodeService.createPropertyValue(0,l,s)}}},5981:(x,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WriteBuffer=void 0;const c=n(8460),u=n(844);class o extends u.Disposable{constructor(f){super(),this._action=f,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this.register(new c.EventEmitter),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(f,S){if(S!==void 0&&this._syncCalls>S)return void(this._syncCalls=0);if(this._pendingData+=f.length,this._writeBuffer.push(f),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;let l;for(this._isSyncWriting=!0;l=this._writeBuffer.shift();){this._action(l);const s=this._callbacks.shift();s&&s()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(f,S){if(this._pendingData>5e7)throw new Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput)return this._didUserInput=!1,this._pendingData+=f.length,this._writeBuffer.push(f),this._callbacks.push(S),void this._innerWrite();setTimeout(()=>this._innerWrite())}this._pendingData+=f.length,this._writeBuffer.push(f),this._callbacks.push(S)}_innerWrite(f=0,S=!0){const l=f||Date.now();for(;this._writeBuffer.length>this._bufferOffset;){const s=this._writeBuffer[this._bufferOffset],r=this._action(s,S);if(r){const i=a=>Date.now()-l>=12?setTimeout(()=>this._innerWrite(0,a)):this._innerWrite(l,a);return void r.catch(a=>(queueMicrotask(()=>{throw a}),Promise.resolve(!1))).then(i)}const e=this._callbacks[this._bufferOffset];if(e&&e(),this._bufferOffset++,this._pendingData-=s.length,Date.now()-l>=12)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>50&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout(()=>this._innerWrite())):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}}t.WriteBuffer=o},5941:(x,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.toRgbString=t.parseColor=void 0;const n=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,c=/^[\da-f]+$/;function u(o,_){const f=o.toString(16),S=f.length<2?"0"+f:f;switch(_){case 4:return f[0];case 8:return S;case 12:return(S+S).slice(0,3);default:return S+S}}t.parseColor=function(o){if(!o)return;let _=o.toLowerCase();if(_.indexOf("rgb:")===0){_=_.slice(4);const f=n.exec(_);if(f){const S=f[1]?15:f[4]?255:f[7]?4095:65535;return[Math.round(parseInt(f[1]||f[4]||f[7]||f[10],16)/S*255),Math.round(parseInt(f[2]||f[5]||f[8]||f[11],16)/S*255),Math.round(parseInt(f[3]||f[6]||f[9]||f[12],16)/S*255)]}}else if(_.indexOf("#")===0&&(_=_.slice(1),c.exec(_)&&[3,6,9,12].includes(_.length))){const f=_.length/3,S=[0,0,0];for(let l=0;l<3;++l){const s=parseInt(_.slice(f*l,f*l+f),16);S[l]=f===1?s<<4:f===2?s:f===3?s>>4:s>>8}return S}},t.toRgbString=function(o,_=16){const[f,S,l]=o;return`rgb:${u(f,_)}/${u(S,_)}/${u(l,_)}`}},5770:(x,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PAYLOAD_LIMIT=void 0,t.PAYLOAD_LIMIT=1e7},6351:(x,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DcsHandler=t.DcsParser=void 0;const c=n(482),u=n(8742),o=n(5770),_=[];t.DcsParser=class{constructor(){this._handlers=Object.create(null),this._active=_,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=_}registerHandler(S,l){this._handlers[S]===void 0&&(this._handlers[S]=[]);const s=this._handlers[S];return s.push(l),{dispose:()=>{const r=s.indexOf(l);r!==-1&&s.splice(r,1)}}}clearHandler(S){this._handlers[S]&&delete this._handlers[S]}setHandlerFallback(S){this._handlerFb=S}reset(){if(this._active.length)for(let S=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;S>=0;--S)this._active[S].unhook(!1);this._stack.paused=!1,this._active=_,this._ident=0}hook(S,l){if(this.reset(),this._ident=S,this._active=this._handlers[S]||_,this._active.length)for(let s=this._active.length-1;s>=0;s--)this._active[s].hook(l);else this._handlerFb(this._ident,"HOOK",l)}put(S,l,s){if(this._active.length)for(let r=this._active.length-1;r>=0;r--)this._active[r].put(S,l,s);else this._handlerFb(this._ident,"PUT",(0,c.utf32ToString)(S,l,s))}unhook(S,l=!0){if(this._active.length){let s=!1,r=this._active.length-1,e=!1;if(this._stack.paused&&(r=this._stack.loopPosition-1,s=l,e=this._stack.fallThrough,this._stack.paused=!1),!e&&s===!1){for(;r>=0&&(s=this._active[r].unhook(S),s!==!0);r--)if(s instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=r,this._stack.fallThrough=!1,s;r--}for(;r>=0;r--)if(s=this._active[r].unhook(!1),s instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=r,this._stack.fallThrough=!0,s}else this._handlerFb(this._ident,"UNHOOK",S);this._active=_,this._ident=0}};const f=new u.Params;f.addParam(0),t.DcsHandler=class{constructor(S){this._handler=S,this._data="",this._params=f,this._hitLimit=!1}hook(S){this._params=S.length>1||S.params[0]?S.clone():f,this._data="",this._hitLimit=!1}put(S,l,s){this._hitLimit||(this._data+=(0,c.utf32ToString)(S,l,s),this._data.length>o.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}unhook(S){let l=!1;if(this._hitLimit)l=!1;else if(S&&(l=this._handler(this._data,this._params),l instanceof Promise))return l.then(s=>(this._params=f,this._data="",this._hitLimit=!1,s));return this._params=f,this._data="",this._hitLimit=!1,l}}},2015:(x,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EscapeSequenceParser=t.VT500_TRANSITION_TABLE=t.TransitionTable=void 0;const c=n(844),u=n(8742),o=n(6242),_=n(6351);class f{constructor(r){this.table=new Uint8Array(r)}setDefault(r,e){this.table.fill(r<<4|e)}add(r,e,i,a){this.table[e<<8|r]=i<<4|a}addMany(r,e,i,a){for(let p=0;p<r.length;p++)this.table[e<<8|r[p]]=i<<4|a}}t.TransitionTable=f;const S=160;t.VT500_TRANSITION_TABLE=function(){const s=new f(4095),r=Array.apply(null,Array(256)).map((m,d)=>d),e=(m,d)=>r.slice(m,d),i=e(32,127),a=e(0,24);a.push(25),a.push.apply(a,e(28,32));const p=e(0,14);let g;for(g in s.setDefault(1,0),s.addMany(i,0,2,0),p)s.addMany([24,26,153,154],g,3,0),s.addMany(e(128,144),g,3,0),s.addMany(e(144,152),g,3,0),s.add(156,g,0,0),s.add(27,g,11,1),s.add(157,g,4,8),s.addMany([152,158,159],g,0,7),s.add(155,g,11,3),s.add(144,g,11,9);return s.addMany(a,0,3,0),s.addMany(a,1,3,1),s.add(127,1,0,1),s.addMany(a,8,0,8),s.addMany(a,3,3,3),s.add(127,3,0,3),s.addMany(a,4,3,4),s.add(127,4,0,4),s.addMany(a,6,3,6),s.addMany(a,5,3,5),s.add(127,5,0,5),s.addMany(a,2,3,2),s.add(127,2,0,2),s.add(93,1,4,8),s.addMany(i,8,5,8),s.add(127,8,5,8),s.addMany([156,27,24,26,7],8,6,0),s.addMany(e(28,32),8,0,8),s.addMany([88,94,95],1,0,7),s.addMany(i,7,0,7),s.addMany(a,7,0,7),s.add(156,7,0,0),s.add(127,7,0,7),s.add(91,1,11,3),s.addMany(e(64,127),3,7,0),s.addMany(e(48,60),3,8,4),s.addMany([60,61,62,63],3,9,4),s.addMany(e(48,60),4,8,4),s.addMany(e(64,127),4,7,0),s.addMany([60,61,62,63],4,0,6),s.addMany(e(32,64),6,0,6),s.add(127,6,0,6),s.addMany(e(64,127),6,0,0),s.addMany(e(32,48),3,9,5),s.addMany(e(32,48),5,9,5),s.addMany(e(48,64),5,0,6),s.addMany(e(64,127),5,7,0),s.addMany(e(32,48),4,9,5),s.addMany(e(32,48),1,9,2),s.addMany(e(32,48),2,9,2),s.addMany(e(48,127),2,10,0),s.addMany(e(48,80),1,10,0),s.addMany(e(81,88),1,10,0),s.addMany([89,90,92],1,10,0),s.addMany(e(96,127),1,10,0),s.add(80,1,11,9),s.addMany(a,9,0,9),s.add(127,9,0,9),s.addMany(e(28,32),9,0,9),s.addMany(e(32,48),9,9,12),s.addMany(e(48,60),9,8,10),s.addMany([60,61,62,63],9,9,10),s.addMany(a,11,0,11),s.addMany(e(32,128),11,0,11),s.addMany(e(28,32),11,0,11),s.addMany(a,10,0,10),s.add(127,10,0,10),s.addMany(e(28,32),10,0,10),s.addMany(e(48,60),10,8,10),s.addMany([60,61,62,63],10,0,11),s.addMany(e(32,48),10,9,12),s.addMany(a,12,0,12),s.add(127,12,0,12),s.addMany(e(28,32),12,0,12),s.addMany(e(32,48),12,9,12),s.addMany(e(48,64),12,0,11),s.addMany(e(64,127),12,12,13),s.addMany(e(64,127),10,12,13),s.addMany(e(64,127),9,12,13),s.addMany(a,13,13,13),s.addMany(i,13,13,13),s.add(127,13,0,13),s.addMany([27,156,24,26],13,14,0),s.add(S,0,2,0),s.add(S,8,5,8),s.add(S,6,0,6),s.add(S,11,0,11),s.add(S,13,13,13),s}();class l extends c.Disposable{constructor(r=t.VT500_TRANSITION_TABLE){super(),this._transitions=r,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new u.Params,this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._printHandlerFb=(e,i,a)=>{},this._executeHandlerFb=e=>{},this._csiHandlerFb=(e,i)=>{},this._escHandlerFb=e=>{},this._errorHandlerFb=e=>e,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this.register((0,c.toDisposable)(()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)})),this._oscParser=this.register(new o.OscParser),this._dcsParser=this.register(new _.DcsParser),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},()=>!0)}_identifier(r,e=[64,126]){let i=0;if(r.prefix){if(r.prefix.length>1)throw new Error("only one byte as prefix supported");if(i=r.prefix.charCodeAt(0),i&&60>i||i>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if(r.intermediates){if(r.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(let p=0;p<r.intermediates.length;++p){const g=r.intermediates.charCodeAt(p);if(32>g||g>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");i<<=8,i|=g}}if(r.final.length!==1)throw new Error("final must be a single byte");const a=r.final.charCodeAt(0);if(e[0]>a||a>e[1])throw new Error(`final must be in range ${e[0]} .. ${e[1]}`);return i<<=8,i|=a,i}identToString(r){const e=[];for(;r;)e.push(String.fromCharCode(255&r)),r>>=8;return e.reverse().join("")}setPrintHandler(r){this._printHandler=r}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(r,e){const i=this._identifier(r,[48,126]);this._escHandlers[i]===void 0&&(this._escHandlers[i]=[]);const a=this._escHandlers[i];return a.push(e),{dispose:()=>{const p=a.indexOf(e);p!==-1&&a.splice(p,1)}}}clearEscHandler(r){this._escHandlers[this._identifier(r,[48,126])]&&delete this._escHandlers[this._identifier(r,[48,126])]}setEscHandlerFallback(r){this._escHandlerFb=r}setExecuteHandler(r,e){this._executeHandlers[r.charCodeAt(0)]=e}clearExecuteHandler(r){this._executeHandlers[r.charCodeAt(0)]&&delete this._executeHandlers[r.charCodeAt(0)]}setExecuteHandlerFallback(r){this._executeHandlerFb=r}registerCsiHandler(r,e){const i=this._identifier(r);this._csiHandlers[i]===void 0&&(this._csiHandlers[i]=[]);const a=this._csiHandlers[i];return a.push(e),{dispose:()=>{const p=a.indexOf(e);p!==-1&&a.splice(p,1)}}}clearCsiHandler(r){this._csiHandlers[this._identifier(r)]&&delete this._csiHandlers[this._identifier(r)]}setCsiHandlerFallback(r){this._csiHandlerFb=r}registerDcsHandler(r,e){return this._dcsParser.registerHandler(this._identifier(r),e)}clearDcsHandler(r){this._dcsParser.clearHandler(this._identifier(r))}setDcsHandlerFallback(r){this._dcsParser.setHandlerFallback(r)}registerOscHandler(r,e){return this._oscParser.registerHandler(r,e)}clearOscHandler(r){this._oscParser.clearHandler(r)}setOscHandlerFallback(r){this._oscParser.setHandlerFallback(r)}setErrorHandler(r){this._errorHandler=r}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._parseStack.state!==0&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(r,e,i,a,p){this._parseStack.state=r,this._parseStack.handlers=e,this._parseStack.handlerPos=i,this._parseStack.transition=a,this._parseStack.chunkPos=p}parse(r,e,i){let a,p=0,g=0,m=0;if(this._parseStack.state)if(this._parseStack.state===2)this._parseStack.state=0,m=this._parseStack.chunkPos+1;else{if(i===void 0||this._parseStack.state===1)throw this._parseStack.state=1,new Error("improper continuation due to previous async handler, giving up parsing");const d=this._parseStack.handlers;let C=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(i===!1&&C>-1){for(;C>=0&&(a=d[C](this._params),a!==!0);C--)if(a instanceof Promise)return this._parseStack.handlerPos=C,a}this._parseStack.handlers=[];break;case 4:if(i===!1&&C>-1){for(;C>=0&&(a=d[C](),a!==!0);C--)if(a instanceof Promise)return this._parseStack.handlerPos=C,a}this._parseStack.handlers=[];break;case 6:if(p=r[this._parseStack.chunkPos],a=this._dcsParser.unhook(p!==24&&p!==26,i),a)return a;p===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(p=r[this._parseStack.chunkPos],a=this._oscParser.end(p!==24&&p!==26,i),a)return a;p===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0}this._parseStack.state=0,m=this._parseStack.chunkPos+1,this.precedingJoinState=0,this.currentState=15&this._parseStack.transition}for(let d=m;d<e;++d){switch(p=r[d],g=this._transitions.table[this.currentState<<8|(p<160?p:S)],g>>4){case 2:for(let L=d+1;;++L){if(L>=e||(p=r[L])<32||p>126&&p<S){this._printHandler(r,d,L),d=L-1;break}if(++L>=e||(p=r[L])<32||p>126&&p<S){this._printHandler(r,d,L),d=L-1;break}if(++L>=e||(p=r[L])<32||p>126&&p<S){this._printHandler(r,d,L),d=L-1;break}if(++L>=e||(p=r[L])<32||p>126&&p<S){this._printHandler(r,d,L),d=L-1;break}}break;case 3:this._executeHandlers[p]?this._executeHandlers[p]():this._executeHandlerFb(p),this.precedingJoinState=0;break;case 0:break;case 1:if(this._errorHandler({position:d,code:p,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:const C=this._csiHandlers[this._collect<<8|p];let R=C?C.length-1:-1;for(;R>=0&&(a=C[R](this._params),a!==!0);R--)if(a instanceof Promise)return this._preserveStack(3,C,R,g,d),a;R<0&&this._csiHandlerFb(this._collect<<8|p,this._params),this.precedingJoinState=0;break;case 8:do switch(p){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(p-48)}while(++d<e&&(p=r[d])>47&&p<60);d--;break;case 9:this._collect<<=8,this._collect|=p;break;case 10:const A=this._escHandlers[this._collect<<8|p];let T=A?A.length-1:-1;for(;T>=0&&(a=A[T](),a!==!0);T--)if(a instanceof Promise)return this._preserveStack(4,A,T,g,d),a;T<0&&this._escHandlerFb(this._collect<<8|p),this.precedingJoinState=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|p,this._params);break;case 13:for(let L=d+1;;++L)if(L>=e||(p=r[L])===24||p===26||p===27||p>127&&p<S){this._dcsParser.put(r,d,L),d=L-1;break}break;case 14:if(a=this._dcsParser.unhook(p!==24&&p!==26),a)return this._preserveStack(6,[],0,g,d),a;p===27&&(g|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break;case 4:this._oscParser.start();break;case 5:for(let L=d+1;;L++)if(L>=e||(p=r[L])<32||p>127&&p<S){this._oscParser.put(r,d,L),d=L-1;break}break;case 6:if(a=this._oscParser.end(p!==24&&p!==26),a)return this._preserveStack(5,[],0,g,d),a;p===27&&(g|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0}this.currentState=15&g}}}t.EscapeSequenceParser=l},6242:(x,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OscHandler=t.OscParser=void 0;const c=n(5770),u=n(482),o=[];t.OscParser=class{constructor(){this._state=0,this._active=o,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(_,f){this._handlers[_]===void 0&&(this._handlers[_]=[]);const S=this._handlers[_];return S.push(f),{dispose:()=>{const l=S.indexOf(f);l!==-1&&S.splice(l,1)}}}clearHandler(_){this._handlers[_]&&delete this._handlers[_]}setHandlerFallback(_){this._handlerFb=_}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=o}reset(){if(this._state===2)for(let _=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;_>=0;--_)this._active[_].end(!1);this._stack.paused=!1,this._active=o,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||o,this._active.length)for(let _=this._active.length-1;_>=0;_--)this._active[_].start();else this._handlerFb(this._id,"START")}_put(_,f,S){if(this._active.length)for(let l=this._active.length-1;l>=0;l--)this._active[l].put(_,f,S);else this._handlerFb(this._id,"PUT",(0,u.utf32ToString)(_,f,S))}start(){this.reset(),this._state=1}put(_,f,S){if(this._state!==3){if(this._state===1)for(;f<S;){const l=_[f++];if(l===59){this._state=2,this._start();break}if(l<48||57<l)return void(this._state=3);this._id===-1&&(this._id=0),this._id=10*this._id+l-48}this._state===2&&S-f>0&&this._put(_,f,S)}}end(_,f=!0){if(this._state!==0){if(this._state!==3)if(this._state===1&&this._start(),this._active.length){let S=!1,l=this._active.length-1,s=!1;if(this._stack.paused&&(l=this._stack.loopPosition-1,S=f,s=this._stack.fallThrough,this._stack.paused=!1),!s&&S===!1){for(;l>=0&&(S=this._active[l].end(_),S!==!0);l--)if(S instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=l,this._stack.fallThrough=!1,S;l--}for(;l>=0;l--)if(S=this._active[l].end(!1),S instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=l,this._stack.fallThrough=!0,S}else this._handlerFb(this._id,"END",_);this._active=o,this._id=-1,this._state=0}}},t.OscHandler=class{constructor(_){this._handler=_,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(_,f,S){this._hitLimit||(this._data+=(0,u.utf32ToString)(_,f,S),this._data.length>c.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}end(_){let f=!1;if(this._hitLimit)f=!1;else if(_&&(f=this._handler(this._data),f instanceof Promise))return f.then(S=>(this._data="",this._hitLimit=!1,S));return this._data="",this._hitLimit=!1,f}}},8742:(x,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Params=void 0;const n=2147483647;class c{static fromArray(o){const _=new c;if(!o.length)return _;for(let f=Array.isArray(o[0])?1:0;f<o.length;++f){const S=o[f];if(Array.isArray(S))for(let l=0;l<S.length;++l)_.addSubParam(S[l]);else _.addParam(S)}return _}constructor(o=32,_=32){if(this.maxLength=o,this.maxSubParamsLength=_,_>256)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(o),this.length=0,this._subParams=new Int32Array(_),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(o),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}clone(){const o=new c(this.maxLength,this.maxSubParamsLength);return o.params.set(this.params),o.length=this.length,o._subParams.set(this._subParams),o._subParamsLength=this._subParamsLength,o._subParamsIdx.set(this._subParamsIdx),o._rejectDigits=this._rejectDigits,o._rejectSubDigits=this._rejectSubDigits,o._digitIsSub=this._digitIsSub,o}toArray(){const o=[];for(let _=0;_<this.length;++_){o.push(this.params[_]);const f=this._subParamsIdx[_]>>8,S=255&this._subParamsIdx[_];S-f>0&&o.push(Array.prototype.slice.call(this._subParams,f,S))}return o}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(o){if(this._digitIsSub=!1,this.length>=this.maxLength)this._rejectDigits=!0;else{if(o<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=o>n?n:o}}addSubParam(o){if(this._digitIsSub=!0,this.length)if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength)this._rejectSubDigits=!0;else{if(o<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=o>n?n:o,this._subParamsIdx[this.length-1]++}}hasSubParams(o){return(255&this._subParamsIdx[o])-(this._subParamsIdx[o]>>8)>0}getSubParams(o){const _=this._subParamsIdx[o]>>8,f=255&this._subParamsIdx[o];return f-_>0?this._subParams.subarray(_,f):null}getSubParamsAll(){const o={};for(let _=0;_<this.length;++_){const f=this._subParamsIdx[_]>>8,S=255&this._subParamsIdx[_];S-f>0&&(o[_]=this._subParams.slice(f,S))}return o}addDigit(o){let _;if(this._rejectDigits||!(_=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;const f=this._digitIsSub?this._subParams:this.params,S=f[_-1];f[_-1]=~S?Math.min(10*S+o,n):o}}t.Params=c},5741:(x,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AddonManager=void 0,t.AddonManager=class{constructor(){this._addons=[]}dispose(){for(let n=this._addons.length-1;n>=0;n--)this._addons[n].instance.dispose()}loadAddon(n,c){const u={instance:c,dispose:c.dispose,isDisposed:!1};this._addons.push(u),c.dispose=()=>this._wrappedAddonDispose(u),c.activate(n)}_wrappedAddonDispose(n){if(n.isDisposed)return;let c=-1;for(let u=0;u<this._addons.length;u++)if(this._addons[u]===n){c=u;break}if(c===-1)throw new Error("Could not dispose an addon that has not been loaded");n.isDisposed=!0,n.dispose.apply(n.instance),this._addons.splice(c,1)}}},8771:(x,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferApiView=void 0;const c=n(3785),u=n(511);t.BufferApiView=class{constructor(o,_){this._buffer=o,this.type=_}init(o){return this._buffer=o,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(o){const _=this._buffer.lines.get(o);if(_)return new c.BufferLineApiView(_)}getNullCell(){return new u.CellData}}},3785:(x,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferLineApiView=void 0;const c=n(511);t.BufferLineApiView=class{constructor(u){this._line=u}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(u,o){if(!(u<0||u>=this._line.length))return o?(this._line.loadCell(u,o),o):this._line.loadCell(u,new c.CellData)}translateToString(u,o,_){return this._line.translateToString(u,o,_)}}},8285:(x,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferNamespaceApi=void 0;const c=n(8771),u=n(8460),o=n(844);class _ extends o.Disposable{constructor(S){super(),this._core=S,this._onBufferChange=this.register(new u.EventEmitter),this.onBufferChange=this._onBufferChange.event,this._normal=new c.BufferApiView(this._core.buffers.normal,"normal"),this._alternate=new c.BufferApiView(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate(()=>this._onBufferChange.fire(this.active))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw new Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}}t.BufferNamespaceApi=_},7975:(x,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ParserApi=void 0,t.ParserApi=class{constructor(n){this._core=n}registerCsiHandler(n,c){return this._core.registerCsiHandler(n,u=>c(u.toArray()))}addCsiHandler(n,c){return this.registerCsiHandler(n,c)}registerDcsHandler(n,c){return this._core.registerDcsHandler(n,(u,o)=>c(u,o.toArray()))}addDcsHandler(n,c){return this.registerDcsHandler(n,c)}registerEscHandler(n,c){return this._core.registerEscHandler(n,c)}addEscHandler(n,c){return this.registerEscHandler(n,c)}registerOscHandler(n,c){return this._core.registerOscHandler(n,c)}addOscHandler(n,c){return this.registerOscHandler(n,c)}}},7090:(x,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UnicodeApi=void 0,t.UnicodeApi=class{constructor(n){this._core=n}register(n){this._core.unicodeService.register(n)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(n){this._core.unicodeService.activeVersion=n}}},744:function(x,t,n){var c=this&&this.__decorate||function(s,r,e,i){var a,p=arguments.length,g=p<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(s,r,e,i);else for(var m=s.length-1;m>=0;m--)(a=s[m])&&(g=(p<3?a(g):p>3?a(r,e,g):a(r,e))||g);return p>3&&g&&Object.defineProperty(r,e,g),g},u=this&&this.__param||function(s,r){return function(e,i){r(e,i,s)}};Object.defineProperty(t,"__esModule",{value:!0}),t.BufferService=t.MINIMUM_ROWS=t.MINIMUM_COLS=void 0;const o=n(8460),_=n(844),f=n(5295),S=n(2585);t.MINIMUM_COLS=2,t.MINIMUM_ROWS=1;let l=t.BufferService=class extends _.Disposable{get buffer(){return this.buffers.active}constructor(s){super(),this.isUserScrolling=!1,this._onResize=this.register(new o.EventEmitter),this.onResize=this._onResize.event,this._onScroll=this.register(new o.EventEmitter),this.onScroll=this._onScroll.event,this.cols=Math.max(s.rawOptions.cols||0,t.MINIMUM_COLS),this.rows=Math.max(s.rawOptions.rows||0,t.MINIMUM_ROWS),this.buffers=this.register(new f.BufferSet(s,this))}resize(s,r){this.cols=s,this.rows=r,this.buffers.resize(s,r),this._onResize.fire({cols:s,rows:r})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(s,r=!1){const e=this.buffer;let i;i=this._cachedBlankLine,i&&i.length===this.cols&&i.getFg(0)===s.fg&&i.getBg(0)===s.bg||(i=e.getBlankLine(s,r),this._cachedBlankLine=i),i.isWrapped=r;const a=e.ybase+e.scrollTop,p=e.ybase+e.scrollBottom;if(e.scrollTop===0){const g=e.lines.isFull;p===e.lines.length-1?g?e.lines.recycle().copyFrom(i):e.lines.push(i.clone()):e.lines.splice(p+1,0,i.clone()),g?this.isUserScrolling&&(e.ydisp=Math.max(e.ydisp-1,0)):(e.ybase++,this.isUserScrolling||e.ydisp++)}else{const g=p-a+1;e.lines.shiftElements(a+1,g-1,-1),e.lines.set(p,i.clone())}this.isUserScrolling||(e.ydisp=e.ybase),this._onScroll.fire(e.ydisp)}scrollLines(s,r,e){const i=this.buffer;if(s<0){if(i.ydisp===0)return;this.isUserScrolling=!0}else s+i.ydisp>=i.ybase&&(this.isUserScrolling=!1);const a=i.ydisp;i.ydisp=Math.max(Math.min(i.ydisp+s,i.ybase),0),a!==i.ydisp&&(r||this._onScroll.fire(i.ydisp))}};t.BufferService=l=c([u(0,S.IOptionsService)],l)},7994:(x,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CharsetService=void 0,t.CharsetService=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(n){this.glevel=n,this.charset=this._charsets[n]}setgCharset(n,c){this._charsets[n]=c,this.glevel===n&&(this.charset=c)}}},1753:function(x,t,n){var c=this&&this.__decorate||function(i,a,p,g){var m,d=arguments.length,C=d<3?a:g===null?g=Object.getOwnPropertyDescriptor(a,p):g;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")C=Reflect.decorate(i,a,p,g);else for(var R=i.length-1;R>=0;R--)(m=i[R])&&(C=(d<3?m(C):d>3?m(a,p,C):m(a,p))||C);return d>3&&C&&Object.defineProperty(a,p,C),C},u=this&&this.__param||function(i,a){return function(p,g){a(p,g,i)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CoreMouseService=void 0;const o=n(2585),_=n(8460),f=n(844),S={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:i=>i.button!==4&&i.action===1&&(i.ctrl=!1,i.alt=!1,i.shift=!1,!0)},VT200:{events:19,restrict:i=>i.action!==32},DRAG:{events:23,restrict:i=>i.action!==32||i.button!==3},ANY:{events:31,restrict:i=>!0}};function l(i,a){let p=(i.ctrl?16:0)|(i.shift?4:0)|(i.alt?8:0);return i.button===4?(p|=64,p|=i.action):(p|=3&i.button,4&i.button&&(p|=64),8&i.button&&(p|=128),i.action===32?p|=32:i.action!==0||a||(p|=3)),p}const s=String.fromCharCode,r={DEFAULT:i=>{const a=[l(i,!1)+32,i.col+32,i.row+32];return a[0]>255||a[1]>255||a[2]>255?"":`\x1B[M${s(a[0])}${s(a[1])}${s(a[2])}`},SGR:i=>{const a=i.action===0&&i.button!==4?"m":"M";return`\x1B[<${l(i,!0)};${i.col};${i.row}${a}`},SGR_PIXELS:i=>{const a=i.action===0&&i.button!==4?"m":"M";return`\x1B[<${l(i,!0)};${i.x};${i.y}${a}`}};let e=t.CoreMouseService=class extends f.Disposable{constructor(i,a){super(),this._bufferService=i,this._coreService=a,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._onProtocolChange=this.register(new _.EventEmitter),this.onProtocolChange=this._onProtocolChange.event;for(const p of Object.keys(S))this.addProtocol(p,S[p]);for(const p of Object.keys(r))this.addEncoding(p,r[p]);this.reset()}addProtocol(i,a){this._protocols[i]=a}addEncoding(i,a){this._encodings[i]=a}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return this._protocols[this._activeProtocol].events!==0}set activeProtocol(i){if(!this._protocols[i])throw new Error(`unknown protocol "${i}"`);this._activeProtocol=i,this._onProtocolChange.fire(this._protocols[i].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(i){if(!this._encodings[i])throw new Error(`unknown encoding "${i}"`);this._activeEncoding=i}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null}triggerMouseEvent(i){if(i.col<0||i.col>=this._bufferService.cols||i.row<0||i.row>=this._bufferService.rows||i.button===4&&i.action===32||i.button===3&&i.action!==32||i.button!==4&&(i.action===2||i.action===3)||(i.col++,i.row++,i.action===32&&this._lastEvent&&this._equalEvents(this._lastEvent,i,this._activeEncoding==="SGR_PIXELS"))||!this._protocols[this._activeProtocol].restrict(i))return!1;const a=this._encodings[this._activeEncoding](i);return a&&(this._activeEncoding==="DEFAULT"?this._coreService.triggerBinaryEvent(a):this._coreService.triggerDataEvent(a,!0)),this._lastEvent=i,!0}explainEvents(i){return{down:!!(1&i),up:!!(2&i),drag:!!(4&i),move:!!(8&i),wheel:!!(16&i)}}_equalEvents(i,a,p){if(p){if(i.x!==a.x||i.y!==a.y)return!1}else if(i.col!==a.col||i.row!==a.row)return!1;return i.button===a.button&&i.action===a.action&&i.ctrl===a.ctrl&&i.alt===a.alt&&i.shift===a.shift}};t.CoreMouseService=e=c([u(0,o.IBufferService),u(1,o.ICoreService)],e)},6975:function(x,t,n){var c=this&&this.__decorate||function(e,i,a,p){var g,m=arguments.length,d=m<3?i:p===null?p=Object.getOwnPropertyDescriptor(i,a):p;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(e,i,a,p);else for(var C=e.length-1;C>=0;C--)(g=e[C])&&(d=(m<3?g(d):m>3?g(i,a,d):g(i,a))||d);return m>3&&d&&Object.defineProperty(i,a,d),d},u=this&&this.__param||function(e,i){return function(a,p){i(a,p,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CoreService=void 0;const o=n(1439),_=n(8460),f=n(844),S=n(2585),l=Object.freeze({insertMode:!1}),s=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,origin:!1,reverseWraparound:!1,sendFocus:!1,wraparound:!0});let r=t.CoreService=class extends f.Disposable{constructor(e,i,a){super(),this._bufferService=e,this._logService=i,this._optionsService=a,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this.register(new _.EventEmitter),this.onData=this._onData.event,this._onUserInput=this.register(new _.EventEmitter),this.onUserInput=this._onUserInput.event,this._onBinary=this.register(new _.EventEmitter),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this.register(new _.EventEmitter),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=(0,o.clone)(l),this.decPrivateModes=(0,o.clone)(s)}reset(){this.modes=(0,o.clone)(l),this.decPrivateModes=(0,o.clone)(s)}triggerDataEvent(e,i=!1){if(this._optionsService.rawOptions.disableStdin)return;const a=this._bufferService.buffer;i&&this._optionsService.rawOptions.scrollOnUserInput&&a.ybase!==a.ydisp&&this._onRequestScrollToBottom.fire(),i&&this._onUserInput.fire(),this._logService.debug(`sending data "${e}"`,()=>e.split("").map(p=>p.charCodeAt(0))),this._onData.fire(e)}triggerBinaryEvent(e){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${e}"`,()=>e.split("").map(i=>i.charCodeAt(0))),this._onBinary.fire(e))}};t.CoreService=r=c([u(0,S.IBufferService),u(1,S.ILogService),u(2,S.IOptionsService)],r)},9074:(x,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DecorationService=void 0;const c=n(8055),u=n(8460),o=n(844),_=n(6106);let f=0,S=0;class l extends o.Disposable{get decorations(){return this._decorations.values()}constructor(){super(),this._decorations=new _.SortedList(e=>e==null?void 0:e.marker.line),this._onDecorationRegistered=this.register(new u.EventEmitter),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this.register(new u.EventEmitter),this.onDecorationRemoved=this._onDecorationRemoved.event,this.register((0,o.toDisposable)(()=>this.reset()))}registerDecoration(e){if(e.marker.isDisposed)return;const i=new s(e);if(i){const a=i.marker.onDispose(()=>i.dispose());i.onDispose(()=>{i&&(this._decorations.delete(i)&&this._onDecorationRemoved.fire(i),a.dispose())}),this._decorations.insert(i),this._onDecorationRegistered.fire(i)}return i}reset(){for(const e of this._decorations.values())e.dispose();this._decorations.clear()}*getDecorationsAtCell(e,i,a){let p=0,g=0;for(const m of this._decorations.getKeyIterator(i))p=m.options.x??0,g=p+(m.options.width??1),e>=p&&e<g&&(!a||(m.options.layer??"bottom")===a)&&(yield m)}forEachDecorationAtCell(e,i,a,p){this._decorations.forEachByKey(i,g=>{f=g.options.x??0,S=f+(g.options.width??1),e>=f&&e<S&&(!a||(g.options.layer??"bottom")===a)&&p(g)})}}t.DecorationService=l;class s extends o.Disposable{get isDisposed(){return this._isDisposed}get backgroundColorRGB(){return this._cachedBg===null&&(this.options.backgroundColor?this._cachedBg=c.css.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return this._cachedFg===null&&(this.options.foregroundColor?this._cachedFg=c.css.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}constructor(e){super(),this.options=e,this.onRenderEmitter=this.register(new u.EventEmitter),this.onRender=this.onRenderEmitter.event,this._onDispose=this.register(new u.EventEmitter),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=e.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}dispose(){this._onDispose.fire(),super.dispose()}}},4348:(x,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InstantiationService=t.ServiceCollection=void 0;const c=n(2585),u=n(8343);class o{constructor(...f){this._entries=new Map;for(const[S,l]of f)this.set(S,l)}set(f,S){const l=this._entries.get(f);return this._entries.set(f,S),l}forEach(f){for(const[S,l]of this._entries.entries())f(S,l)}has(f){return this._entries.has(f)}get(f){return this._entries.get(f)}}t.ServiceCollection=o,t.InstantiationService=class{constructor(){this._services=new o,this._services.set(c.IInstantiationService,this)}setService(_,f){this._services.set(_,f)}getService(_){return this._services.get(_)}createInstance(_,...f){const S=(0,u.getServiceDependencies)(_).sort((r,e)=>r.index-e.index),l=[];for(const r of S){const e=this._services.get(r.id);if(!e)throw new Error(`[createInstance] ${_.name} depends on UNKNOWN service ${r.id}.`);l.push(e)}const s=S.length>0?S[0].index:f.length;if(f.length!==s)throw new Error(`[createInstance] First service dependency of ${_.name} at position ${s+1} conflicts with ${f.length} static arguments`);return new _(...f,...l)}}},7866:function(x,t,n){var c=this&&this.__decorate||function(s,r,e,i){var a,p=arguments.length,g=p<3?r:i===null?i=Object.getOwnPropertyDescriptor(r,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(s,r,e,i);else for(var m=s.length-1;m>=0;m--)(a=s[m])&&(g=(p<3?a(g):p>3?a(r,e,g):a(r,e))||g);return p>3&&g&&Object.defineProperty(r,e,g),g},u=this&&this.__param||function(s,r){return function(e,i){r(e,i,s)}};Object.defineProperty(t,"__esModule",{value:!0}),t.traceCall=t.setTraceLogger=t.LogService=void 0;const o=n(844),_=n(2585),f={trace:_.LogLevelEnum.TRACE,debug:_.LogLevelEnum.DEBUG,info:_.LogLevelEnum.INFO,warn:_.LogLevelEnum.WARN,error:_.LogLevelEnum.ERROR,off:_.LogLevelEnum.OFF};let S,l=t.LogService=class extends o.Disposable{get logLevel(){return this._logLevel}constructor(s){super(),this._optionsService=s,this._logLevel=_.LogLevelEnum.OFF,this._updateLogLevel(),this.register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel())),S=this}_updateLogLevel(){this._logLevel=f[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(s){for(let r=0;r<s.length;r++)typeof s[r]=="function"&&(s[r]=s[r]())}_log(s,r,e){this._evalLazyOptionalParams(e),s.call(console,(this._optionsService.options.logger?"":"xterm.js: ")+r,...e)}trace(s,...r){var e;this._logLevel<=_.LogLevelEnum.TRACE&&this._log(((e=this._optionsService.options.logger)==null?void 0:e.trace.bind(this._optionsService.options.logger))??console.log,s,r)}debug(s,...r){var e;this._logLevel<=_.LogLevelEnum.DEBUG&&this._log(((e=this._optionsService.options.logger)==null?void 0:e.debug.bind(this._optionsService.options.logger))??console.log,s,r)}info(s,...r){var e;this._logLevel<=_.LogLevelEnum.INFO&&this._log(((e=this._optionsService.options.logger)==null?void 0:e.info.bind(this._optionsService.options.logger))??console.info,s,r)}warn(s,...r){var e;this._logLevel<=_.LogLevelEnum.WARN&&this._log(((e=this._optionsService.options.logger)==null?void 0:e.warn.bind(this._optionsService.options.logger))??console.warn,s,r)}error(s,...r){var e;this._logLevel<=_.LogLevelEnum.ERROR&&this._log(((e=this._optionsService.options.logger)==null?void 0:e.error.bind(this._optionsService.options.logger))??console.error,s,r)}};t.LogService=l=c([u(0,_.IOptionsService)],l),t.setTraceLogger=function(s){S=s},t.traceCall=function(s,r,e){if(typeof e.value!="function")throw new Error("not supported");const i=e.value;e.value=function(...a){if(S.logLevel!==_.LogLevelEnum.TRACE)return i.apply(this,a);S.trace(`GlyphRenderer#${i.name}(${a.map(g=>JSON.stringify(g)).join(", ")})`);const p=i.apply(this,a);return S.trace(`GlyphRenderer#${i.name} return`,p),p}}},7302:(x,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OptionsService=t.DEFAULT_OPTIONS=void 0;const c=n(8460),u=n(844),o=n(6114);t.DEFAULT_OPTIONS={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,cursorInactiveStyle:"outline",customGlyphs:!0,drawBoldTextInBrightColors:!0,documentOverride:null,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"courier-new, courier, monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",ignoreBracketedPasteMode:!1,lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",logger:null,scrollback:1e3,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},rescaleOverlappingGlyphs:!1,rightClickSelectsWord:o.isMac,windowOptions:{},windowsMode:!1,windowsPty:{},wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRulerWidth:0};const _=["normal","bold","100","200","300","400","500","600","700","800","900"];class f extends u.Disposable{constructor(l){super(),this._onOptionChange=this.register(new c.EventEmitter),this.onOptionChange=this._onOptionChange.event;const s={...t.DEFAULT_OPTIONS};for(const r in l)if(r in s)try{const e=l[r];s[r]=this._sanitizeAndValidateOption(r,e)}catch(e){console.error(e)}this.rawOptions=s,this.options={...s},this._setupOptions(),this.register((0,u.toDisposable)(()=>{this.rawOptions.linkHandler=null,this.rawOptions.documentOverride=null}))}onSpecificOptionChange(l,s){return this.onOptionChange(r=>{r===l&&s(this.rawOptions[l])})}onMultipleOptionChange(l,s){return this.onOptionChange(r=>{l.indexOf(r)!==-1&&s()})}_setupOptions(){const l=r=>{if(!(r in t.DEFAULT_OPTIONS))throw new Error(`No option with key "${r}"`);return this.rawOptions[r]},s=(r,e)=>{if(!(r in t.DEFAULT_OPTIONS))throw new Error(`No option with key "${r}"`);e=this._sanitizeAndValidateOption(r,e),this.rawOptions[r]!==e&&(this.rawOptions[r]=e,this._onOptionChange.fire(r))};for(const r in this.rawOptions){const e={get:l.bind(this,r),set:s.bind(this,r)};Object.defineProperty(this.options,r,e)}}_sanitizeAndValidateOption(l,s){switch(l){case"cursorStyle":if(s||(s=t.DEFAULT_OPTIONS[l]),!function(r){return r==="block"||r==="underline"||r==="bar"}(s))throw new Error(`"${s}" is not a valid value for ${l}`);break;case"wordSeparator":s||(s=t.DEFAULT_OPTIONS[l]);break;case"fontWeight":case"fontWeightBold":if(typeof s=="number"&&1<=s&&s<=1e3)break;s=_.includes(s)?s:t.DEFAULT_OPTIONS[l];break;case"cursorWidth":s=Math.floor(s);case"lineHeight":case"tabStopWidth":if(s<1)throw new Error(`${l} cannot be less than 1, value: ${s}`);break;case"minimumContrastRatio":s=Math.max(1,Math.min(21,Math.round(10*s)/10));break;case"scrollback":if((s=Math.min(s,4294967295))<0)throw new Error(`${l} cannot be less than 0, value: ${s}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(s<=0)throw new Error(`${l} cannot be less than or equal to 0, value: ${s}`);break;case"rows":case"cols":if(!s&&s!==0)throw new Error(`${l} must be numeric, value: ${s}`);break;case"windowsPty":s=s??{}}return s}}t.OptionsService=f},2660:function(x,t,n){var c=this&&this.__decorate||function(f,S,l,s){var r,e=arguments.length,i=e<3?S:s===null?s=Object.getOwnPropertyDescriptor(S,l):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(f,S,l,s);else for(var a=f.length-1;a>=0;a--)(r=f[a])&&(i=(e<3?r(i):e>3?r(S,l,i):r(S,l))||i);return e>3&&i&&Object.defineProperty(S,l,i),i},u=this&&this.__param||function(f,S){return function(l,s){S(l,s,f)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OscLinkService=void 0;const o=n(2585);let _=t.OscLinkService=class{constructor(f){this._bufferService=f,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(f){const S=this._bufferService.buffer;if(f.id===void 0){const a=S.addMarker(S.ybase+S.y),p={data:f,id:this._nextId++,lines:[a]};return a.onDispose(()=>this._removeMarkerFromLink(p,a)),this._dataByLinkId.set(p.id,p),p.id}const l=f,s=this._getEntryIdKey(l),r=this._entriesWithId.get(s);if(r)return this.addLineToLink(r.id,S.ybase+S.y),r.id;const e=S.addMarker(S.ybase+S.y),i={id:this._nextId++,key:this._getEntryIdKey(l),data:l,lines:[e]};return e.onDispose(()=>this._removeMarkerFromLink(i,e)),this._entriesWithId.set(i.key,i),this._dataByLinkId.set(i.id,i),i.id}addLineToLink(f,S){const l=this._dataByLinkId.get(f);if(l&&l.lines.every(s=>s.line!==S)){const s=this._bufferService.buffer.addMarker(S);l.lines.push(s),s.onDispose(()=>this._removeMarkerFromLink(l,s))}}getLinkData(f){var S;return(S=this._dataByLinkId.get(f))==null?void 0:S.data}_getEntryIdKey(f){return`${f.id};;${f.uri}`}_removeMarkerFromLink(f,S){const l=f.lines.indexOf(S);l!==-1&&(f.lines.splice(l,1),f.lines.length===0&&(f.data.id!==void 0&&this._entriesWithId.delete(f.key),this._dataByLinkId.delete(f.id)))}};t.OscLinkService=_=c([u(0,o.IBufferService)],_)},8343:(x,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createDecorator=t.getServiceDependencies=t.serviceRegistry=void 0;const n="di$target",c="di$dependencies";t.serviceRegistry=new Map,t.getServiceDependencies=function(u){return u[c]||[]},t.createDecorator=function(u){if(t.serviceRegistry.has(u))return t.serviceRegistry.get(u);const o=function(_,f,S){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");(function(l,s,r){s[n]===s?s[c].push({id:l,index:r}):(s[c]=[{id:l,index:r}],s[n]=s)})(o,_,S)};return o.toString=()=>u,t.serviceRegistry.set(u,o),o}},2585:(x,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IDecorationService=t.IUnicodeService=t.IOscLinkService=t.IOptionsService=t.ILogService=t.LogLevelEnum=t.IInstantiationService=t.ICharsetService=t.ICoreService=t.ICoreMouseService=t.IBufferService=void 0;const c=n(8343);var u;t.IBufferService=(0,c.createDecorator)("BufferService"),t.ICoreMouseService=(0,c.createDecorator)("CoreMouseService"),t.ICoreService=(0,c.createDecorator)("CoreService"),t.ICharsetService=(0,c.createDecorator)("CharsetService"),t.IInstantiationService=(0,c.createDecorator)("InstantiationService"),function(o){o[o.TRACE=0]="TRACE",o[o.DEBUG=1]="DEBUG",o[o.INFO=2]="INFO",o[o.WARN=3]="WARN",o[o.ERROR=4]="ERROR",o[o.OFF=5]="OFF"}(u||(t.LogLevelEnum=u={})),t.ILogService=(0,c.createDecorator)("LogService"),t.IOptionsService=(0,c.createDecorator)("OptionsService"),t.IOscLinkService=(0,c.createDecorator)("OscLinkService"),t.IUnicodeService=(0,c.createDecorator)("UnicodeService"),t.IDecorationService=(0,c.createDecorator)("DecorationService")},1480:(x,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UnicodeService=void 0;const c=n(8460),u=n(225);class o{static extractShouldJoin(f){return(1&f)!=0}static extractWidth(f){return f>>1&3}static extractCharKind(f){return f>>3}static createPropertyValue(f,S,l=!1){return(16777215&f)<<3|(3&S)<<1|(l?1:0)}constructor(){this._providers=Object.create(null),this._active="",this._onChange=new c.EventEmitter,this.onChange=this._onChange.event;const f=new u.UnicodeV6;this.register(f),this._active=f.version,this._activeProvider=f}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(f){if(!this._providers[f])throw new Error(`unknown Unicode version "${f}"`);this._active=f,this._activeProvider=this._providers[f],this._onChange.fire(f)}register(f){this._providers[f.version]=f}wcwidth(f){return this._activeProvider.wcwidth(f)}getStringCellWidth(f){let S=0,l=0;const s=f.length;for(let r=0;r<s;++r){let e=f.charCodeAt(r);if(55296<=e&&e<=56319){if(++r>=s)return S+this.wcwidth(e);const p=f.charCodeAt(r);56320<=p&&p<=57343?e=1024*(e-55296)+p-56320+65536:S+=this.wcwidth(p)}const i=this.charProperties(e,l);let a=o.extractWidth(i);o.extractShouldJoin(i)&&(a-=o.extractWidth(l)),S+=a,l=i}return S}charProperties(f,S){return this._activeProvider.charProperties(f,S)}}t.UnicodeService=o}},k={};function M(x){var t=k[x];if(t!==void 0)return t.exports;var n=k[x]={exports:{}};return w[x].call(n.exports,n,n.exports,M),n.exports}var P={};return(()=>{var x=P;Object.defineProperty(x,"__esModule",{value:!0}),x.Terminal=void 0;const t=M(9042),n=M(3236),c=M(844),u=M(5741),o=M(8285),_=M(7975),f=M(7090),S=["cols","rows"];class l extends c.Disposable{constructor(r){super(),this._core=this.register(new n.Terminal(r)),this._addonManager=this.register(new u.AddonManager),this._publicOptions={...this._core.options};const e=a=>this._core.options[a],i=(a,p)=>{this._checkReadonlyOptions(a),this._core.options[a]=p};for(const a in this._core.options){const p={get:e.bind(this,a),set:i.bind(this,a)};Object.defineProperty(this._publicOptions,a,p)}}_checkReadonlyOptions(r){if(S.includes(r))throw new Error(`Option "${r}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw new Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new _.ParserApi(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new f.UnicodeApi(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=this.register(new o.BufferNamespaceApi(this._core))),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){const r=this._core.coreService.decPrivateModes;let e="none";switch(this._core.coreMouseService.activeProtocol){case"X10":e="x10";break;case"VT200":e="vt200";break;case"DRAG":e="drag";break;case"ANY":e="any"}return{applicationCursorKeysMode:r.applicationCursorKeys,applicationKeypadMode:r.applicationKeypad,bracketedPasteMode:r.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:e,originMode:r.origin,reverseWraparoundMode:r.reverseWraparound,sendFocusMode:r.sendFocus,wraparoundMode:r.wraparound}}get options(){return this._publicOptions}set options(r){for(const e in r)this._publicOptions[e]=r[e]}blur(){this._core.blur()}focus(){this._core.focus()}input(r,e=!0){this._core.input(r,e)}resize(r,e){this._verifyIntegers(r,e),this._core.resize(r,e)}open(r){this._core.open(r)}attachCustomKeyEventHandler(r){this._core.attachCustomKeyEventHandler(r)}attachCustomWheelEventHandler(r){this._core.attachCustomWheelEventHandler(r)}registerLinkProvider(r){return this._core.registerLinkProvider(r)}registerCharacterJoiner(r){return this._checkProposedApi(),this._core.registerCharacterJoiner(r)}deregisterCharacterJoiner(r){this._checkProposedApi(),this._core.deregisterCharacterJoiner(r)}registerMarker(r=0){return this._verifyIntegers(r),this._core.registerMarker(r)}registerDecoration(r){return this._checkProposedApi(),this._verifyPositiveIntegers(r.x??0,r.width??0,r.height??0),this._core.registerDecoration(r)}hasSelection(){return this._core.hasSelection()}select(r,e,i){this._verifyIntegers(r,e,i),this._core.select(r,e,i)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines(r,e){this._verifyIntegers(r,e),this._core.selectLines(r,e)}dispose(){super.dispose()}scrollLines(r){this._verifyIntegers(r),this._core.scrollLines(r)}scrollPages(r){this._verifyIntegers(r),this._core.scrollPages(r)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(r){this._verifyIntegers(r),this._core.scrollToLine(r)}clear(){this._core.clear()}write(r,e){this._core.write(r,e)}writeln(r,e){this._core.write(r),this._core.write(`\r
`,e)}paste(r){this._core.paste(r)}refresh(r,e){this._verifyIntegers(r,e),this._core.refresh(r,e)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon(r){this._addonManager.loadAddon(this,r)}static get strings(){return t}_verifyIntegers(...r){for(const e of r)if(e===1/0||isNaN(e)||e%1!=0)throw new Error("This API only accepts integers")}_verifyPositiveIntegers(...r){for(const e of r)if(e&&(e===1/0||isNaN(e)||e%1!=0||e<0))throw new Error("This API only accepts positive integers")}}x.Terminal=l})(),P})())})(Bt);var Ai=Bt.exports;const Bi="/koan-web-repl/assets/koan_wasm_wrapper_bg-1iVJ0L_r.wasm",Ti=async(h={},v)=>{let w;if(v.startsWith("data:")){const k=v.replace(/^data:.*?base64,/,"");let M;if(typeof Buffer=="function"&&typeof Buffer.from=="function")M=Buffer.from(k,"base64");else if(typeof atob=="function"){const P=atob(k);M=new Uint8Array(P.length);for(let x=0;x<P.length;x++)M[x]=P.charCodeAt(x)}else throw new Error("Cannot decode base64-encoded data URL");w=await WebAssembly.instantiate(M,h)}else{const k=await fetch(v),M=k.headers.get("Content-Type")||"";if("instantiateStreaming"in WebAssembly&&M.startsWith("application/wasm"))w=await WebAssembly.instantiateStreaming(k,h);else{const P=await k.arrayBuffer();w=await WebAssembly.instantiate(P,h)}}return w.instance.exports};let he;function Mi(h){he=h}const Oi=typeof TextDecoder>"u"?(0,yt.require)("util").TextDecoder:TextDecoder;let Tt=new Oi("utf-8",{ignoreBOM:!0,fatal:!0});Tt.decode();let Xe=null;function Je(){return(Xe===null||Xe.byteLength===0)&&(Xe=new Uint8Array(he.memory.buffer)),Xe}function Pe(h,v){return h=h>>>0,Tt.decode(Je().subarray(h,h+v))}const we=new Array(128).fill(void 0);we.push(void 0,null,!0,!1);let He=we.length;function Mt(h){He===we.length&&we.push(we.length+1);const v=He;return He=we[v],we[v]=h,v}function Ot(h){return we[h]}function Ii(h){h<132||(we[h]=He,He=h)}function It(h){const v=Ot(h);return Ii(h),v}let Ye=null;function ye(){return(Ye===null||Ye.byteLength===0)&&(Ye=new Int32Array(he.memory.buffer)),Ye}let Ze=0;const Pi=typeof TextEncoder>"u"?(0,yt.require)("util").TextEncoder:TextEncoder;let Qe=new Pi("utf-8");const Hi=typeof Qe.encodeInto=="function"?function(h,v){return Qe.encodeInto(h,v)}:function(h,v){const w=Qe.encode(h);return v.set(w),{read:h.length,written:w.length}};function Pt(h,v,w){if(w===void 0){const t=Qe.encode(h),n=v(t.length,1)>>>0;return Je().subarray(n,n+t.length).set(t),Ze=t.length,n}let k=h.length,M=v(k,1)>>>0;const P=Je();let x=0;for(;x<k;x++){const t=h.charCodeAt(x);if(t>127)break;P[M+x]=t}if(x!==k){x!==0&&(h=h.slice(x)),M=w(M,k,k=x+h.length*3,1)>>>0;const t=Je().subarray(M+x,M+k),n=Hi(h,t);x+=n.written,M=w(M,k,x,1)>>>0}return Ze=x,M}function Fi(h,v){if(!(h instanceof v))throw new Error(`expected instance of ${v.name}`);return h.ptr}function Wi(h,v){try{const P=he.__wbindgen_add_to_stack_pointer(-16),x=Pt(h,he.__wbindgen_malloc,he.__wbindgen_realloc),t=Ze;Fi(v,Ft),he.run_line(P,x,t,v.__wbg_ptr);var w=ye()[P/4+0],k=ye()[P/4+1],M=ye()[P/4+2];if(M)throw It(k);return dt.__wrap(w)}finally{he.__wbindgen_add_to_stack_pointer(16)}}const Ht=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(h=>he.__wbg_output_free(h>>>0));class dt{static __wrap(v){v=v>>>0;const w=Object.create(dt.prototype);return w.__wbg_ptr=v,Ht.register(w,w.__wbg_ptr,w),w}__destroy_into_raw(){const v=this.__wbg_ptr;return this.__wbg_ptr=0,Ht.unregister(this),v}free(){const v=this.__destroy_into_raw();he.__wbg_output_free(v)}stdout(){let v,w;try{const P=he.__wbindgen_add_to_stack_pointer(-16);he.output_stdout(P,this.__wbg_ptr);var k=ye()[P/4+0],M=ye()[P/4+1];return v=k,w=M,Pe(k,M)}finally{he.__wbindgen_add_to_stack_pointer(16),he.__wbindgen_free(v,w,1)}}result(){let v,w;try{const P=he.__wbindgen_add_to_stack_pointer(-16);he.output_result(P,this.__wbg_ptr);var k=ye()[P/4+0],M=ye()[P/4+1];return v=k,w=M,Pe(k,M)}finally{he.__wbindgen_add_to_stack_pointer(16),he.__wbindgen_free(v,w,1)}}}const Ni=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(h=>he.__wbg_wstate_free(h>>>0));class Ft{__destroy_into_raw(){const v=this.__wbg_ptr;return this.__wbg_ptr=0,Ni.unregister(this),v}free(){const v=this.__destroy_into_raw();he.__wbg_wstate_free(v)}constructor(){const v=he.wstate_new();return this.__wbg_ptr=v>>>0,this}}function Ui(h,v){const w=Pe(h,v);return Mt(w)}function ji(){const h=new Error;return Mt(h)}function $i(h,v){const w=Ot(v).stack,k=Pt(w,he.__wbindgen_malloc,he.__wbindgen_realloc),M=Ze;ye()[h/4+1]=M,ye()[h/4+0]=k}function zi(h,v){let w,k;try{w=h,k=v,console.error(Pe(h,v))}finally{he.__wbindgen_free(w,k,1)}}function Ki(h){It(h)}function Vi(h,v){throw new Error(Pe(h,v))}URL=globalThis.URL;const me=await Ti({"./koan_wasm_wrapper_bg.js":{__wbindgen_string_new:Ui,__wbg_new_abda76e883ba8a5f:ji,__wbg_stack_658279fe44541cf6:$i,__wbg_error_f851667af71bcfc6:zi,__wbindgen_object_drop_ref:Ki,__wbindgen_throw:Vi}},Bi),qi=me.memory,Gi=me.__wbg_output_free,Xi=me.output_stdout,Ji=me.output_result,Yi=me.__wbg_wstate_free,Zi=me.wstate_new,Qi=me.run_line,es=me.__wbindgen_add_to_stack_pointer,ts=me.__wbindgen_free,is=me.__wbindgen_malloc,ss=me.__wbindgen_realloc,rs=Object.freeze(Object.defineProperty({__proto__:null,__wbg_output_free:Gi,__wbg_wstate_free:Yi,__wbindgen_add_to_stack_pointer:es,__wbindgen_free:ts,__wbindgen_malloc:is,__wbindgen_realloc:ss,memory:qi,output_result:Ji,output_stdout:Xi,run_line:Qi,wstate_new:Zi},Symbol.toStringTag,{value:"Module"}));Mi(rs);function Wt(h){return h instanceof Map?h.clear=h.delete=h.set=function(){throw new Error("map is read-only")}:h instanceof Set&&(h.add=h.clear=h.delete=function(){throw new Error("set is read-only")}),Object.freeze(h),Object.getOwnPropertyNames(h).forEach(v=>{const w=h[v],k=typeof w;(k==="object"||k==="function")&&!Object.isFrozen(w)&&Wt(w)}),h}class Nt{constructor(v){v.data===void 0&&(v.data={}),this.data=v.data,this.isMatchIgnored=!1}ignoreMatch(){this.isMatchIgnored=!0}}function Ut(h){return h.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")}function ke(h,...v){const w=Object.create(null);for(const k in h)w[k]=h[k];return v.forEach(function(k){for(const M in k)w[M]=k[M]}),w}const ns="</span>",jt=h=>!!h.scope,os=(h,{prefix:v})=>{if(h.startsWith("language:"))return h.replace("language:","language-");if(h.includes(".")){const w=h.split(".");return[`${v}${w.shift()}`,...w.map((k,M)=>`${k}${"_".repeat(M+1)}`)].join(" ")}return`${v}${h}`};class as{constructor(v,w){this.buffer="",this.classPrefix=w.classPrefix,v.walk(this)}addText(v){this.buffer+=Ut(v)}openNode(v){if(!jt(v))return;const w=os(v.scope,{prefix:this.classPrefix});this.span(w)}closeNode(v){jt(v)&&(this.buffer+=ns)}value(){return this.buffer}span(v){this.buffer+=`<span class="${v}">`}}const $t=(h={})=>{const v={children:[]};return Object.assign(v,h),v};class ut{constructor(){this.rootNode=$t(),this.stack=[this.rootNode]}get top(){return this.stack[this.stack.length-1]}get root(){return this.rootNode}add(v){this.top.children.push(v)}openNode(v){const w=$t({scope:v});this.add(w),this.stack.push(w)}closeNode(){if(this.stack.length>1)return this.stack.pop()}closeAllNodes(){for(;this.closeNode(););}toJSON(){return JSON.stringify(this.rootNode,null,4)}walk(v){return this.constructor._walk(v,this.rootNode)}static _walk(v,w){return typeof w=="string"?v.addText(w):w.children&&(v.openNode(w),w.children.forEach(k=>this._walk(v,k)),v.closeNode(w)),v}static _collapse(v){typeof v!="string"&&v.children&&(v.children.every(w=>typeof w=="string")?v.children=[v.children.join("")]:v.children.forEach(w=>{ut._collapse(w)}))}}class hs extends ut{constructor(v){super(),this.options=v}addText(v){v!==""&&this.add(v)}startScope(v){this.openNode(v)}endScope(){this.closeNode()}__addSublanguage(v,w){const k=v.root;w&&(k.scope=`language:${w}`),this.add(k)}toHTML(){return new as(this,this.options).value()}finalize(){return this.closeAllNodes(),!0}}function Fe(h){return h?typeof h=="string"?h:h.source:null}function zt(h){return Le("(?=",h,")")}function cs(h){return Le("(?:",h,")*")}function ls(h){return Le("(?:",h,")?")}function Le(...h){return h.map(v=>Fe(v)).join("")}function ds(h){const v=h[h.length-1];return typeof v=="object"&&v.constructor===Object?(h.splice(h.length-1,1),v):{}}function _t(...h){return"("+(ds(h).capture?"":"?:")+h.map(v=>Fe(v)).join("|")+")"}function Kt(h){return new RegExp(h.toString()+"|").exec("").length-1}function us(h,v){const w=h&&h.exec(v);return w&&w.index===0}const _s=/\[(?:[^\\\]]|\\.)*\]|\(\??|\\([1-9][0-9]*)|\\./;function ft(h,{joinWith:v}){let w=0;return h.map(k=>{w+=1;const M=w;let P=Fe(k),x="";for(;P.length>0;){const t=_s.exec(P);if(!t){x+=P;break}x+=P.substring(0,t.index),P=P.substring(t.index+t[0].length),t[0][0]==="\\"&&t[1]?x+="\\"+String(Number(t[1])+M):(x+=t[0],t[0]==="("&&w++)}return x}).map(k=>`(${k})`).join(v)}const fs=/\b\B/,Vt="[a-zA-Z]\\w*",gt="[a-zA-Z_]\\w*",qt="\\b\\d+(\\.\\d+)?",Gt="(-?)(\\b0[xX][a-fA-F0-9]+|(\\b\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)",Xt="\\b(0b[01]+)",gs="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|-|-=|/=|/|:|;|<<|<<=|<=|<|===|==|=|>>>=|>>=|>=|>>>|>>|>|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~",ps=(h={})=>{const v=/^#![ ]*\//;return h.binary&&(h.begin=Le(v,/.*\b/,h.binary,/\b.*/)),ke({scope:"meta",begin:v,end:/$/,relevance:0,"on:begin":(w,k)=>{w.index!==0&&k.ignoreMatch()}},h)},We={begin:"\\\\[\\s\\S]",relevance:0},vs={scope:"string",begin:"'",end:"'",illegal:"\\n",contains:[We]},ms={scope:"string",begin:'"',end:'"',illegal:"\\n",contains:[We]},Ss={begin:/\b(a|an|the|are|I'm|isn't|don't|doesn't|won't|but|just|should|pretty|simply|enough|gonna|going|wtf|so|such|will|you|your|they|like|more)\b/},et=function(h,v,w={}){const k=ke({scope:"comment",begin:h,end:v,contains:[]},w);k.contains.push({scope:"doctag",begin:"[ ]*(?=(TODO|FIXME|NOTE|BUG|OPTIMIZE|HACK|XXX):)",end:/(TODO|FIXME|NOTE|BUG|OPTIMIZE|HACK|XXX):/,excludeBegin:!0,relevance:0});const M=_t("I","a","is","so","us","to","at","if","in","it","on",/[A-Za-z]+['](d|ve|re|ll|t|s|n)/,/[A-Za-z]+[-][a-z]+/,/[A-Za-z][a-z]{2,}/);return k.contains.push({begin:Le(/[ ]+/,"(",M,/[.]?[:]?([.][ ]|[ ])/,"){3}")}),k},bs=et("//","$"),Cs=et("/\\*","\\*/"),ws=et("#","$"),ys={scope:"number",begin:qt,relevance:0},Es={scope:"number",begin:Gt,relevance:0},xs={scope:"number",begin:Xt,relevance:0},ks={scope:"regexp",begin:/\/(?=[^/\n]*\/)/,end:/\/[gimuy]*/,contains:[We,{begin:/\[/,end:/\]/,relevance:0,contains:[We]}]},Ls={scope:"title",begin:Vt,relevance:0},Ds={scope:"title",begin:gt,relevance:0},Rs={begin:"\\.\\s*"+gt,relevance:0};var tt=Object.freeze({__proto__:null,APOS_STRING_MODE:vs,BACKSLASH_ESCAPE:We,BINARY_NUMBER_MODE:xs,BINARY_NUMBER_RE:Xt,COMMENT:et,C_BLOCK_COMMENT_MODE:Cs,C_LINE_COMMENT_MODE:bs,C_NUMBER_MODE:Es,C_NUMBER_RE:Gt,END_SAME_AS_BEGIN:function(h){return Object.assign(h,{"on:begin":(v,w)=>{w.data._beginMatch=v[1]},"on:end":(v,w)=>{w.data._beginMatch!==v[1]&&w.ignoreMatch()}})},HASH_COMMENT_MODE:ws,IDENT_RE:Vt,MATCH_NOTHING_RE:fs,METHOD_GUARD:Rs,NUMBER_MODE:ys,NUMBER_RE:qt,PHRASAL_WORDS_MODE:Ss,QUOTE_STRING_MODE:ms,REGEXP_MODE:ks,RE_STARTERS_RE:gs,SHEBANG:ps,TITLE_MODE:Ls,UNDERSCORE_IDENT_RE:gt,UNDERSCORE_TITLE_MODE:Ds});function As(h,v){h.input[h.index-1]==="."&&v.ignoreMatch()}function Bs(h,v){h.className!==void 0&&(h.scope=h.className,delete h.className)}function Ts(h,v){v&&h.beginKeywords&&(h.begin="\\b("+h.beginKeywords.split(" ").join("|")+")(?!\\.)(?=\\b|\\s)",h.__beforeBegin=As,h.keywords=h.keywords||h.beginKeywords,delete h.beginKeywords,h.relevance===void 0&&(h.relevance=0))}function Ms(h,v){Array.isArray(h.illegal)&&(h.illegal=_t(...h.illegal))}function Os(h,v){if(h.match){if(h.begin||h.end)throw new Error("begin & end are not supported with match");h.begin=h.match,delete h.match}}function Is(h,v){h.relevance===void 0&&(h.relevance=1)}const Ps=(h,v)=>{if(!h.beforeMatch)return;if(h.starts)throw new Error("beforeMatch cannot be used with starts");const w=Object.assign({},h);Object.keys(h).forEach(k=>{delete h[k]}),h.keywords=w.keywords,h.begin=Le(w.beforeMatch,zt(w.begin)),h.starts={relevance:0,contains:[Object.assign(w,{endsParent:!0})]},h.relevance=0,delete w.beforeMatch},Hs=["of","and","for","in","not","or","if","then","parent","list","value"],Fs="keyword";function Jt(h,v,w=Fs){const k=Object.create(null);return typeof h=="string"?M(w,h.split(" ")):Array.isArray(h)?M(w,h):Object.keys(h).forEach(function(P){Object.assign(k,Jt(h[P],v,P))}),k;function M(P,x){v&&(x=x.map(t=>t.toLowerCase())),x.forEach(function(t){const n=t.split("|");k[n[0]]=[P,Ws(n[0],n[1])]})}}function Ws(h,v){return v?Number(v):Ns(h)?0:1}function Ns(h){return Hs.includes(h.toLowerCase())}const Yt={},De=h=>{console.error(h)},Zt=(h,...v)=>{console.log(`WARN: ${h}`,...v)},Ae=(h,v)=>{Yt[`${h}/${v}`]||(console.log(`Deprecated as of ${h}. ${v}`),Yt[`${h}/${v}`]=!0)},it=new Error;function Qt(h,v,{key:w}){let k=0;const M=h[w],P={},x={};for(let t=1;t<=v.length;t++)x[t+k]=M[t],P[t+k]=!0,k+=Kt(v[t-1]);h[w]=x,h[w]._emit=P,h[w]._multi=!0}function Us(h){if(Array.isArray(h.begin)){if(h.skip||h.excludeBegin||h.returnBegin)throw De("skip, excludeBegin, returnBegin not compatible with beginScope: {}"),it;if(typeof h.beginScope!="object"||h.beginScope===null)throw De("beginScope must be object"),it;Qt(h,h.begin,{key:"beginScope"}),h.begin=ft(h.begin,{joinWith:""})}}function js(h){if(Array.isArray(h.end)){if(h.skip||h.excludeEnd||h.returnEnd)throw De("skip, excludeEnd, returnEnd not compatible with endScope: {}"),it;if(typeof h.endScope!="object"||h.endScope===null)throw De("endScope must be object"),it;Qt(h,h.end,{key:"endScope"}),h.end=ft(h.end,{joinWith:""})}}function $s(h){h.scope&&typeof h.scope=="object"&&h.scope!==null&&(h.beginScope=h.scope,delete h.scope)}function zs(h){$s(h),typeof h.beginScope=="string"&&(h.beginScope={_wrap:h.beginScope}),typeof h.endScope=="string"&&(h.endScope={_wrap:h.endScope}),Us(h),js(h)}function Ks(h){function v(x,t){return new RegExp(Fe(x),"m"+(h.case_insensitive?"i":"")+(h.unicodeRegex?"u":"")+(t?"g":""))}class w{constructor(){this.matchIndexes={},this.regexes=[],this.matchAt=1,this.position=0}addRule(t,n){n.position=this.position++,this.matchIndexes[this.matchAt]=n,this.regexes.push([n,t]),this.matchAt+=Kt(t)+1}compile(){this.regexes.length===0&&(this.exec=()=>null);const t=this.regexes.map(n=>n[1]);this.matcherRe=v(ft(t,{joinWith:"|"}),!0),this.lastIndex=0}exec(t){this.matcherRe.lastIndex=this.lastIndex;const n=this.matcherRe.exec(t);if(!n)return null;const c=n.findIndex((o,_)=>_>0&&o!==void 0),u=this.matchIndexes[c];return n.splice(0,c),Object.assign(n,u)}}class k{constructor(){this.rules=[],this.multiRegexes=[],this.count=0,this.lastIndex=0,this.regexIndex=0}getMatcher(t){if(this.multiRegexes[t])return this.multiRegexes[t];const n=new w;return this.rules.slice(t).forEach(([c,u])=>n.addRule(c,u)),n.compile(),this.multiRegexes[t]=n,n}resumingScanAtSamePosition(){return this.regexIndex!==0}considerAll(){this.regexIndex=0}addRule(t,n){this.rules.push([t,n]),n.type==="begin"&&this.count++}exec(t){const n=this.getMatcher(this.regexIndex);n.lastIndex=this.lastIndex;let c=n.exec(t);if(this.resumingScanAtSamePosition()&&!(c&&c.index===this.lastIndex)){const u=this.getMatcher(0);u.lastIndex=this.lastIndex+1,c=u.exec(t)}return c&&(this.regexIndex+=c.position+1,this.regexIndex===this.count&&this.considerAll()),c}}function M(x){const t=new k;return x.contains.forEach(n=>t.addRule(n.begin,{rule:n,type:"begin"})),x.terminatorEnd&&t.addRule(x.terminatorEnd,{type:"end"}),x.illegal&&t.addRule(x.illegal,{type:"illegal"}),t}function P(x,t){const n=x;if(x.isCompiled)return n;[Bs,Os,zs,Ps].forEach(u=>u(x,t)),h.compilerExtensions.forEach(u=>u(x,t)),x.__beforeBegin=null,[Ts,Ms,Is].forEach(u=>u(x,t)),x.isCompiled=!0;let c=null;return typeof x.keywords=="object"&&x.keywords.$pattern&&(x.keywords=Object.assign({},x.keywords),c=x.keywords.$pattern,delete x.keywords.$pattern),c=c||/\w+/,x.keywords&&(x.keywords=Jt(x.keywords,h.case_insensitive)),n.keywordPatternRe=v(c,!0),t&&(x.begin||(x.begin=/\B|\b/),n.beginRe=v(n.begin),!x.end&&!x.endsWithParent&&(x.end=/\B|\b/),x.end&&(n.endRe=v(n.end)),n.terminatorEnd=Fe(n.end)||"",x.endsWithParent&&t.terminatorEnd&&(n.terminatorEnd+=(x.end?"|":"")+t.terminatorEnd)),x.illegal&&(n.illegalRe=v(x.illegal)),x.contains||(x.contains=[]),x.contains=[].concat(...x.contains.map(function(u){return Vs(u==="self"?x:u)})),x.contains.forEach(function(u){P(u,n)}),x.starts&&P(x.starts,t),n.matcher=M(n),n}if(h.compilerExtensions||(h.compilerExtensions=[]),h.contains&&h.contains.includes("self"))throw new Error("ERR: contains `self` is not supported at the top-level of a language.  See documentation.");return h.classNameAliases=ke(h.classNameAliases||{}),P(h)}function ei(h){return h?h.endsWithParent||ei(h.starts):!1}function Vs(h){return h.variants&&!h.cachedVariants&&(h.cachedVariants=h.variants.map(function(v){return ke(h,{variants:null},v)})),h.cachedVariants?h.cachedVariants:ei(h)?ke(h,{starts:h.starts?ke(h.starts):null}):Object.isFrozen(h)?ke(h):h}var qs="11.9.0";class Gs extends Error{constructor(v,w){super(v),this.name="HTMLInjectionError",this.html=w}}const pt=Ut,ti=ke,ii=Symbol("nomatch"),Xs=7,si=function(h){const v=Object.create(null),w=Object.create(null),k=[];let M=!0;const P="Could not find the language '{}', did you forget to load/include a language module?",x={disableAutodetect:!0,name:"Plain text",contains:[]};let t={ignoreUnescapedHTML:!1,throwUnescapedHTML:!1,noHighlightRe:/^(no-?highlight)$/i,languageDetectRe:/\blang(?:uage)?-([\w-]+)\b/i,classPrefix:"hljs-",cssSelector:"pre code",languages:null,__emitter:hs};function n(I){return t.noHighlightRe.test(I)}function c(I){let F=I.className+" ";F+=I.parentNode?I.parentNode.className:"";const b=t.languageDetectRe.exec(F);if(b){const E=C(b[1]);return E||(Zt(P.replace("{}",b[1])),Zt("Falling back to no-highlight mode for this block.",I)),E?b[1]:"no-highlight"}return F.split(/\s+/).find(E=>n(E)||C(E))}function u(I,F,b){let E="",D="";typeof F=="object"?(E=I,b=F.ignoreIllegals,D=F.language):(Ae("10.7.0","highlight(lang, code, ...args) has been deprecated."),Ae("10.7.0",`Please use highlight(code, options) instead.
https://github.com/highlightjs/highlight.js/issues/2277`),D=I,E=F),b===void 0&&(b=!0);const B={code:E,language:D};N("before:highlight",B);const U=B.result?B.result:o(B.language,B.code,b);return U.code=B.code,N("after:highlight",U),U}function o(I,F,b,E){const D=Object.create(null);function B(K,X){return K.keywords[X]}function U(){if(!Y.keywords){de.addText(re);return}let K=0;Y.keywordPatternRe.lastIndex=0;let X=Y.keywordPatternRe.exec(re),Q="";for(;X;){Q+=re.substring(K,X.index);const ee=ae.case_insensitive?X[0].toLowerCase():X[0],le=B(Y,ee);if(le){const[se,wt]=le;if(de.addText(Q),Q="",D[ee]=(D[ee]||0)+1,D[ee]<=Xs&&(ue+=wt),se.startsWith("_"))Q+=X[0];else{const wr=ae.classNameAliases[se]||se;J(X[0],wr)}}else Q+=X[0];K=Y.keywordPatternRe.lastIndex,X=Y.keywordPatternRe.exec(re)}Q+=re.substring(K),de.addText(Q)}function z(){if(re==="")return;let K=null;if(typeof Y.subLanguage=="string"){if(!v[Y.subLanguage]){de.addText(re);return}K=o(Y.subLanguage,re,!0,Oe[Y.subLanguage]),Oe[Y.subLanguage]=K._top}else K=f(re,Y.subLanguage.length?Y.subLanguage:null);Y.relevance>0&&(ue+=K.relevance),de.__addSublanguage(K._emitter,K.language)}function G(){Y.subLanguage!=null?z():U(),re=""}function J(K,X){K!==""&&(de.startScope(X),de.addText(K),de.endScope())}function O(K,X){let Q=1;const ee=X.length-1;for(;Q<=ee;){if(!K._emit[Q]){Q++;continue}const le=ae.classNameAliases[K[Q]]||K[Q],se=X[Q];le?J(se,le):(re=se,U(),re=""),Q++}}function y(K,X){return K.scope&&typeof K.scope=="string"&&de.openNode(ae.classNameAliases[K.scope]||K.scope),K.beginScope&&(K.beginScope._wrap?(J(re,ae.classNameAliases[K.beginScope._wrap]||K.beginScope._wrap),re=""):K.beginScope._multi&&(O(K.beginScope,X),re="")),Y=Object.create(K,{parent:{value:Y}}),Y}function j(K,X,Q){let ee=us(K.endRe,Q);if(ee){if(K["on:end"]){const le=new Nt(K);K["on:end"](X,le),le.isMatchIgnored&&(ee=!1)}if(ee){for(;K.endsParent&&K.parent;)K=K.parent;return K}}if(K.endsWithParent)return j(K.parent,X,Q)}function W(K){return Y.matcher.regexIndex===0?(re+=K[0],1):(xe=!0,0)}function q(K){const X=K[0],Q=K.rule,ee=new Nt(Q),le=[Q.__beforeBegin,Q["on:begin"]];for(const se of le)if(se&&(se(K,ee),ee.isMatchIgnored))return W(X);return Q.skip?re+=X:(Q.excludeBegin&&(re+=X),G(),!Q.returnBegin&&!Q.excludeBegin&&(re=X)),y(Q,K),Q.returnBegin?0:X.length}function V(K){const X=K[0],Q=F.substring(K.index),ee=j(Y,K,Q);if(!ee)return ii;const le=Y;Y.endScope&&Y.endScope._wrap?(G(),J(X,Y.endScope._wrap)):Y.endScope&&Y.endScope._multi?(G(),O(Y.endScope,K)):le.skip?re+=X:(le.returnEnd||le.excludeEnd||(re+=X),G(),le.excludeEnd&&(re=X));do Y.scope&&de.closeNode(),!Y.skip&&!Y.subLanguage&&(ue+=Y.relevance),Y=Y.parent;while(Y!==ee.parent);return ee.starts&&y(ee.starts,K),le.returnEnd?0:X.length}function te(){const K=[];for(let X=Y;X!==ae;X=X.parent)X.scope&&K.unshift(X.scope);K.forEach(X=>de.openNode(X))}let ne={};function oe(K,X){const Q=X&&X[0];if(re+=K,Q==null)return G(),0;if(ne.type==="begin"&&X.type==="end"&&ne.index===X.index&&Q===""){if(re+=F.slice(X.index,X.index+1),!M){const ee=new Error(`0 width match regex (${I})`);throw ee.languageName=I,ee.badRule=ne.rule,ee}return 1}if(ne=X,X.type==="begin")return q(X);if(X.type==="illegal"&&!b){const ee=new Error('Illegal lexeme "'+Q+'" for mode "'+(Y.scope||"<unnamed>")+'"');throw ee.mode=Y,ee}else if(X.type==="end"){const ee=V(X);if(ee!==ii)return ee}if(X.type==="illegal"&&Q==="")return 1;if(fe>1e5&&fe>X.index*3)throw new Error("potential infinite loop, way more iterations than matches");return re+=Q,Q.length}const ae=C(I);if(!ae)throw De(P.replace("{}",I)),new Error('Unknown language: "'+I+'"');const Z=Ks(ae);let Ee="",Y=E||Z;const Oe={},de=new t.__emitter(t);te();let re="",ue=0,pe=0,fe=0,xe=!1;try{if(ae.__emitTokens)ae.__emitTokens(F,de);else{for(Y.matcher.considerAll();;){fe++,xe?xe=!1:Y.matcher.considerAll(),Y.matcher.lastIndex=pe;const K=Y.matcher.exec(F);if(!K)break;const X=F.substring(pe,K.index),Q=oe(X,K);pe=K.index+Q}oe(F.substring(pe))}return de.finalize(),Ee=de.toHTML(),{language:I,value:Ee,relevance:ue,illegal:!1,_emitter:de,_top:Y}}catch(K){if(K.message&&K.message.includes("Illegal"))return{language:I,value:pt(F),illegal:!0,relevance:0,_illegalBy:{message:K.message,index:pe,context:F.slice(pe-100,pe+100),mode:K.mode,resultSoFar:Ee},_emitter:de};if(M)return{language:I,value:pt(F),illegal:!1,relevance:0,errorRaised:K,_emitter:de,_top:Y};throw K}}function _(I){const F={value:pt(I),illegal:!1,relevance:0,_top:x,_emitter:new t.__emitter(t)};return F._emitter.addText(I),F}function f(I,F){F=F||t.languages||Object.keys(v);const b=_(I),E=F.filter(C).filter(A).map(G=>o(G,I,!1));E.unshift(b);const D=E.sort((G,J)=>{if(G.relevance!==J.relevance)return J.relevance-G.relevance;if(G.language&&J.language){if(C(G.language).supersetOf===J.language)return 1;if(C(J.language).supersetOf===G.language)return-1}return 0}),[B,U]=D,z=B;return z.secondBest=U,z}function S(I,F,b){const E=F&&w[F]||b;I.classList.add("hljs"),I.classList.add(`language-${E}`)}function l(I){let F=null;const b=c(I);if(n(b))return;if(N("before:highlightElement",{el:I,language:b}),I.dataset.highlighted){console.log("Element previously highlighted. To highlight again, first unset `dataset.highlighted`.",I);return}if(I.children.length>0&&(t.ignoreUnescapedHTML||(console.warn("One of your code blocks includes unescaped HTML. This is a potentially serious security risk."),console.warn("https://github.com/highlightjs/highlight.js/wiki/security"),console.warn("The element with unescaped HTML:"),console.warn(I)),t.throwUnescapedHTML))throw new Gs("One of your code blocks includes unescaped HTML.",I.innerHTML);F=I;const E=F.textContent,D=b?u(E,{language:b,ignoreIllegals:!0}):f(E);I.innerHTML=D.value,I.dataset.highlighted="yes",S(I,b,D.language),I.result={language:D.language,re:D.relevance,relevance:D.relevance},D.secondBest&&(I.secondBest={language:D.secondBest.language,relevance:D.secondBest.relevance}),N("after:highlightElement",{el:I,result:D,text:E})}function s(I){t=ti(t,I)}const r=()=>{a(),Ae("10.6.0","initHighlighting() deprecated.  Use highlightAll() now.")};function e(){a(),Ae("10.6.0","initHighlightingOnLoad() deprecated.  Use highlightAll() now.")}let i=!1;function a(){if(document.readyState==="loading"){i=!0;return}document.querySelectorAll(t.cssSelector).forEach(l)}function p(){i&&a()}typeof window<"u"&&window.addEventListener&&window.addEventListener("DOMContentLoaded",p,!1);function g(I,F){let b=null;try{b=F(h)}catch(E){if(De("Language definition for '{}' could not be registered.".replace("{}",I)),M)De(E);else throw E;b=x}b.name||(b.name=I),v[I]=b,b.rawDefinition=F.bind(null,h),b.aliases&&R(b.aliases,{languageName:I})}function m(I){delete v[I];for(const F of Object.keys(w))w[F]===I&&delete w[F]}function d(){return Object.keys(v)}function C(I){return I=(I||"").toLowerCase(),v[I]||v[w[I]]}function R(I,{languageName:F}){typeof I=="string"&&(I=[I]),I.forEach(b=>{w[b.toLowerCase()]=F})}function A(I){const F=C(I);return F&&!F.disableAutodetect}function T(I){I["before:highlightBlock"]&&!I["before:highlightElement"]&&(I["before:highlightElement"]=F=>{I["before:highlightBlock"](Object.assign({block:F.el},F))}),I["after:highlightBlock"]&&!I["after:highlightElement"]&&(I["after:highlightElement"]=F=>{I["after:highlightBlock"](Object.assign({block:F.el},F))})}function L(I){T(I),k.push(I)}function H(I){const F=k.indexOf(I);F!==-1&&k.splice(F,1)}function N(I,F){const b=I;k.forEach(function(E){E[b]&&E[b](F)})}function $(I){return Ae("10.7.0","highlightBlock will be removed entirely in v12.0"),Ae("10.7.0","Please use highlightElement now."),l(I)}Object.assign(h,{highlight:u,highlightAuto:f,highlightAll:a,highlightElement:l,highlightBlock:$,configure:s,initHighlighting:r,initHighlightingOnLoad:e,registerLanguage:g,unregisterLanguage:m,listLanguages:d,getLanguage:C,registerAliases:R,autoDetection:A,inherit:ti,addPlugin:L,removePlugin:H}),h.debugMode=function(){M=!1},h.safeMode=function(){M=!0},h.versionString=qs,h.regex={concat:Le,lookahead:zt,either:_t,optional:ls,anyNumberOfTimes:cs};for(const I in tt)typeof tt[I]=="object"&&Wt(tt[I]);return Object.assign(h,tt),h},Be=si({});Be.newInstance=()=>si({});var Js=Be;Be.HighlightJS=Be,Be.default=Be;const Ys=Ri(Js),ri={},Zs="hljs-";function Qs(h){const v=Ys.newInstance();return h&&P(h),{highlight:w,highlightAuto:k,listLanguages:M,register:P,registerAlias:x,registered:t};function w(n,c,u){const o=u||ri,_=typeof o.prefix=="string"?o.prefix:Zs;if(!v.getLanguage(n))throw new Error("Unknown language: `"+n+"` is not registered");v.configure({__emitter:er,classPrefix:_});const f=v.highlight(c,{ignoreIllegals:!0,language:n});if(f.errorRaised)throw new Error("Could not highlight with `Highlight.js`",{cause:f.errorRaised});const S=f._emitter.root,l=S.data;return l.language=f.language,l.relevance=f.relevance,S}function k(n,c){const u=(c||ri).subset||M();let o=-1,_=0,f;for(;++o<u.length;){const S=u[o];if(!v.getLanguage(S))continue;const l=w(S,n,c);l.data&&l.data.relevance!==void 0&&l.data.relevance>_&&(_=l.data.relevance,f=l)}return f||{type:"root",children:[],data:{language:void 0,relevance:_}}}function M(){return v.listLanguages()}function P(n,c){if(typeof n=="string")v.registerLanguage(n,c);else{let u;for(u in n)Object.hasOwn(n,u)&&v.registerLanguage(u,n[u])}}function x(n,c){if(typeof n=="string")v.registerAliases(typeof c=="string"?c:[...c],{languageName:n});else{let u;for(u in n)if(Object.hasOwn(n,u)){const o=n[u];v.registerAliases(typeof o=="string"?o:[...o],{languageName:u})}}}function t(n){return!!v.getLanguage(n)}}class er{constructor(v){this.options=v,this.root={type:"root",children:[],data:{language:void 0,relevance:0}},this.stack=[this.root]}addText(v){if(v==="")return;const w=this.stack[this.stack.length-1],k=w.children[w.children.length-1];k&&k.type==="text"?k.value+=v:w.children.push({type:"text",value:v})}startScope(v){this.openNode(String(v))}endScope(){this.closeNode()}__addSublanguage(v,w){const k=this.stack[this.stack.length-1],M=v.root.children;w?k.children.push({type:"element",tagName:"span",properties:{className:[w]},children:M}):k.children.push(...M)}openNode(v){const w=this,k=v.split(".").map(function(x,t){return t?x+"_".repeat(t):w.options.classPrefix+x}),M=this.stack[this.stack.length-1],P={type:"element",tagName:"span",properties:{className:k},children:[]};M.children.push(P),this.stack.push(P)}closeNode(){this.stack.pop()}finalize(){}toHTML(){return""}}const vt=10,ni=(h=0)=>v=>`\x1B[${v+h}m`,oi=(h=0)=>v=>`\x1B[${38+h};5;${v}m`,ai=(h=0)=>(v,w,k)=>`\x1B[${38+h};2;${v};${w};${k}m`,ce={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],gray:[90,39],grey:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgGray:[100,49],bgGrey:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};Object.keys(ce.modifier);const tr=Object.keys(ce.color),ir=Object.keys(ce.bgColor);[...tr,...ir];function sr(){const h=new Map;for(const[v,w]of Object.entries(ce)){for(const[k,M]of Object.entries(w))ce[k]={open:`\x1B[${M[0]}m`,close:`\x1B[${M[1]}m`},w[k]=ce[k],h.set(M[0],M[1]);Object.defineProperty(ce,v,{value:w,enumerable:!1})}return Object.defineProperty(ce,"codes",{value:h,enumerable:!1}),ce.color.close="\x1B[39m",ce.bgColor.close="\x1B[49m",ce.color.ansi=ni(),ce.color.ansi256=oi(),ce.color.ansi16m=ai(),ce.bgColor.ansi=ni(vt),ce.bgColor.ansi256=oi(vt),ce.bgColor.ansi16m=ai(vt),Object.defineProperties(ce,{rgbToAnsi256:{value(v,w,k){return v===w&&w===k?v<8?16:v>248?231:Math.round((v-8)/247*24)+232:16+36*Math.round(v/255*5)+6*Math.round(w/255*5)+Math.round(k/255*5)},enumerable:!1},hexToRgb:{value(v){const w=/[a-f\d]{6}|[a-f\d]{3}/i.exec(v.toString(16));if(!w)return[0,0,0];let[k]=w;k.length===3&&(k=[...k].map(P=>P+P).join(""));const M=Number.parseInt(k,16);return[M>>16&255,M>>8&255,M&255]},enumerable:!1},hexToAnsi256:{value:v=>ce.rgbToAnsi256(...ce.hexToRgb(v)),enumerable:!1},ansi256ToAnsi:{value(v){if(v<8)return 30+v;if(v<16)return 90+(v-8);let w,k,M;if(v>=232)w=((v-232)*10+8)/255,k=w,M=w;else{v-=16;const t=v%36;w=Math.floor(v/36)/5,k=Math.floor(t/6)/5,M=t%6/5}const P=Math.max(w,k,M)*2;if(P===0)return 30;let x=30+(Math.round(M)<<2|Math.round(k)<<1|Math.round(w));return P===2&&(x+=60),x},enumerable:!1},rgbToAnsi:{value:(v,w,k)=>ce.ansi256ToAnsi(ce.rgbToAnsi256(v,w,k)),enumerable:!1},hexToAnsi:{value:v=>ce.ansi256ToAnsi(ce.hexToAnsi256(v)),enumerable:!1}}),ce}const be=sr(),st=(()=>{if(navigator.userAgentData){const h=navigator.userAgentData.brands.find(({brand:v})=>v==="Chromium");if(h&&h.version>93)return 3}return/\b(Chrome|Chromium)\//.test(navigator.userAgent)?1:0})(),hi=st!==0&&{level:st,hasBasic:!0,has256:st>=2,has16m:st>=3},rr={stdout:hi,stderr:hi};function nr(h,v,w){let k=h.indexOf(v);if(k===-1)return h;const M=v.length;let P=0,x="";do x+=h.slice(P,k)+v+w,P=k+M,k=h.indexOf(v,P);while(k!==-1);return x+=h.slice(P),x}function or(h,v,w,k){let M=0,P="";do{const x=h[k-1]==="\r";P+=h.slice(M,x?k-1:k)+v+(x?`\r
`:`
`)+w,M=k+1,k=h.indexOf(`
`,M)}while(k!==-1);return P+=h.slice(M),P}const{stdout:ci,stderr:li}=rr,mt=Symbol("GENERATOR"),Te=Symbol("STYLER"),Ne=Symbol("IS_EMPTY"),di=["ansi","ansi","ansi256","ansi16m"],Me=Object.create(null),ar=(h,v={})=>{if(v.level&&!(Number.isInteger(v.level)&&v.level>=0&&v.level<=3))throw new Error("The `level` option should be an integer from 0 to 3");const w=ci?ci.level:0;h.level=v.level===void 0?w:v.level};class ui{constructor(v){return _i(v)}}const _i=h=>{const v=(...w)=>w.join(" ");return ar(v,h),Object.setPrototypeOf(v,Ue.prototype),v};function Ue(h){return _i(h)}Object.setPrototypeOf(Ue.prototype,Function.prototype);for(const[h,v]of Object.entries(be))Me[h]={get(){const w=rt(this,bt(v.open,v.close,this[Te]),this[Ne]);return Object.defineProperty(this,h,{value:w}),w}};Me.visible={get(){const h=rt(this,this[Te],!0);return Object.defineProperty(this,"visible",{value:h}),h}};const St=(h,v,w,...k)=>h==="rgb"?v==="ansi16m"?be[w].ansi16m(...k):v==="ansi256"?be[w].ansi256(be.rgbToAnsi256(...k)):be[w].ansi(be.rgbToAnsi(...k)):h==="hex"?St("rgb",v,w,...be.hexToRgb(...k)):be[w][h](...k),hr=["rgb","hex","ansi256"];for(const h of hr){Me[h]={get(){const{level:w}=this;return function(...k){const M=bt(St(h,di[w],"color",...k),be.color.close,this[Te]);return rt(this,M,this[Ne])}}};const v="bg"+h[0].toUpperCase()+h.slice(1);Me[v]={get(){const{level:w}=this;return function(...k){const M=bt(St(h,di[w],"bgColor",...k),be.bgColor.close,this[Te]);return rt(this,M,this[Ne])}}}}const cr=Object.defineProperties(()=>{},{...Me,level:{enumerable:!0,get(){return this[mt].level},set(h){this[mt].level=h}}}),bt=(h,v,w)=>{let k,M;return w===void 0?(k=h,M=v):(k=w.openAll+h,M=v+w.closeAll),{open:h,close:v,openAll:k,closeAll:M,parent:w}},rt=(h,v,w)=>{const k=(...M)=>lr(k,M.length===1?""+M[0]:M.join(" "));return Object.setPrototypeOf(k,cr),k[mt]=h,k[Te]=v,k[Ne]=w,k},lr=(h,v)=>{if(h.level<=0||!v)return h[Ne]?"":v;let w=h[Te];if(w===void 0)return v;const{openAll:k,closeAll:M}=w;if(v.includes("\x1B"))for(;w!==void 0;)v=nr(v,w.close,w.open),w=w.parent;const P=v.indexOf(`
`);return P!==-1&&(v=or(v,M,k,P)),k+v+M};Object.defineProperties(Ue.prototype,Me),Ue(),Ue({level:li?li.level:0});const ie=new ui({level:2}),fi={comment:ie.gray,quote:ie.gray,keyword:ie.green,"selector-tag":ie.green,addition:ie.green,number:ie.cyan,string:ie.cyan,"meta meta-string":ie.cyan,literal:ie.cyan,doctag:ie.cyan,regexp:ie.cyan,title:ie.blue,section:ie.blue,name:ie.blue,"selector-id":ie.blue,"selector-class":ie.blue,attribute:ie.yellow,attr:ie.yellow,variable:ie.yellow,"template-variable":ie.yellow,"class title":ie.yellow,type:ie.yellow,symbol:ie.magenta,bullet:ie.magenta,subst:ie.magenta,meta:ie.magenta,"meta keyword":ie.magenta,"selector-attr":ie.magenta,"selector-pseudo":ie.magenta,link:ie.magenta,built_in:ie.red,deletion:ie.red,emphasis:ie.italic,strong:ie.bold,formula:ie.inverse};function dr(h){const v=Qs(h);return{highlight:w,highlightAuto:k,listLanguages:v.listLanguages,register:v.register,registerAlias:v.registerAlias,registered:v.registered};function w(M,P,x){const t=v.highlight(M,P),n=t.data;return{language:n.language,relevance:n.relevance,value:Ct(x||fi,t)}}function k(M,P){let x,t;if(P&&("subset"in P||"sheet"in P)){const u=P;t={subset:u.subset},x=u.sheet}else x=P;const n=v.highlightAuto(M,t),c=n.data;return{language:c.language,relevance:c.relevance,value:Ct(x||fi,n)}}}function Ct(h,v){const w=new Set(v.type==="element"&&Array.isArray(v.properties.className)?v.properties.className.map(function(t){return String(t).replace(/^hljs-/,"")}):[]),k={};let M,P="",x;for(x in h)if(Object.hasOwn(h,x)){const t=x.split(" "),n=h[x];w.has(t[0])?t.length===1?M=n:k[t.slice(1).join(" ")]=n:k[x]=n}return"value"in v?P=v.value:"children"in v&&(P=ur(k,v.children)),M&&(P=M(P)),P}function ur(h,v){const w=[];let k=-1;for(;++k<v.length;)w.push(Ct(h,v[k]));return w.join("")}var _r=ki('<div style="border:1px solid #424242;border-radius:5px;padding:10px">');const nt=new ui({level:3}),fr={foreground:"#F8F8F8",background:"#2D2E2C",selection:"#5DA5D533",black:"#1E1E1D",brightBlack:"#262625",red:"#CE5C5C",brightRed:"#FF7272",green:"#5BCC5B",brightGreen:"#72FF72",yellow:"#CCCC5B",brightYellow:"#FFFF72",blue:"#5D5DD3",brightBlue:"#7279FF",magenta:"#BC5ED1",brightMagenta:"#E572FF",cyan:"#5DA5D5",brightCyan:"#72F0FF",white:"#F8F8F8",brightWhite:"#FFFFFF"},gr="\x1B[0m",pr=dr({koan:h=>({case_insensitive:!1,contains:[{scope:"string",begin:'"',end:'"'},{scope:"number",match:/\d+(\.\d+)?/},{scope:"keyword",match:/(let|fun|if|else)/},{scope:"variable",match:/([a-zA-Z_][a-zA-Z0-9_]*|π)/}]})});function vr(h){return pr.highlight("koan",h,{keyword:nt.hex("#E06C75"),number:nt.hex("#E5C07B"),string:nt.hex("#98C379")}).value}let mr=class{constructor(h){this.line="",this.cursor=0,this.term=h}clearLine(){this.term.write("\x1B[2K\r"),this.prompt()}delChar(){this.cursor-1>=0&&(this.line=this.line.substring(0,this.cursor-1)+this.line.substring(this.cursor),this.cursor--,this.rerender())}reset(){this.line="",this.cursor=0}insert(h){this.line=this.line.slice(0,this.cursor)+h+this.line.slice(this.cursor),this.cursor+=h.length,this.rerender()}cursorLeft(){this.cursor>0&&(this.cursor--,this.rerender())}cursorRight(){this.cursor<this.line.length&&(this.cursor++,this.rerender())}prompt(){this.term.write(`\x1B[34m \u03BB ${gr}`)}rerender(){this.clearLine(),this.term.write(vr(this.line)),this.term.write(`\x1B[${this.cursor+4}G`)}};function Sr(){let h;return mi(()=>{const v=new Ai.Terminal({fontFamily:'"Cascadia Code", Menlo, monospace',theme:fr,cursorBlink:!0}),w=new mr(v),k=new Ft;v.open(h),v.onData(M=>{switch(M){case"\r":try{if(w.term.writeln(""),w.line){const P=Wi(w.line,k);w.reset(),P.result()!=="nothing"&&w.term.writeln(` ${P.result()}`),P.stdout()&&w.term.writeln(` ${P.stdout().slice(0,-1)}`)}w.prompt()}catch(P){w.reset(),v.writeln(`Error: ${P}`),w.prompt()}break;case"\x1B[D":w.cursorLeft();break;case"\x1B[C":w.cursorRight();break;case"\x7F":w.line.length>=1&&w.cursor>0&&w.delChar();break;default:(M>=" "&&M<="~"||M>="\xA0")&&w.insert(M)}}),w.term.writeln(`
 Welcome to the ${nt.hex("#C678DD")("Koan")} repl!`),w.prompt()}),(()=>{var v=_r(),w=h;return typeof w=="function"?Li(w,v):h=v,v})()}function br(){return Rt(Sr,{})}const Cr=document.getElementById("root");xi(()=>Rt(br,{}),Cr)})()});export default Er();
